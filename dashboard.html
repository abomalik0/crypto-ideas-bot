<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8" />
    <title>IN CRYPTO Ai â€” WAR ROOM</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700;800&display=swap');

        :root {
            --bg-main: #02040a;
            --bg-main-grad: radial-gradient(circle at top, #111827 0, #02040a 55%);
            --bg-card: rgba(8, 11, 20, 0.9);
            --bg-card-soft: rgba(8, 11, 20, 0.82);
            --border-soft: rgba(148, 163, 184, 0.32);
            --border-strong: rgba(248, 250, 252, 0.02);
            --accent-gold: #fbbf24;
            --accent-gold-soft: rgba(251, 191, 36, 0.18);
            --accent-red: #fb7185;
            --accent-green: #22c55e;
            --accent-blue: #38bdf8;
            --accent-cyan: #06b6d4;
            --text-main: #f9fafb;
            --text-muted: #9ca3af;
        }

        * { box-sizing: border-box; }

        body {
            margin: 0;
            padding: 0;
            font-family: "Cairo", system-ui, sans-serif;
            background:
                radial-gradient(circle at top left, rgba(248, 250, 252, 0.05), transparent 55%),
                radial-gradient(circle at top right, rgba(251, 191, 36, 0.09), transparent 55%),
                var(--bg-main-grad);
            color: var(--text-main);
            min-height: 100vh;
        }

        .layout {
            max-width: 1320px;
            margin: 0 auto 16px;
        }

        /* ===== TOP BTC BAR ===== */
        .btc-bar {
            width: 100%;
            padding: 10px 18px;
            background: linear-gradient(90deg, #020617, #050816);
            border-bottom: 1px solid rgba(148, 163, 184, 0.25);
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            align-items: center;
            justify-content: space-between;
            font-size: 13px;
        }

        .btc-bar-left {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            align-items: center;
        }

        .btc-pill-main {
            padding: 3px 10px;
            border-radius: 999px;
            background: radial-gradient(circle at top, #fbbf24, #f59e0b);
            color: #111827;
            font-weight: 800;
            font-size: 11px;
            letter-spacing: 0.12em;
        }

        .btc-title-mini {
            font-weight: 600;
            color: #e5e7eb;
            font-size: 12px;
        }

        .btc-bar-right {
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
            align-items: center;
        }

        .btc-metric {
            display: flex;
            align-items: baseline;
            gap: 4px;
        }

        .btc-label {
            color: var(--text-muted);
            font-size: 11px;
        }

        .btc-val {
            font-weight: 600;
            font-size: 13px;
        }

        .btc-green { color: var(--accent-green); }
        .btc-red   { color: var(--accent-red); }

        .btc-mode-chip {
            padding: 4px 11px;
            border-radius: 999px;
            border: 1px solid rgba(251, 191, 36, 0.7);
            font-size: 11px;
            letter-spacing: 0.16em;
            text-transform: uppercase;
            color: #fef3c7;
            background:
                radial-gradient(circle at top, rgba(251, 191, 36, 0.35), transparent 60%),
                rgba(5, 6, 15, 0.97);
        }

        /* ===== HEADER ===== */
        .header {
            padding: 12px 18px 2px;
            display: flex;
            flex-wrap: wrap;
            justify-content: space-between;
            gap: 12px;
        }

        .header-main {
            display: flex;
            flex-direction: column;
            gap: 3px;
        }

        .header-title {
            font-size: 20px;
            font-weight: 800;
            letter-spacing: 0.2em;
            text-transform: uppercase;
            color: #fef3c7;
        }

        .header-sub {
            font-size: 12px;
            color: var(--text-muted);
        }

        .header-badge-row {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            align-items: center;
        }

        .header-badge {
            font-size: 10px;
            padding: 3px 8px;
            border-radius: 999px;
            border: 1px solid rgba(148, 163, 184, 0.4);
            background: rgba(15, 23, 42, 0.9);
            color: var(--text-muted);
        }

        .header-badge strong { color: #fef3c7; }

        /* ===== GRID LAYOUT ===== */
        .grid {
            padding: 10px 18px 18px;
            display: grid;
            grid-template-columns: repeat(3, minmax(0, 1fr));
            gap: 12px;
        }

        .span-2 { grid-column: span 2; }
        .span-3 { grid-column: span 3; }

        @media (max-width: 1180px) {
            .grid {
                grid-template-columns: repeat(2, minmax(0, 1fr));
            }
            .span-3 {
                grid-column: span 2;
            }
        }

        @media (max-width: 768px) {
            .header { padding: 10px 10px 2px; }
            .btc-bar { padding: 10px 10px; }
            .grid {
                grid-template-columns: minmax(0, 1fr);
                padding: 8px 10px 16px;
            }
            .span-2, .span-3 { grid-column: span 1; }
        }

        /* ===== CARD BASE ===== */
        .card {
            background: linear-gradient(135deg,
                    rgba(15, 23, 42, 0.96),
                    rgba(15, 23, 42, 0.94));
            border-radius: 18px;
            border: 1px solid var(--border-soft);
            padding: 12px 13px 11px;
            position: relative;
            overflow: hidden;
            box-shadow:
                0 24px 40px rgba(0, 0, 0, 0.9),
                0 0 0 1px var(--border-strong);
            backdrop-filter: blur(14px);
            transition:
                transform 0.18s ease-out,
                box-shadow 0.18s ease-out,
                border-color 0.18s ease-out,
                background 0.18s ease-out;
        }

        .card::before {
            content: "";
            position: absolute;
            inset: -40%;
            background:
                radial-gradient(circle at top left, rgba(251, 191, 36, 0.15), transparent 60%),
                radial-gradient(circle at bottom right, rgba(56, 189, 248, 0.12), transparent 55%);
            opacity: 0;
            transition: opacity 0.22s ease-out;
            pointer-events: none;
        }

        .card:hover {
            transform: translateY(-2px);
            box-shadow:
                0 26px 50px rgba(0, 0, 0, 0.95),
                0 0 0 1px rgba(248, 250, 252, 0.05);
            border-color: rgba(251, 191, 36, 0.55);
        }

        .card:hover::before { opacity: 1; }

        .card-header {
            display: flex;
            align-items: baseline;
            justify-content: space-between;
            margin-bottom: 6px;
            gap: 6px;
        }

        .card-title {
            font-size: 13px;
            font-weight: 700;
            color: #fef3c7;
        }

        .card-tag {
            font-size: 10px;
            padding: 3px 7px;
            border-radius: 999px;
            border: 1px solid rgba(148, 163, 184, 0.4);
            color: var(--text-muted);
            background: rgba(15, 23, 42, 0.96);
        }

        .card-main {
            font-size: 22px;
            font-weight: 800;
            margin-top: 3px;
        }

        .card-main span.small {
            font-size: 12px;
            font-weight: 500;
            color: var(--text-muted);
        }

        .subtext {
            font-size: 11px;
            margin-top: 3px;
            color: var(--text-muted);
            line-height: 1.6;
        }

        .kpi-row {
            display: flex;
            flex-wrap: wrap;
            gap: 7px;
            margin-top: 7px;
        }

        .kpi-pill {
            padding: 4px 8px;
            border-radius: 999px;
            background: var(--bg-card-soft);
            border: 1px solid rgba(148, 163, 184, 0.38);
            font-size: 10px;
            display: inline-flex;
            gap: 4px;
            align-items: baseline;
        }

        .kpi-label { color: var(--text-muted); }
        .kpi-val { font-weight: 600; }

        .green  { color: var(--accent-green); }
        .red    { color: var(--accent-red); }
        .gold   { color: var(--accent-gold); }
        .blue   { color: var(--accent-blue); }
        .cyan   { color: var(--accent-cyan); }

        /* ===== HEATBAR ===== */
        .heatbar {
            margin-top: 8px;
            width: 100%;
            height: 7px;
            border-radius: 999px;
            overflow: hidden;
            position: relative;
            background: linear-gradient(90deg,
                        #22c55e,
                        #eab308,
                        #f97316,
                        #ef4444);
        }

        .heatbar-track {
            position: absolute;
            inset: 0;
            background: linear-gradient(90deg,
                        rgba(34,197,94,0.05),
                        rgba(250,204,21,0.1),
                        rgba(248,250,252,0.05));
            mix-blend-mode: soft-light;
        }

        .heatbar-dot {
            position: absolute;
            top: 50%;
            width: 18px;
            height: 18px;
            border-radius: 999px;
            transform: translate(-50%, -50%);
            border: 2px solid #111827;
            box-shadow: 0 0 18px rgba(248, 250, 252, 0.9);
            background: #fef3c7;
        }

        .heatbar-labels {
            display: flex;
            justify-content: space-between;
            font-size: 9px;
            color: var(--text-muted);
            margin-top: 3px;
        }

        /* ===== LOG AREA ===== */
        pre {
            margin: 6px 0 0;
            padding: 7px;
            border-radius: 10px;
            background: radial-gradient(circle at top left, #020617, #020617);
            border: 1px solid rgba(148, 163, 184, 0.35);
            font-size: 10px;
            max-height: 148px;
            overflow: auto;
            direction: ltr;
            text-align: left;
            white-space: pre-wrap;
        }

        /* ===== ALERT FLASH ===== */
        .flash {
            animation: flashAnim 0.9s infinite alternate;
        }

        @keyframes flashAnim {
            from {
                box-shadow: 0 0 18px rgba(251, 191, 36, 0.4);
                border-color: rgba(251, 191, 36, 0.9);
            }
            to {
                box-shadow: 0 0 26px rgba(248, 113, 113, 0.9);
                border-color: rgba(248, 113, 113, 0.95);
            }
        }

        /* ===== BUTTONS ===== */
        .btn-row {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
            margin-top: 8px;
        }

        button {
            border-radius: 999px;
            border: 0;
            padding: 5px 11px;
            font-size: 10px;
            cursor: pointer;
            background: #020617;
            color: #e5e7eb;
            border: 1px solid rgba(148, 163, 184, 0.6);
        }

        button.primary {
            background: radial-gradient(circle at top,
                        #facc15,
                        #f59e0b);
            color: #111827;
            font-weight: 700;
            border-color: transparent;
        }

        button.secondary { border-style: dashed; }

        /* ===== ALERTS LIST ===== */
        .alerts-list {
            margin-top: 4px;
            font-size: 10px;
            max-height: 140px;
            overflow: auto;
            line-height: 1.5;
        }

        .alert-item { margin-bottom: 4px; }

        /* ===== HEATMAP ===== */
        .heatmap-grid {
            display: grid;
            grid-template-columns: repeat(4, minmax(0, 1fr));
            gap: 6px;
            margin-top: 6px;
        }

        .heatmap-cell {
            border-radius: 12px;
            padding: 5px 6px 4px;
            font-size: 10px;
            background: radial-gradient(circle at top, rgba(15, 23, 42, 0.96), rgba(15, 23, 42, 0.92));
            border: 1px solid rgba(148, 163, 184, 0.35);
        }

        .heatmap-symbol {
            font-weight: 700;
            font-size: 11px;
        }

        .heatmap-change { font-size: 10px; }

        @media (max-width: 768px) {
            .heatmap-grid {
                grid-template-columns: repeat(3, minmax(0,1fr));
            }
        }

        /* ===== SENTIMENT CARD ===== */
        .sentiment-badge {
            font-size: 11px;
            font-weight: 700;
            padding: 3px 9px;
            border-radius: 999px;
            background: rgba(15, 23, 42, 0.95);
            border: 1px solid rgba(148, 163, 184, 0.5);
            display: inline-flex;
            align-items: center;
            gap: 4px;
            margin-top: 3px;
        }

        .sentiment-meter {
            margin-top: 8px;
            width: 100%;
            height: 6px;
            border-radius: 999px;
            overflow: hidden;
            background: linear-gradient(90deg, #22c55e, #eab308, #f97316, #ef4444);
            position: relative;
        }

        .sentiment-pointer {
            position: absolute;
            top: 50%;
            width: 14px;
            height: 14px;
            border-radius: 999px;
            border: 2px solid #020617;
            background: #e5e7eb;
            transform: translate(-50%, -50%);
            box-shadow: 0 0 12px rgba(248, 250, 252, 0.9);
        }

        /* ===== REAL-TIME ENGINE METERS ===== */
        .meter-wrapper {
            margin-top: 8px;
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .meter-label {
            font-size: 10px;
            color: var(--text-muted);
        }

        .meter-bar {
            width: 100%;
            height: 6px;
            border-radius: 999px;
            background: rgba(15, 23, 42, 0.96);
            border: 1px solid rgba(148, 163, 184, 0.4);
            overflow: hidden;
        }

        .meter-fill {
            height: 100%;
            width: 20%;
            border-radius: 999px;
            background: linear-gradient(90deg, #22c55e, #facc15, #f97316);
            transition: width 0.25s ease-out;
        }

        /* ===== FOOTER ===== */
        .footer {
            padding: 4px 18px 8px;
            font-size: 10px;
            text-align: center;
            color: var(--text-muted);
        }

        .footer span { color: #fbbf24; }
    </style>
</head>

<body>

    <!-- ========== TOP BTC BAR ========== -->
    <div id="btcBar" class="btc-bar">
        <div class="btc-bar-left">
            <span class="btc-pill-main">IN CRYPTO Ai</span>
            <span class="btc-title-mini">ØºØ±ÙØ© Ø¹Ù…Ù„ÙŠØ§Øª IN CRYPTO â€” WAR ROOM</span>
        </div>
        <div class="btc-bar-right">
            <div class="btc-metric">
                <span class="btc-label">Ø§Ù„Ø³Ø¹Ø±:</span>
                <span id="barPrice" class="btc-val">-</span>
            </div>
            <div class="btc-metric">
                <span class="btc-label">ØªØºÙŠØ± 24 Ø³:</span>
                <span id="barChange" class="btc-val">-</span>
            </div>
            <div class="btc-metric">
                <span class="btc-label">Ù…Ø¯Ù‰ Ø§Ù„ÙŠÙˆÙ…:</span>
                <span id="barRange" class="btc-val">-</span>
            </div>
            <div id="marketModeChip" class="btc-mode-chip">
                NORMAL MODE
            </div>
        </div>
    </div>

    <div class="layout">
        <!-- ========== HEADER ========== -->
        <div class="header">
            <div class="header-main">
                <div class="header-title">IN CRYPTO â€” WAR ROOM</div>
                <div class="header-sub">
                    Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø­ÙŠØ© Ù„Ù‚ÙˆØ© Ø§Ù„Ø³ÙˆÙ‚ØŒ Ø§Ù„Ø³ÙŠÙˆÙ„Ø©ØŒ Ø§Ù„Ù…Ø®Ø§Ø·Ø±ØŒ Ø§Ù„Ø¶ÙˆØ¶Ø§Ø¡ØŒ ØªØ¯ÙÙ‚ Ø§Ù„Ø£ÙˆØ§Ù…Ø±ØŒ ÙˆÙ†Ø¸Ø§Ù… ØªØ­Ø°ÙŠØ± Ø°ÙƒÙ‘Ù‰ Ù…Ø¨Ù†Ù‰ Ø¨Ø§Ù„ÙƒØ§Ù…Ù„ Ø¹Ù„Ù‰ Ø­Ø±ÙƒØ© Ø§Ù„Ø¨ÙŠØªÙƒÙˆÙŠÙ† ÙÙ‚Ø·.
                </div>
            </div>
            <div class="header-badge-row">
                <div class="header-badge">
                    ÙˆØ¶Ø¹ Ø§Ù„ØªØ´ØºÙŠÙ„: <strong id="badgeMode">NORMAL</strong>
                </div>
                <div class="header-badge">
                    Ø¢Ø®Ø± ØªØ­Ø¯ÙŠØ« Real-Time: <strong id="badgeRealtime">---</strong>
                </div>
                <div class="header-badge">
                    Ø³Ø¬Ù„ Ø§Ù„Ø´Ø§ØªØ§Øª: <strong id="badgeChats">0</strong>
                </div>
            </div>
        </div>

        <!-- ========== GRID LAYOUT ========== -->
        <div class="grid">

            <!-- Ù‚ÙˆØ© Ø§Ù„Ø³ÙˆÙ‚ + Heat Score (ÙƒØ¨ÙŠØ±Ø©) -->
            <div class="card span-3" id="marketStrengthCard">
                <div class="card-header">
                    <div class="card-title">Ù‚ÙˆØ© Ø§Ù„Ø³ÙˆÙ‚ Ø§Ù„Ø¹Ø§Ù…Ø© (Market Strength)</div>
                    <div class="card-tag">BTCUSDT Snapshot</div>
                </div>
                <div class="card-main" id="strengthValue">...</div>
                <div class="subtext">
                    Ù‚Ø±Ø§Ø¡Ø© Ù…Ø¯Ù…Ø¬Ø© Ù„Ø§ØªØ¬Ø§Ù‡ Ø§Ù„Ø¨ÙŠØªÙƒÙˆÙŠÙ† ÙˆÙ…Ø¯Ù‰ Ø§Ù„Ø­Ø±ÙƒØ© Ø§Ù„ÙŠÙˆÙ…ÙŠØ© Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø¨ÙŠØ§Ù†Ø§Øª Binance / KuCoin ÙÙ‚Ø·ØŒ Ø¨Ø¯ÙˆÙ† Ø£Ù‰ Ù…Ø²ÙˆØ¯ Ø®Ø§Ø±Ø¬Ù‰.
                </div>
                <div class="kpi-row">
                    <div class="kpi-pill">
                        <span class="kpi-label">Î” Ø§Ù„ÙŠÙˆÙ…:</span>
                        <span class="kpi-val" id="kpiChange">...</span>
                    </div>
                    <div class="kpi-pill">
                        <span class="kpi-label">Ù…Ø¯Ù‰ %:</span>
                        <span class="kpi-val" id="kpiRange">...</span>
                    </div>
                    <div class="kpi-pill">
                        <span class="kpi-label">Heat Score:</span>
                        <span class="kpi-val" id="kpiHeat">...</span>
                    </div>
                </div>
                <div class="heatbar">
                    <div class="heatbar-track"></div>
                    <div id="heatDot" class="heatbar-dot" style="left: 10%;"></div>
                </div>
                <div class="heatbar-labels">
                    <span>Ù‡Ø§Ø¯Ø¦</span>
                    <span>Ù†Ø´Ø·</span>
                    <span>Ø³Ø§Ø®Ù†</span>
                    <span>Ù…Ù†Ø·Ù‚Ø© Ø®Ø·Ø±</span>
                </div>
            </div>

            <!-- Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ù…Ø®Ø§Ø·Ø± -->
            <div class="card span-1" id="riskCard">
                <div class="card-header">
                    <div class="card-title">Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ù…Ø®Ø§Ø·Ø± (IN CRYPTO Ai)</div>
                    <div class="card-tag">Risk Engine</div>
                </div>
                <div class="card-main" id="riskValue">...</div>
                <div class="subtext" id="riskNote">...</div>
                <div class="kpi-row">
                    <div class="kpi-pill">
                        <span class="kpi-label">Ø¯Ø±Ø¬Ø© Ø§Ù„ØªÙ‚Ù„Ø¨:</span>
                        <span class="kpi-val" id="kpiVol">...</span>
                    </div>
                    <div class="kpi-pill">
                        <span class="kpi-label">ÙˆØ¶Ø¹ Ø§Ù„Ø³ÙˆÙ‚:</span>
                        <span class="kpi-val" id="kpiMode">...</span>
                    </div>
                </div>
            </div>

            <!-- Ù†Ø¨Ø¶ Ø§Ù„Ø³ÙŠÙˆÙ„Ø© ÙˆØ§Ù„Ø§ØªØ¬Ø§Ù‡ -->
            <div class="card span-1">
                <div class="card-header">
                    <div class="card-title">Ù†Ø¨Ø¶ Ø§Ù„Ø³ÙŠÙˆÙ„Ø© Ø¨ÙŠÙ† Ø§Ù„Ù…Ø´ØªØ±ÙŠÙ† ÙˆØ§Ù„Ø¨Ø§Ø¦Ø¹ÙŠÙ†</div>
                    <div class="card-tag">Liquidity Pulse</div>
                </div>
                <div class="card-main" id="liquidityValue">...</div>
                <div class="subtext">
                    Ù‚Ø±Ø§Ø¡Ø© Ù…Ø¨Ø³Ø·Ø© Ù„ØªÙˆØ§Ø²Ù† Ø§Ù„Ø³ÙŠÙˆÙ„Ø© Ø§Ø¹ØªÙ…Ø§Ø¯Ù‹Ø§ Ø¹Ù„Ù‰ Ø§ØªØ¬Ø§Ù‡ BTCUSDTØŒ Ù…Ø¹ ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ø­Ø±ÙƒØ© Ø§Ù„ÙŠÙˆÙ…ÙŠØ© Ù„ØµÙˆØ±Ø© Ø£ÙˆØ¶Ø­ Ø¹Ù† Ù…Ù† ÙŠØ³ÙŠØ·Ø± Ø¹Ù„Ù‰ Ø§Ù„Ø³ÙˆÙ‚ Ø­Ø§Ù„ÙŠÙ‹Ø§.
                </div>
                <div class="kpi-row">
                    <div class="kpi-pill">
                        <span class="kpi-label">ÙˆØ¶Ø¹ Ø§Ù„Ø³ÙŠÙˆÙ„Ø©:</span>
                        <span class="kpi-val" id="liqLabel">...</span>
                    </div>
                    <div class="kpi-pill">
                        <span class="kpi-label">Ø¥Ø´Ø§Ø±Ø© Ø§Ù„Ø­Ø±ÙƒØ©:</span>
                        <span class="kpi-val" id="signalPulse">...</span>
                    </div>
                </div>
            </div>

            <!-- Ù…Ø¤Ø´Ø± Ø§Ù„ØªÙ‚Ù„Ø¨ Ø§Ù„ÙŠÙˆÙ…Ù‰ Ù„Ù„Ø¨ÙŠØªÙƒÙˆÙŠÙ† -->
            <div class="card span-1">
                <div class="card-header">
                    <div class="card-title">Ù…Ø¤Ø´Ø± Ø§Ù„ØªÙ‚Ù„Ø¨ Ø§Ù„ÙŠÙˆÙ…Ù‰ Ù„Ù„Ø¨ÙŠØªÙƒÙˆÙŠÙ†</div>
                    <div class="card-tag">Volatility Monitor</div>
                </div>
                <div class="card-main">
                    <span id="volatilityValue">...</span>
                    <span class="small">/ 100</span>
                </div>
                <div class="subtext">
                    ÙƒÙ„Ù…Ø§ Ø§Ù‚ØªØ±Ø¨ Ø§Ù„Ù…Ø¤Ø´Ø± Ù…Ù† 100 ÙƒØ§Ù† Ø§Ù„Ø³ÙˆÙ‚ Ø£ÙƒØ«Ø± Ø¹Ø¯ÙˆØ§Ù†ÙŠØ© ÙˆØªØ­ØªØ§Ø¬ Ø¥Ø¯Ø§Ø±Ø© Ù…Ø®Ø§Ø·Ø± ØµØ§Ø±Ù…Ø©ØŒ ÙˆÙƒÙ„Ù…Ø§ Ø§Ù‚ØªØ±Ø¨ Ù…Ù† Ø§Ù„ØµÙØ± ÙƒØ§Ù† Ø§Ù„Ø³ÙˆÙ‚ Ø£ÙƒØ«Ø± Ù‡Ø¯ÙˆØ¡Ù‹Ø§.
                </div>
                <div class="kpi-row">
                    <div class="kpi-pill">
                        <span class="kpi-label">Ù†Ø·Ø§Ù‚ Ø§Ù„ÙŠÙˆÙ…:</span>
                        <span class="kpi-val" id="rangeDetail">...</span>
                    </div>
                    <div class="kpi-pill">
                        <span class="kpi-label">ÙˆØµÙ Ø§Ù„ØªÙ‚Ù„Ø¨:</span>
                        <span class="kpi-val" id="volatilityLabel">...</span>
                    </div>
                </div>
            </div>

            <!-- Ù†Ø¸Ø§Ù… Ø§Ù„ØªØ­Ø°ÙŠØ± Ø§Ù„ØªÙ„Ù‚Ø§Ø¦Ù‰ -->
            <div class="card span-1" id="alertFlashCard">
                <div class="card-header">
                    <div class="card-title">Ù†Ø¸Ø§Ù… Ø§Ù„ØªØ­Ø°ÙŠØ± Ø§Ù„ØªÙ„Ù‚Ø§Ø¦Ù‰</div>
                    <div class="card-tag">/auto_alert</div>
                </div>
                <div class="card-main" id="alertReason">Ù„Ø§ ÙŠÙˆØ¬Ø¯ ØªØ­Ø°ÙŠØ± Ø­Ø§Ù„ÙŠÙ‹Ø§</div>
                <div class="subtext">
                    Ø¢Ø®Ø± Ø§Ø³ØªØ¬Ø§Ø¨Ø© Ù„Ù…Ø³Ø§Ø± <code>/auto_alert</code> Ù…Ù† Ø§Ù„Ø¨ÙˆØªØŒ Ù…Ø¹ ØªÙ…ÙŠÙŠØ² ØªÙ„Ù‚Ø§Ø¦Ù‰ Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ù†Ø¸Ø§Ù… ÙŠØ±Ù‰ ÙˆØ¶Ø¹ ØºÙŠØ± Ø·Ø¨ÙŠØ¹Ù‰ ÙÙ‰ Ø§Ù„Ø³ÙˆÙ‚.
                </div>
                <div class="kpi-row">
                    <div class="kpi-pill">
                        <span class="kpi-label">Ø¢Ø®Ø± ÙˆÙ‚Øª:</span>
                        <span class="kpi-val" id="alertTime">---</span>
                    </div>
                    <div class="kpi-pill">
                        <span class="kpi-label">ØªÙ… Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ØŸ</span>
                        <span class="kpi-val" id="alertSent">---</span>
                    </div>
                </div>
                <div class="btn-row">
                    <button class="primary" onclick="callAdmin('force_alert')">Ø¥Ø±Ø³Ø§Ù„ ØªØ­Ø°ÙŠØ± ÙÙˆØ±Ù‰ âš¡</button>
                    <button class="secondary" onclick="callAdmin('test_alert')">ØªÙ†Ø¨ÙŠÙ‡ ØªØ¬Ø±ÙŠØ¨Ù‰ ğŸ§ª</button>
                </div>
            </div>

            <!-- Sentiment / Fear & Greed -->
            <div class="card span-1">
                <div class="card-header">
                    <div class="card-title">Sentiment Index â€” Fear & Greed</div>
                    <div class="card-tag">IN CRYPTO Ai Gauge</div>
                </div>
                <div class="card-main">
                    <span id="sentimentIndex">-- / 100</span>
                </div>
                <div class="sentiment-badge" id="sentimentBadge">
                    <span id="sentimentLabel">Ø¬Ø§Ø±Ù‰ Ø§Ù„Ø­Ø³Ø§Ø¨...</span>
                </div>
                <div class="subtext">
                    Ù‚Ø±Ø§Ø¡Ø© Ù…Ø¬Ù…Ø¹Ø© Ù…Ù† Ø­Ø±ÙƒØ© Ø§Ù„Ø¨ÙŠØªÙƒÙˆÙŠÙ† ÙˆØ§Ù„ØªÙ‚Ù„Ø¨ ÙˆÙ…Ø¯Ù‰ Ø§Ù„ÙŠÙˆÙ…ØŒ Ù„ØªÙ‚Ø¯ÙŠØ± Ù…Ø§ Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ø³ÙˆÙ‚ Ø£Ù‚Ø±Ø¨ Ù„Ø­Ø§Ù„Ø© Ø®ÙˆÙØŒ Ø­Ø°Ø±ØŒ Ø£Ù… Ø¬Ø´Ø¹.
                </div>
                <div class="sentiment-meter">
                    <div id="sentimentPointer" class="sentiment-pointer" style="left: 50%;"></div>
                </div>
                <div class="heatbar-labels">
                    <span>Ø®ÙˆÙ Ø´Ø¯ÙŠØ¯</span>
                    <span>Ø­Ø°Ø±</span>
                    <span>Ø·Ø¨ÙŠØ¹Ù‰</span>
                    <span>Ø¬Ø´Ø¹</span>
                </div>
            </div>

            <!-- HEATMAP -->
            <div class="card span-1">
                <div class="card-header">
                    <div class="card-title">Crypto Market Heatmap (ØªÙ‚Ø¯ÙŠØ±)</div>
                    <div class="card-tag">BTC-led Derivatives</div>
                </div>
                <div class="subtext">
                    Ø®Ø±ÙŠØ·Ø© Ù…ØµØºØ±Ø© Ù„Ø­Ø±ÙƒØ© Ø¨Ø¹Ø¶ â€œØ§Ù„Ø³Ù„Ø§Ù„â€ Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ© Ù„Ù„Ø¹Ù…Ù„Ø§Øª (Majors / DeFi / Meme / AI) ÙƒÙ…Ø¤Ø´Ø± Ø¨ØµØ±Ù‰ Ø³Ø±ÙŠØ¹ Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ø§Ù„Ø²Ø®Ù… Ø®Ø§Ø±Ø¬ Ø§Ù„Ø¨ÙŠØªÙƒÙˆÙŠÙ†.
                </div>
                <div class="heatmap-grid" id="heatmapGrid"></div>
            </div>

            <!-- ØªØ¯ÙÙ‚ Ø§Ù„Ø£ÙˆØ§Ù…Ø± Ø§Ù„Ù„Ø­Ø¸Ù‰ -->
            <div class="card span-1">
                <div class="card-header">
                    <div class="card-title">ØªØ¯ÙÙ‚ Ø§Ù„Ø£ÙˆØ§Ù…Ø± Ø§Ù„Ù„Ø­Ø¸Ù‰ â€” Ø§Ù„Ù…Ø´ØªØ±ÙŠÙ† Ù…Ù‚Ø§Ø¨Ù„ Ø§Ù„Ø¨Ø§Ø¦Ø¹ÙŠÙ†</div>
                    <div class="card-tag">Order Flow Snapshot</div>
                </div>
                <div class="card-main" id="orderFlowValue">---</div>
                <div class="subtext" id="orderFlowText">
                    ØªÙ‚Ø¯ÙŠØ± ØªÙ‚Ø±ÙŠØ¨Ù‰ Ù„ØªÙˆØ§Ø²Ù† Ø§Ù„Ø¶ØºØ· Ø¨ÙŠÙ† Ø§Ù„Ù…Ø´ØªØ±ÙŠÙ† ÙˆØ§Ù„Ø¨Ø§Ø¦Ø¹ÙŠÙ† Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§ØªØ¬Ø§Ù‡ Ø§Ù„Ø³Ø¹Ø± ÙˆØ§Ù„ØªÙ‚Ù„Ø¨ ÙˆÙ†Ø¨Ø¶ Ø§Ù„Ø³ÙŠÙˆÙ„Ø© Ø§Ù„Ø­Ø§Ù„Ù‰.
                </div>
                <div class="kpi-row">
                    <div class="kpi-pill">
                        <span class="kpi-label">Ù‡ÙŠÙ…Ù†Ø© Ø§Ù„Ù…Ø´ØªØ±ÙŠÙ†:</span>
                        <span class="kpi-val" id="buyersShare">---</span>
                    </div>
                    <div class="kpi-pill">
                        <span class="kpi-label">Ù‡ÙŠÙ…Ù†Ø© Ø§Ù„Ø¨Ø§Ø¦Ø¹ÙŠÙ†:</span>
                        <span class="kpi-val" id="sellersShare">---</span>
                    </div>
                </div>
            </div>

            <!-- Ù…Ø­Ø±Ùƒ Ø§Ù„Ø³ÙˆÙ‚ Ø§Ù„Ù„Ø­Ø¸Ù‰ â€” Real-Time Engine -->
            <div class="card span-1" id="rtEngineCard">
                <div class="card-header">
                    <div class="card-title">Ù…Ø­Ø±Ùƒ Ø§Ù„Ø³ÙˆÙ‚ Ø§Ù„Ù„Ø­Ø¸Ù‰ â€” Real-Time Engine</div>
                    <div class="card-tag">Momentum Â· Pressure Â· Shock</div>
                </div>
                <div class="card-main" id="rtMomentumValue">---</div>
                <div class="subtext" id="rtMomentumText">
                    Ù‚Ø±Ø§Ø¡Ø© Ù„Ø­Ø¸ÙŠØ© Ù„Ø²Ø®Ù… Ø§Ù„Ø§ØªØ¬Ø§Ù‡ ÙˆØ¶ØºØ· Ø§Ù„Ø³ÙˆÙ‚ ÙˆØ§Ø­ØªÙ…Ø§Ù„ Ø­Ø¯ÙˆØ« ØµØ¯Ù…Ø© Ø³Ø¹Ø±ÙŠØ© Ù‚ØµÙŠØ±Ø© Ø§Ù„Ù…Ø¯Ù‰.
                </div>
                <div class="kpi-row">
                    <div class="kpi-pill">
                        <span class="kpi-label">Ø²Ø®Ù… Ø§Ù„Ø§ØªØ¬Ø§Ù‡:</span>
                        <span class="kpi-val" id="rtMomentumLabel">---</span>
                    </div>
                    <div class="kpi-pill">
                        <span class="kpi-label">Ø¶ØºØ· Ø§Ù„Ø³ÙˆÙ‚:</span>
                        <span class="kpi-val" id="rtPressureLabel">---</span>
                    </div>
                    <div class="kpi-pill">
                        <span class="kpi-label">Ø­Ø§Ù„Ø© Ø§Ù„ØµØ¯Ù…Ø©:</span>
                        <span class="kpi-val" id="rtShockLabel">---</span>
                    </div>
                </div>
                <div class="meter-wrapper">
                    <div class="meter-label">Momentum Gauge</div>
                    <div class="meter-bar">
                        <div id="rtMomentumBar" class="meter-fill"></div>
                    </div>
                    <div class="meter-label">Shock Detector</div>
                    <div class="meter-bar">
                        <div id="rtShockBar" class="meter-fill"></div>
                    </div>
                </div>
            </div>

            <!-- ØªÙˆÙ‚Ø¹ Ù‚ØµÙŠØ± Ø§Ù„Ù…Ø¯Ù‰ -->
            <div class="card span-2">
                <div class="card-header">
                    <div class="card-title">ØªÙˆÙ‚Ø¹ Ù‚ØµÙŠØ± Ø§Ù„Ù…Ø¯Ù‰ (â‰ˆ 15â€“30 Ø¯Ù‚ÙŠÙ‚Ø©)</div>
                    <div class="card-tag">Short-Term Bias</div>
                </div>
                <div class="card-main" id="shortTermBias">---</div>
                <div class="subtext" id="shortTermText">
                    Ø§Ù†Ø­ÙŠØ§Ø² Ø­Ø±ÙƒÙ‰ Ù‚ØµÙŠØ± Ø§Ù„Ù…Ø¯Ù‰ Ù…Ø¨Ù†Ù‰ Ø¹Ù„Ù‰ Ø¯Ù…Ø¬ Ø§Ù„ØªØºÙŠÙŠØ± Ø§Ù„ÙŠÙˆÙ…Ù‰ Ù…Ø¹ Ø¯Ø±Ø¬Ø© Ø§Ù„ØªÙ‚Ù„Ø¨ ÙˆÙ‚ÙˆØ© Ø§Ù„Ø³ÙˆÙ‚.
                </div>
                <div class="kpi-row">
                    <div class="kpi-pill">
                        <span class="kpi-label">Ø³ÙŠÙ†Ø§Ø±ÙŠÙˆ Ø§Ù„ØµØ¹ÙˆØ¯:</span>
                        <span class="kpi-val" id="upProb">---</span>
                    </div>
                    <div class="kpi-pill">
                        <span class="kpi-label">Ø³ÙŠÙ†Ø§Ø±ÙŠÙˆ Ø§Ù„Ù‡Ø¨ÙˆØ·:</span>
                        <span class="kpi-val" id="downProb">---</span>
                    </div>
                </div>
            </div>

            <!-- ÙÙ„ØªØ± Ø§Ù„Ø¶ÙˆØ¶Ø§Ø¡ ÙÙ‰ Ø§Ù„Ø­Ø±ÙƒØ© -->
            <div class="card span-1">
                <div class="card-header">
                    <div class="card-title">ÙÙ„ØªØ± Ø§Ù„Ø¶ÙˆØ¶Ø§Ø¡ ÙÙ‰ Ø§Ù„Ø­Ø±ÙƒØ©</div>
                    <div class="card-tag">Market Noise Filter</div>
                </div>
                <div class="card-main" id="noiseValue">---</div>
                <div class="subtext" id="noiseText">
                    ÙŠÙ‚ÙŠØ³ ÙƒÙ…ÙŠØ© Ø§Ù„Ø­Ø±ÙƒØ© â€œØ§Ù„Ø¹Ø¨Ø«ÙŠØ©â€ Ù…Ù‚Ø§Ø¨Ù„ Ø§Ù„Ø­Ø±ÙƒØ© Ø§Ù„Ù‡Ø§Ø¯ÙØ©Ø› ÙŠØ³Ø§Ø¹Ø¯ ÙÙ‰ Ù…Ø¹Ø±ÙØ© Ù…Ø§ Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ø£ÙØ¶Ù„ Ø¹Ø¯Ù… Ø§Ù„Ù…Ø·Ø§Ø±Ø¯Ø© ÙˆØ§Ù†ØªØ¸Ø§Ø± Ù…Ù†Ø§Ø·Ù‚ Ø£ÙˆØ¶Ø­.
                </div>
                <div class="kpi-row">
                    <div class="kpi-pill">
                        <span class="kpi-label">Ø¯Ø±Ø¬Ø© Ø§Ù„Ø¶ÙˆØ¶Ø§Ø¡ Ø§Ù„ØªÙ‚Ø¯ÙŠØ±ÙŠØ©:</span>
                        <span class="kpi-val" id="noiseScore">---</span>
                    </div>
                </div>
            </div>

            <!-- ÙˆØ¶Ø¹ Ø§Ù„Ø³ÙƒØ§Ù„Ø¨ÙŠÙ†Ø¬ -->
            <div class="card span-1">
                <div class="card-header">
                    <div class="card-title">ÙˆØ¶Ø¹ Ø§Ù„Ø³ÙƒØ§Ù„Ø¨ÙŠÙ†Ø¬ (Scalper Mode)</div>
                    <div class="card-tag">Scalper Suitability</div>
                </div>
                <div class="card-main" id="scalpSuitability">---</div>
                <div class="subtext" id="scalpText">
                    ØªÙ‚ÙŠÙŠÙ… Ø³Ø±ÙŠØ¹ Ù„Ù…Ø¯Ù‰ Ù…Ù„Ø§Ø¡Ù…Ø© Ø§Ù„Ø¸Ø±ÙˆÙ Ø§Ù„Ø­Ø§Ù„ÙŠØ© Ù„Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠØ§Øª Ø§Ù„Ø³ÙƒØ§Ù„Ø¨ÙŠÙ†Ø¬ Ø§Ù„Ø³Ø±ÙŠØ¹Ø© (Ø­Ø±ÙƒØ© Ã— ØªÙ‚Ù„Ø¨ Ã— Ø¶ÙˆØ¶Ø§Ø¡).
                </div>
            </div>

            <!-- Ù†Ø¨Ø¶ Ù‡ÙŠÙ…Ù†Ø© Ø§Ù„Ø¨ÙŠØªÙƒÙˆÙŠÙ† -->
            <div class="card span-1">
                <div class="card-header">
                    <div class="card-title">Ù†Ø¨Ø¶ Ù‡ÙŠÙ…Ù†Ø© Ø§Ù„Ø¨ÙŠØªÙƒÙˆÙŠÙ† Ø¹Ù„Ù‰ Ø§Ù„Ø³ÙˆÙ‚</div>
                    <div class="card-tag">BTC Dominance Pulse (ØªÙ‚Ø¯ÙŠØ±)</div>
                </div>
                <div class="card-main" id="dominanceValue">---</div>
                <div class="subtext" id="dominanceText"></div>
            </div>

            <!-- Ø¯Ø±Ø¬Ø© Ø­Ø±Ø§Ø±Ø© Ø§Ù„Ø§ØªØ¬Ø§Ù‡ -->
            <div class="card span-1">
                <div class="card-header">
                    <div class="card-title">Ø¯Ø±Ø¬Ø© Ø­Ø±Ø§Ø±Ø© Ø§Ù„Ø§ØªØ¬Ø§Ù‡ (Trend Temperature)</div>
                    <div class="card-tag">Momentum Gauge</div>
                </div>
                <div class="card-main" id="trendTempValue">---</div>
                <div class="subtext" id="trendTempText"></div>
            </div>

            <!-- ØµØ­Ø© Ø§Ù„Ù†Ø¸Ø§Ù… -->
            <div class="card span-1" id="systemHealthCard">
                <div class="card-header">
                    <div class="card-title">ØµØ­Ø© Ù†Ø¸Ø§Ù… IN CRYPTO Ai</div>
                    <div class="card-tag">System Health</div>
                </div>
                <div class="card-main" id="systemHealthValue">...</div>
                <div class="subtext" id="systemHealthText">
                    ÙŠØªÙ… ØªÙ‚ÙŠÙŠÙ… ØµØ­Ø© Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ø³ØªÙ†Ø§Ø¯Ù‹Ø§ Ø¥Ù„Ù‰ Ø­Ø§Ù„Ø© Ù…Ø­Ø±Ùƒ Ø§Ù„Ù…Ø®Ø§Ø·Ø±ØŒ Ø¢Ø®Ø± Ø§Ù„Ø£Ø®Ø·Ø§Ø¡ Ø§Ù„Ù…Ø³Ø¬Ù„Ø©ØŒ ÙˆØ§Ø³ØªÙ‚Ø±Ø§Ø± Ø§Ù„ØªØ­Ø°ÙŠØ±Ø§Øª Ø§Ù„Ø¢Ù„ÙŠØ©.
                </div>
                <div class="kpi-row">
                    <div class="kpi-pill">
                        <span class="kpi-label">Ø¢Ø®Ø± Ø®Ø·Ø£:</span>
                        <span class="kpi-val" id="systemLastError">---</span>
                    </div>
                    <div class="kpi-pill">
                        <span class="kpi-label">Ø¢Ø®Ø± ØªØ­Ø°ÙŠØ±:</span>
                        <span class="kpi-val" id="systemLastAlert">---</span>
                    </div>
                </div>
            </div>

            <!-- Ù…Ø±Ø§Ù‚Ø¨Ø© Ø§Ù„Ø£Ø®Ø·Ø§Ø¡ ÙˆØ§Ù„Ù„ÙˆØ¬ -->
            <div class="card span-2" id="errorCard">
                <div class="card-header">
                    <div class="card-title">Ù…Ø±Ø§Ù‚Ø¨Ø© Ø§Ù„Ø£Ø®Ø·Ø§Ø¡ ÙˆØ§Ù„Ù„ÙˆØ¬</div>
                    <div class="card-tag">Last error + Logs</div>
                </div>
                <div class="card-main" id="lastErrorTitle">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø£Ø®Ø·Ø§Ø¡ Ù…Ø³Ø¬Ù„Ø©</div>
                <div class="subtext">
                    ÙŠØªÙ… ØªØ­Ø¯ÙŠØ« Ù‡Ø°Ù‡ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§ Ø¹Ù†Ø¯ ØªØ³Ø¬ÙŠÙ„ Ø£Ù‰ Ø®Ø·Ø£ ÙÙ‰ Ø§Ù„Ø¨ÙˆØªØŒ Ù…Ø¹ Ø¹Ø±Ø¶ Snapshot Ù…Ø¨Ø§Ø´Ø± Ù…Ù† Ø§Ù„Ù„ÙˆØ¬.
                </div>
                <pre id="logsSnapshot">Ø¬Ø§Ø±Ù‰ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù„ÙˆØ¬...</pre>
            </div>

            <!-- Ø³Ø¬Ù„ Ø§Ù„ØªØ­Ø°ÙŠØ±Ø§Øª (Ø¹Ø±Ø¶ ÙƒØ§Ù…Ù„ Ù„ØªÙØ±ÙŠØº Ø§Ù„ÙØ±Ø§Øº ØªØ­Øª) -->
            <div class="card span-3">
                <div class="card-header">
                    <div class="card-title">Ø³Ø¬Ù„ Ø§Ù„ØªØ­Ø°ÙŠØ±Ø§Øª</div>
                    <div class="card-tag">Alerts History</div>
                </div>
                <div class="alerts-list" id="alertsList">
                    Ø¬Ø§Ø±Ù ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø³Ø¬Ù„...
                </div>
                <div class="btn-row">
                    <button onclick="reloadAlerts()">ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø³Ø¬Ù„ ğŸ”„</button>
                    <button onclick="clearAlerts()">Ù…Ø³Ø­ Ø§Ù„Ø³Ø¬Ù„ ğŸ§¹</button>
                </div>
            </div>

            <!-- ØªØ¹Ù„ÙŠÙ‚ Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹Ù‰ Ø¹Ù„Ù‰ Ø§Ù„ÙŠÙˆÙ… -->
            <div class="card span-3">
                <div class="card-header">
                    <div class="card-title">ØªØ¹Ù„ÙŠÙ‚ IN CRYPTO Ai Ø¹Ù„Ù‰ ÙˆØ¶Ø¹ Ø§Ù„Ø³ÙˆÙ‚ Ø§Ù„ÙŠÙˆÙ…</div>
                    <div class="card-tag">AI Market Commentary</div>
                </div>
                <div class="subtext" id="aiComment">
                    Ø¬Ø§Ø±Ù ØªØ¬Ù‡ÙŠØ² Ø§Ù„ØªØ¹Ù„ÙŠÙ‚...
                </div>
            </div>

        </div>

        <!-- ========== FOOTER ========== -->
        <div class="footer">
            IN CRYPTO Ai â€” <span>Live Market, Risk & Alert Monitor</span> Ù…Ø¨Ù†Ù‰ Ø¨Ø§Ù„ÙƒØ§Ù…Ù„ Ø¹Ù„Ù‰ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¨ÙŠØªÙƒÙˆÙŠÙ† Ø§Ù„ÙØ¹Ù„ÙŠØ©.
        </div>
    </div>

    <!-- ========== JAVASCRIPT ========== -->
    <script>
        function getPassParam() {
            const params = new URLSearchParams(window.location.search);
            return params.get("pass") || params.get("password") || "";
        }

        function apiUrl(path) {
            const pass = getPassParam();
            return pass ? path + "?pass=" + encodeURIComponent(pass) : path;
        }

        function computeHeatScore(changePct, volatilityScore, rangePct) {
            let score = Math.abs(changePct) * 1.2 + volatilityScore * 0.7 + rangePct * 0.4;
            if (score > 100) score = 100;
            if (score < 0) score = 0;
            return score;
        }

        function classifyMarketMode(change, volScore, rangePct) {
            if (Math.abs(change) < 0.7 && volScore < 25 && rangePct < 3) {
                return { mode: "NORMAL", label: "Ø­Ø±ÙƒØ© Ù‡Ø§Ø¯Ø¦Ø©" };
            }
            if (Math.abs(change) < 2 && volScore < 45) {
                return { mode: "ACTIVE", label: "Ø³ÙˆÙ‚ Ù†Ø´Ø·" };
            }
            if (volScore > 70 || rangePct > 8) {
                if (change <= -3) return { mode: "PANIC", label: "Ø¶ØºØ· Ø¨ÙŠØ¹Ù‰ Ø¹Ø§Ù„Ù‰" };
                return { mode: "VOLATILE", label: "ØªÙ‚Ù„Ø¨ Ù…Ø±ØªÙØ¹" };
            }
            return { mode: "ACTIVE", label: "Ø³ÙˆÙ‚ Ù†Ø´Ø·" };
        }

        function classifyVolatility(volScore) {
            if (volScore < 20) return "Ù…Ù†Ø®ÙØ¶";
            if (volScore < 45) return "Ù…ØªÙˆØ³Ø·";
            if (volScore < 70) return "Ù…Ø±ØªÙØ¹";
            return "Ø­Ø§Ø¯ Ø¬Ø¯Ù‹Ø§";
        }

        function buildSignalPulse(change, volScore) {
            if (Math.abs(change) < 0.5 && volScore > 55) {
                return "âš ï¸ Ø¶ØºØ· Ø¹Ø§Ù„Ù‰ Ø¨Ø¯ÙˆÙ† Ø­Ø±ÙƒØ© ÙˆØ§Ø¶Ø­Ø© â†’ Ø§Ø­ØªÙ…Ø§Ù„ Ø§Ù†ÙØ¬Ø§Ø± Ø³Ø¹Ø±Ù‰ Ù‚Ø±ÙŠØ¨.";
            }
            if (change > 2.5 && volScore > 50) {
                return "â¬†ï¸ Ø­Ø±ÙƒØ© ØµØ¹ÙˆØ¯ Ù‚ÙˆÙŠØ© Ù…Ø¹ Ø²Ø®Ù… ÙˆØ§Ø¶Ø­ Ù„ØµØ§Ù„Ø­ Ø§Ù„Ù…Ø´ØªØ±ÙŠÙ†.";
            }
            if (change < -2.5 && volScore > 50) {
                return "â¬‡ï¸ Ø­Ø±ÙƒØ© Ù‡Ø¨ÙˆØ· Ù‚ÙˆÙŠØ© Ù…Ø¹ Ø¶ØºØ· Ø¨ÙŠØ¹Ù‰ ÙˆØ§Ø¶Ø­.";
            }
            if (volScore < 20) {
                return "ğŸ˜´ Ø³ÙˆÙ‚ Ù‡Ø§Ø¯Ø¦ Ù†Ø³Ø¨ÙŠÙ‹Ø§ Ø¨Ø¯ÙˆÙ† Ø­Ø±ÙƒØ© ÙƒØ¨ÙŠØ±Ø©.";
            }
            return "ğŸ” ØªØ°Ø¨Ø°Ø¨ Ø·Ø¨ÙŠØ¹Ù‰ Ù…Ø¹ Ø³ÙŠÙˆÙ„Ø© Ù…ØªÙˆØ§Ø²Ù†Ø© ØªÙ‚Ø±ÙŠØ¨Ù‹Ø§.";
        }

        function estimateOrderFlow(change, volScore, liquidityLabel) {
            let base = 50;
            base += change * 2;
            base += (liquidityLabel.includes("Ø§Ù„Ù…Ø´ØªØ±ÙŠÙ†") ? 5 : 0);
            base -= (liquidityLabel.includes("Ø§Ù„Ø¨Ø§Ø¦Ø¹ÙŠÙ†") ? 5 : 0);
            base = Math.max(0, Math.min(100, base));

            const buyers = base;
            const sellers = 100 - base;

            let label;
            if (buyers > 60) label = "Ù‡ÙŠÙ…Ù†Ø© ÙˆØ§Ø¶Ø­Ø© Ù„Ù„Ù…Ø´ØªØ±ÙŠÙ†";
            else if (sellers > 60) label = "Ù‡ÙŠÙ…Ù†Ø© ÙˆØ§Ø¶Ø­Ø© Ù„Ù„Ø¨Ø§Ø¦Ø¹ÙŠÙ†";
            else label = "ØªÙˆØ§Ø²Ù† Ù†Ø³Ø¨Ù‰ Ø¨ÙŠÙ† Ø§Ù„Ù…Ø´ØªØ±ÙŠÙ† ÙˆØ§Ù„Ø¨Ø§Ø¦Ø¹ÙŠÙ†";

            return { buyers, sellers, label };
        }

        function estimateShortTermBias(change, volScore, strengthLabel) {
            const absChange = Math.abs(change);
            let up = 50, down = 50;
            if (change > 0) {
                up += absChange * 3;
                if (strengthLabel.includes("ØµØ¹ÙˆØ¯") || strengthLabel.includes("Ø¥ÙŠØ¬Ø§Ø¨Ù‰")) up += 7;
            } else if (change < 0) {
                down += absChange * 3;
                if (strengthLabel.includes("Ù‡Ø¨ÙˆØ·") || strengthLabel.includes("Ø³Ù„Ø¨Ù‰")) down += 7;
            }
            if (volScore > 65) {
                up = up * 1.05;
                down = down * 1.05;
            }
            const sum = up + down;
            up = Math.round((up / sum) * 100);
            down = 100 - up;

            let biasText;
            if (up - down > 15) biasText = "Ù…ÙŠÙ„ Ù‚ØµÙŠØ± Ø§Ù„Ù…Ø¯Ù‰ Ù„ØµØ§Ù„Ø­ Ø§Ù„ØµØ¹ÙˆØ¯";
            else if (down - up > 15) biasText = "Ù…ÙŠÙ„ Ù‚ØµÙŠØ± Ø§Ù„Ù…Ø¯Ù‰ Ù„ØµØ§Ù„Ø­ Ø§Ù„Ù‡Ø¨ÙˆØ·";
            else biasText = "ØªØ°Ø¨Ø°Ø¨ Ù‚ØµÙŠØ± Ø§Ù„Ù…Ø¯Ù‰ Ø¨Ø¯ÙˆÙ† Ø§Ù†Ø­ÙŠØ§Ø² ÙˆØ§Ø¶Ø­";

            return { up, down, biasText };
        }

        function estimateNoise(change, volScore, rangePct) {
            const absChange = Math.abs(change);
            let noise = volScore * 0.6 + rangePct * 0.5 - absChange * 1.2;
            if (noise < 0) noise = 0;
            if (noise > 100) noise = 100;

            let label;
            if (noise < 25) label = "Ø§Ù„Ø¶ÙˆØ¶Ø§Ø¡ Ù…Ù†Ø®ÙØ¶Ø©Ø› Ø§Ù„Ø­Ø±ÙƒØ© ÙˆØ§Ø¶Ø­Ø© Ù†Ø³Ø¨ÙŠÙ‹Ø§.";
            else if (noise < 55) label = "Ø¶ÙˆØ¶Ø§Ø¡ Ù…ØªÙˆØ³Ø·Ø©Ø› ÙŠÙØ¶Ù„ Ø§Ù†ØªØ¸Ø§Ø± ØªØ£ÙƒÙŠØ¯ Ù‚Ø¨Ù„ Ø§Ù„Ø¯Ø®ÙˆÙ„.";
            else label = "Ø¶ÙˆØ¶Ø§Ø¡ Ø¹Ø§Ù„ÙŠØ© Ø¬Ø¯Ù‹Ø§Ø› Ø§Ù„Ø£ÙØ¶Ù„ ØªØ¬Ù†Ø¨ Ø§Ù„Ù…Ø·Ø§Ø±Ø¯Ø© ÙˆØ§Ù„Ø§Ù„ØªØ²Ø§Ù… Ø¨Ø§Ù„Ù…Ù†Ø§Ø·Ù‚ Ø§Ù„Ù‚ÙˆÙŠØ© ÙÙ‚Ø·.";

            return { noise: Math.round(noise), label };
        }

        function estimateScalperSuitability(volScore, noiseScore, rangePct) {
            let score = volScore * 0.7 + rangePct * 2 - noiseScore * 0.5;
            if (score < 0) score = 0;
            if (score > 100) score = 100;

            let label;
            if (score < 35) label = "ğŸ˜´ ØºÙŠØ± Ù…Ù†Ø§Ø³Ø¨ Ù„Ù„Ø³ÙƒØ§Ù„Ø¨ÙŠÙ†Ø¬ â€” Ø§Ù„Ø³ÙˆÙ‚ Ù‡Ø§Ø¯Ø¦ Ø£Ùˆ Ø¶ÙˆØ¶Ø§Ø¦Ù‰ Ø£ÙƒØ«Ø± Ù…Ù† Ø§Ù„Ù„Ø§Ø²Ù….";
            else if (score < 70) label = "âš–ï¸ Ù…Ù†Ø§Ø³Ø¨ Ø¬Ø²Ø¦ÙŠÙ‹Ø§ Ù„Ù„Ø³ÙƒØ§Ù„Ø¨ÙŠÙ†Ø¬ Ù…Ø¹ Ø§Ù†ØªÙ‚Ø§Ø¡ Ø§Ù„ÙØ±ØµØŒ ÙˆÙŠÙØ¶Ù„ Ø§Ù„Ø§Ù„ØªØ²Ø§Ù… Ø¨Ù…Ù†Ø§Ø·Ù‚ ÙˆØ§Ø¶Ø­Ø©.";
            else label = "âš¡ Ø¨ÙŠØ¦Ø© Ù†Ø´Ø·Ø© Ø¬Ø¯Ù‹Ø§ â€” Ù…Ù†Ø§Ø³Ø¨Ø© Ù„Ù„Ø³ÙƒØ§Ù„Ø¨ÙŠÙ†Ø¬ Ù…Ø¹ Ø§Ù†Ø¶Ø¨Ø§Ø· Ù‚ÙˆÙ‰ ÙÙ‰ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø®Ø§Ø·Ø±.";

            return { score: Math.round(score), label };
        }

        function estimateDominance(change, liquidityLabel) {
            let label, text;
            if (Math.abs(change) < 0.8) {
                label = "Mixed Market / Ø³ÙˆÙ‚ Ù…Ø®ØªÙ„Ø·";
                text = "Ø§Ù„Ø­Ø±ÙƒØ© Ø§Ù„Ø­Ø§Ù„ÙŠØ© Ù„Ø§ ØªÙØ¸Ù‡Ø± Ù‡ÙŠÙ…Ù†Ø© Ø­Ø§Ø¯Ø© Ù„Ù„Ø¨ÙŠØªÙƒÙˆÙŠÙ†Ø› Ø§Ù„Ø³ÙˆÙ‚ ÙŠÙ…ÙŠÙ„ Ù„Ø£Ù† ÙŠÙƒÙˆÙ† Ù…Ø®ØªÙ„Ø·Ù‹Ø§ Ø¨ÙŠÙ† Ø§Ù„Ø¨ÙŠØªÙƒÙˆÙŠÙ† ÙˆØ§Ù„Ø¹Ù…Ù„Ø§Øª Ø§Ù„Ø¨Ø¯ÙŠÙ„Ø©.";
            } else if (change > 0 && liquidityLabel.includes("Ø§Ù„Ù…Ø´ØªØ±ÙŠÙ†")) {
                label = "BTC-Led / Ù‡ÙŠÙ…Ù†Ø© Ù„Ù„Ø¨ÙŠØªÙƒÙˆÙŠÙ†";
                text = "ØµØ¹ÙˆØ¯ Ø§Ù„Ø¨ÙŠØªÙƒÙˆÙŠÙ† Ù…Ø¹ Ù…ÙŠÙ„ Ø§Ù„Ø³ÙŠÙˆÙ„Ø© Ù„ØµØ§Ù„Ø­ Ø§Ù„Ù…Ø´ØªØ±ÙŠÙ† ÙŠØ´ÙŠØ± Ø¥Ù„Ù‰ Ø£Ù† Ø§Ù„Ø¨ÙŠØªÙƒÙˆÙŠÙ† ÙŠÙ‚ÙˆØ¯ Ø§Ù„Ù…Ø´Ù‡Ø¯ Ø§Ù„Ø­Ø§Ù„Ù‰ Ø¹Ù„Ù‰ Ø­Ø³Ø§Ø¨ Ø£ØºÙ„Ø¨ Ø§Ù„Ø¹Ù…Ù„Ø§Øª.";
            } else if (change < 0 && liquidityLabel.includes("Ø§Ù„Ø¨Ø§Ø¦Ø¹ÙŠÙ†")) {
                label = "BTC Risk-Off / Ø®Ø±ÙˆØ¬ Ù…Ù† Ø§Ù„Ù…Ø®Ø§Ø·Ø±";
                text = "Ø¶ØºØ· Ø¨ÙŠØ¹Ù‰ Ø¹Ù„Ù‰ Ø§Ù„Ø¨ÙŠØªÙƒÙˆÙŠÙ† Ù…Ø¹ Ù…ÙŠÙ„ Ø§Ù„Ø³ÙŠÙˆÙ„Ø© Ù„ØµØ§Ù„Ø­ Ø§Ù„Ø¨Ø§Ø¦Ø¹ÙŠÙ†Ø› Ø¹Ø§Ø¯Ø©Ù‹ Ù…Ø§ ÙŠÙƒÙˆÙ† Ù‡Ø°Ø§ Ù†Ù…Ø· Ø®Ø±ÙˆØ¬ Ø¹Ø§Ù… Ù…Ù† Ø§Ù„Ù…Ø®Ø§Ø·Ø±.";
            } else {
                label = "Alt-Friendly / Ø¨ÙŠØ¦Ø© ØªÙ…ÙŠÙ„ Ù„Ù„Ø¹Ù…Ù„Ø§Øª Ø§Ù„Ø¨Ø¯ÙŠÙ„Ø©";
                text = "Ø­Ø±ÙƒØ© Ø§Ù„Ø¨ÙŠØªÙƒÙˆÙŠÙ† Ø£Ù‚Ù„ Ø­Ø¯Ø© Ù†Ø³Ø¨ÙŠÙ‹Ø§ØŒ Ù…Ø§ ÙŠÙØªØ­ Ø§Ù„Ù…Ø¬Ø§Ù„ Ù„ÙØ±Øµ Ù…ØªÙØ±Ù‚Ø© ÙÙ‰ Ø¨Ø¹Ø¶ Ø§Ù„Ø¹Ù…Ù„Ø§Øª Ø§Ù„Ø¨Ø¯ÙŠÙ„Ø© (Ù…Ø¹ Ø¨Ù‚Ø§Ø¡ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø®Ø§Ø·Ø± Ø£Ø³Ø§Ø³ÙŠØ©).";
            }
            return { label, text };
        }

        function estimateTrendTemp(change, volScore) {
            const absChange = Math.abs(change);
            let temp = absChange * 6 + volScore * 0.8;
            if (temp > 100) temp = 100;

            let label;
            if (temp < 25) label = "â„ï¸ Ø§ØªØ¬Ø§Ù‡ Ø¨Ø§Ø±Ø¯ â€” Ø§Ù„Ø³ÙˆÙ‚ ÙŠØªØ­Ø±Ùƒ Ø¨Ø¨Ø·Ø¡ Ø¨Ø¯ÙˆÙ† Ø²Ø®Ù… ÙˆØ§Ø¶Ø­.";
            else if (temp < 55) label = "ğŸŒ¤ Ø§ØªØ¬Ø§Ù‡ Ù…Ø¹ØªØ¯Ù„ â€” Ø­Ø±ÙƒØ© Ù…Ø¹Ù‚ÙˆÙ„Ø© Ù…Ø¹ Ø²Ø®Ù… Ù‚Ø§Ø¨Ù„ Ù„Ù„Ù…ØªØ§Ø¨Ø¹Ø©.";
            else if (temp < 80) label = "ğŸ”¥ Ø§ØªØ¬Ø§Ù‡ Ø³Ø§Ø®Ù† â€” Ø­Ø±ÙƒØ© Ù‚ÙˆÙŠØ© ØªØ³ØªØ­Ù‚ Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø© Ù…Ø¹ Ø¥Ø¯Ø§Ø±Ø© Ù…Ø®Ø§Ø·Ø± Ù…Ø´Ø¯Ø¯Ø©.";
            else label = "â˜„ï¸ Ø§ØªØ¬Ø§Ù‡ Ù…Ø´ØªØ¹ÙÙ„ â€” Ø²Ø®Ù… Ø¹Ø§Ù„Ù‰ Ø¬Ø¯Ù‹Ø§ ÙˆØ§Ø­ØªÙ…Ø§Ù„ Ø­Ø±ÙƒØ§Øª Ø¹Ù†ÙŠÙØ© ÙÙ‰ Ø£Ù‰ Ù„Ø­Ø¸Ø©.";

            return { temp: Math.round(temp), label };
        }

        function computeSentimentIndex(change, volScore, rangePct) {
            let base = 50;
            base += change * 4;
            base += (rangePct - 3) * 1.2;
            base -= (volScore - 50) * 0.4;
            if (base < 0) base = 0;
            if (base > 100) base = 100;

            let label, zone;
            if (base < 20) { label = "ğŸ˜± Ø®ÙˆÙ Ø´Ø¯ÙŠØ¯"; zone = "Extreme Fear"; }
            else if (base < 40) { label = "ğŸ˜“ Ø­Ø°Ø± Ù…ÙŠÙ„ Ù„Ù„Ø®ÙˆÙ"; zone = "Fear"; }
            else if (base < 60) { label = "ğŸ˜ Ø­Ø§Ù„Ø© Ø·Ø¨ÙŠØ¹ÙŠØ©"; zone = "Neutral"; }
            else if (base < 80) { label = "ğŸ˜ Ø¬Ø´Ø¹ Ù…ØªØµØ§Ø¹Ø¯"; zone = "Greed"; }
            else { label = "ğŸ¤¯ Ø¬Ø´Ø¹ Ø¹Ø§Ù„Ù‰ Ø¬Ø¯Ù‹Ø§"; zone = "Extreme Greed"; }

            return { index: Math.round(base), label, zone };
        }

        function computeSystemHealth(lastErr, aa, riskLevel) {
            const hasError = lastErr && lastErr.message;
            const hasAlert =
                aa && aa.reason && aa.reason !== "no_alert" && aa.reason !== "duplicate";

            let status, text;
            if (!hasError && !hasAlert && riskLevel && riskLevel.includes("Ù…Ù†Ø®ÙØ¶")) {
                status = "ğŸŸ¢ Stable â€” Ø§Ù„Ù†Ø¸Ø§Ù… ÙŠØ¹Ù…Ù„ Ø¨Ø´ÙƒÙ„ Ø·Ø¨ÙŠØ¹Ù‰";
                text = "Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£Ø®Ø·Ø§Ø¡ Ù…Ø³Ø¬Ù„Ø© Ù…Ø¤Ø®Ø±Ù‹Ø§ØŒ ÙˆÙ„Ø§ ØªØ­Ø°ÙŠØ±Ø§Øª Ø¢Ù„ÙŠØ© Ù†Ø´Ø·Ø©ØŒ ÙˆÙ…Ø³ØªÙˆÙ‰ Ø§Ù„Ù…Ø®Ø§Ø·Ø± ÙÙ‰ Ø§Ù„Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø¢Ù…Ù†Ø©.";
            } else if (!hasError && !hasAlert) {
                status = "ğŸŸ¢ Stable (Ù…Ø¹ Ù…Ø±Ø§Ù‚Ø¨Ø©)";
                text = "Ø§Ù„Ù†Ø¸Ø§Ù… ÙŠØ¹Ù…Ù„ Ø¨Ø´ÙƒÙ„ Ø·Ø¨ÙŠØ¹Ù‰ØŒ Ù„ÙƒÙ† ÙŠÙˆØµÙ‰ Ø¨Ø§Ù„Ø§Ø³ØªÙ…Ø±Ø§Ø± ÙÙ‰ Ù…ØªØ§Ø¨Ø¹Ø© Ø­Ø§Ù„Ø© Ø§Ù„Ø³ÙˆÙ‚ Ø®ØµÙˆØµÙ‹Ø§ Ù…Ø¹ Ø§Ù„ØªØºÙŠØ±Ø§Øª Ø§Ù„Ø£Ø®ÙŠØ±Ø©.";
            } else if (hasError && !hasAlert) {
                status = "ğŸŸ¡ Degraded â€” Ø§Ù„Ù†Ø¸Ø§Ù… ÙŠØ¹Ù…Ù„ Ù„ÙƒÙ† ÙŠÙˆØ¬Ø¯ Ø£Ø®Ø·Ø§Ø¡ Ø¨Ø³ÙŠØ·Ø©";
                text = "ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø®Ø·Ø£ ÙˆØ§Ø­Ø¯ Ø£Ùˆ Ø£ÙƒØ«Ø± ÙÙ‰ Ø§Ù„Ø®Ù„ÙÙŠØ©ØŒ Ù„ÙƒÙ† Ø§Ù„Ù…Ø­Ø±Ùƒ Ù…Ø§ Ø²Ø§Ù„ ÙŠØ¹Ù…Ù„. ÙŠÙØ¶Ù„ Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„Ù„ÙˆØ¬ ÙˆØ§Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø¹Ø¯Ù… ØªÙƒØ±Ø§Ø± Ø§Ù„Ø£Ø®Ø·Ø§Ø¡.";
            } else if (!hasError && hasAlert) {
                status = "ğŸŸ  Alerting â€” Ø§Ù„Ø³ÙˆÙ‚ ÙŠØ­ØªØ§Ø¬ Ø§Ù†ØªØ¨Ø§Ù‡";
                text = "Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£Ø®Ø·Ø§Ø¡ ØªÙ‚Ù†ÙŠØ©ØŒ Ù„ÙƒÙ† Ù†Ø¸Ø§Ù… Ø§Ù„ØªØ­Ø°ÙŠØ± Ø§Ù„Ø¢Ù„Ù‰ ÙŠÙ„ØªÙ‚Ø· Ø£Ù†Ù…Ø§Ø· ØºÙŠØ± Ù…Ø±ÙŠØ­Ø© ÙÙ‰ Ø§Ù„Ø³ÙˆÙ‚. ÙŠÙ†ØµØ­ Ø¨ØªØ®ÙÙŠÙ Ø§Ù„Ù…Ø®Ø§Ø·Ø±.";
            } else {
                status = "ğŸ”´ Attention â€” Ø£Ø®Ø·Ø§Ø¡ + ØªØ­Ø°ÙŠØ±Ø§Øª Ù†Ø´Ø·Ø©";
                text = "Ù‡Ù†Ø§Ùƒ Ø£Ø®Ø·Ø§Ø¡ ØªÙ‚Ù†ÙŠØ© Ù…Ø¹ ØªÙØ¹ÙŠÙ„ ØªØ­Ø°ÙŠØ±Ø§Øª Ø¢Ù„ÙŠØ©Ø› ÙŠÙˆØµÙ‰ Ø¨Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„Ù†Ø¸Ø§Ù… ÙÙˆØ±Ù‹Ø§ Ù‚Ø¨Ù„ Ø§Ù„Ø§Ø¹ØªÙ…Ø§Ø¯ Ø¹Ù„ÙŠÙ‡ ÙÙ‰ Ù‚Ø±Ø§Ø±Ø§Øª ÙƒØ¨ÙŠØ±Ø©.";
            }
            return { status, text };
        }

        // === Real-Time Engine helpers ===
        function computeRealtimeMomentum(change, volScore, strengthLabel) {
            const absChange = Math.abs(change);
            let score = absChange * 5 + volScore * 0.6;
            if (strengthLabel && (strengthLabel.includes("Ù‚ÙˆØ©") || strengthLabel.includes("Ù‚ÙˆÙ‰"))) {
                score += 8;
            }
            if (score > 100) score = 100;
            if (score < 0) score = 0;

            let label;
            if (score < 25) label = "Ø²Ø®Ù… Ø¶Ø¹ÙŠÙ";
            else if (score < 55) label = "Ø²Ø®Ù… Ù…ØªÙˆØ³Ø·";
            else if (score < 80) label = "Ø²Ø®Ù… Ù‚ÙˆÙ‰";
            else label = "Ø²Ø®Ù… Ø¹Ù†ÙŠÙ";

            return { score: Math.round(score), label };
        }

        function computeShockScore(change, volScore, rangePct) {
            const absChange = Math.abs(change);
            let shock = volScore * 0.7 + rangePct * 0.8 + absChange * 1.5;
            if (shock > 100) shock = 100;
            if (shock < 0) shock = 0;

            let label;
            if (shock < 30) label = "Ù‡Ø§Ø¯Ø¦";
            else if (shock < 60) label = "Ù…ØªØ­Ø±Ùƒ";
            else if (shock < 80) label = "ØªÙˆØªØ± Ù…Ø±ØªÙØ¹";
            else label = "ØµØ¯Ù…Ø© Ù…Ø­ØªÙ…Ù„Ø©";

            return { shock: Math.round(shock), label };
        }

        function buildAIComment(change, volScore, riskMsg, riskLevel, liquidityPulse, strengthLabel, modeInfo) {
            const dirText =
                change > 0.7 ? "Ø§Ù„Ø³ÙˆÙ‚ ÙŠÙ…ÙŠÙ„ Ø­Ø§Ù„ÙŠÙ‹Ø§ Ù„ØµØ§Ù„Ø­ Ø§Ù„Ù…Ø´ØªØ±ÙŠÙ† Ù…Ø¹ ØµØ¹ÙˆØ¯ Ù…Ù„Ø­ÙˆØ¸ ÙÙ‰ Ø§Ù„Ø¨ÙŠØªÙƒÙˆÙŠÙ†." :
                change < -0.7 ? "Ø§Ù„Ø³ÙˆÙ‚ ÙŠÙ…ÙŠÙ„ Ø­Ø§Ù„ÙŠÙ‹Ø§ Ù„ØµØ§Ù„Ø­ Ø§Ù„Ø¨Ø§Ø¦Ø¹ÙŠÙ† Ù…Ø¹ Ø¶ØºØ· Ø¨ÙŠØ¹Ù‰ ÙˆØ§Ø¶Ø­ Ø¹Ù„Ù‰ Ø§Ù„Ø¨ÙŠØªÙƒÙˆÙŠÙ†." :
                "Ø§Ù„Ø³ÙˆÙ‚ ÙŠØªØ­Ø±Ùƒ Ø¨ØªØ°Ø¨Ø°Ø¨ Ù…Ø­Ø¯ÙˆØ¯ Ù†Ø³Ø¨ÙŠÙ‹Ø§ Ø¨Ø¯ÙˆÙ† Ø§ØªØ¬Ø§Ù‡ Ø­Ø§Ø³Ù… Ø­ØªÙ‰ Ø§Ù„Ø¢Ù†.";

            const volText =
                volScore < 25 ? "Ø¯Ø±Ø¬Ø© Ø§Ù„ØªÙ‚Ù„Ø¨ Ù…Ø§ Ø²Ø§Ù„Øª Ù‡Ø§Ø¯Ø¦Ø© Ù†Ø³Ø¨ÙŠÙ‹Ø§ØŒ Ù…Ø§ ÙŠØ¹Ø·Ù‰ Ù…Ø³Ø§Ø­Ø© Ø£ÙØ¶Ù„ Ù„Ù„ØªØ®Ø·ÙŠØ· Ù‚Ø¨Ù„ Ø§Ù„Ø¯Ø®ÙˆÙ„." :
                volScore < 55 ? "Ø§Ù„ØªÙ‚Ù„Ø¨ ÙÙ‰ Ø§Ù„Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ù…ØªÙˆØ³Ø·Ø©ØŒ Ø§Ù„Ø­Ø±ÙƒØ© Ù„ÙŠØ³Øª Ø¹Ù†ÙŠÙØ© Ù„ÙƒÙ† Ù„ÙŠØ³Øª Ù‡Ø§Ø¯Ø¦Ø© ØªÙ…Ø§Ù…Ù‹Ø§." :
                "Ø§Ù„ØªÙ‚Ù„Ø¨ Ù…Ø±ØªÙØ¹ Ø­Ø§Ù„ÙŠÙ‹Ø§Ø› Ø£Ù‰ Ù‚Ø±Ø§Ø± Ø¯Ø®ÙˆÙ„ Ø¨Ø¯ÙˆÙ† Ø®Ø·Ø© ØµØ§Ø±Ù…Ø© Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø®Ø§Ø·Ø± Ù‚Ø¯ ÙŠÙƒÙˆÙ† Ù…ÙƒÙ„ÙÙ‹Ø§.";

            const riskText = `Ù‚Ø±Ø§Ø¡Ø© Engine Ø§Ù„Ù…Ø®Ø§Ø·Ø±: ${riskMsg || "Ù„Ù… ÙŠØªÙ… ØªØ­Ø¯ÙŠØ¯ Ø±Ø³Ø§Ù„Ø© Ù…ÙØµÙ„Ø©."}`;

            const liqText =
                liquidityPulse && liquidityPulse.indexOf("Ù…ØªÙˆØ§Ø²Ù†Ø©") !== -1
                    ? "Ù†Ø¨Ø¶ Ø§Ù„Ø³ÙŠÙˆÙ„Ø© ÙŠØ´ÙŠØ± Ø¥Ù„Ù‰ ØªÙˆØ§Ø²Ù† ØªÙ‚Ø±ÙŠØ¨Ù‰ Ø¨ÙŠÙ† Ø§Ù„Ù…Ø´ØªØ±ÙŠÙ† ÙˆØ§Ù„Ø¨Ø§Ø¦Ø¹ÙŠÙ†."
                    : `Ù†Ø¨Ø¶ Ø§Ù„Ø³ÙŠÙˆÙ„Ø© Ø§Ù„Ø­Ø§Ù„Ù‰: ${liquidityPulse || "ØºÙŠØ± Ù…ØªÙˆÙØ±"}.`;

            const modeText = `ØªØµÙ†ÙŠÙ Ù†Ù…Ø· Ø§Ù„Ø³ÙˆÙ‚ Ø§Ù„Ø­Ø§Ù„Ù‰: <b>${modeInfo.mode}</b> â€” ${modeInfo.label}.`;

            return (
                dirText + " " +
                volText + " " +
                riskText + " " +
                liqText + " " +
                modeText +
                " Ø¯Ø§Ø¦Ù…Ù‹Ø§ ØªØ°ÙƒØ± Ø£Ù† Ù‡Ø°Ù‡ Ø§Ù„Ù‚Ø±Ø§Ø¡Ø© ØªØ¹Ù„ÙŠÙ…ÙŠØ© ÙˆÙ„ÙŠØ³Øª ØªÙˆØµÙŠØ© Ù…Ø¨Ø§Ø´Ø±Ø© Ø¨Ø§Ù„Ø´Ø±Ø§Ø¡ Ø£Ùˆ Ø§Ù„Ø¨ÙŠØ¹."
            );
        }

        function renderHeatmap(change, volScore, rangePct) {
            const grid = document.getElementById("heatmapGrid");
            if (!grid) return;

            const base = change;
            const cells = [
                { symbol: "MAJORS", name: "Top Caps", mult: 1.1 },
                { symbol: "DEFI",   name: "DeFi Basket", mult: 1.4 },
                { symbol: "AI",     name: "AI / Tech", mult: 1.6 },
                { symbol: "MEME",   name: "High Beta", mult: 2.0 },
                { symbol: "L1",     name: "L1 Basket", mult: 1.3 },
                { symbol: "L2",     name: "L2 / Scaling", mult: 1.5 },
                { symbol: "NFT",    name: "NFT / Metaverse", mult: 1.7 },
                { symbol: "STBL",   name: "Stable / Yield", mult: 0.3 },
            ];

            const html = cells.map(c => {
                let est = base * c.mult;
                est += (rangePct - 3) * 0.15;
                est += (volScore - 50) * 0.03;
                if (est > 12) est = 12;
                if (est < -12) est = -12;
                const cls = est >= 0 ? "green" : "red";
                const sign = est >= 0 ? "+" : "";
                return `
                    <div class="heatmap-cell">
                        <div class="heatmap-symbol">${c.symbol}</div>
                        <div class="heatmap-change ${cls}">
                            ${sign}${est.toFixed(1)}Ùª
                        </div>
                    </div>
                `;
            }).join("");

            grid.innerHTML = html;
        }

        async function loadMain() {
            try {
                const res = await fetch(apiUrl("/dashboard_api"));
                const data = await res.json();
                if (!data.ok) return;

                const price = data.price;
                const change = data.change_pct;
                const rangePct = data.range_pct;
                const volScore = data.volatility_score;
                const riskLevel = data.risk_level;
                const riskEmoji = data.risk_emoji;
                const riskMsg = data.risk_message;
                const liquidityPulse = data.liquidity_pulse;
                const strengthLabel = data.strength_label;

                // HEADER BADGES
                document.getElementById("badgeChats").textContent = data.known_chats ?? 0;
                document.getElementById("badgeRealtime").textContent = data.last_realtime_tick || "Ù„Ø§ ÙŠÙˆØ¬Ø¯";

                // TOP BTC BAR
                const barPrice = document.getElementById("barPrice");
                const barChange = document.getElementById("barChange");
                const barRange = document.getElementById("barRange");
                const modeChip = document.getElementById("marketModeChip");

                const changeColorClass = change >= 0 ? "btc-green" : "btc-red";

                barPrice.innerHTML = price.toLocaleString();
                barChange.innerHTML = `<span class="${changeColorClass}">${change >= 0 ? "+" : ""}${change.toFixed(2)}%</span>`;
                barRange.textContent = rangePct.toFixed(2) + "%";

                const modeInfo = classifyMarketMode(change, volScore, rangePct);
                modeChip.textContent = modeInfo.mode + " MODE";
                document.getElementById("badgeMode").textContent = modeInfo.mode;

                if (modeInfo.mode === "PANIC") {
                    modeChip.style.background = "radial-gradient(circle at top, #ef4444, #7f1d1d)";
                } else if (modeInfo.mode === "VOLATILE") {
                    modeChip.style.background = "radial-gradient(circle at top, #f97316, #7c2d12)";
                } else if (modeInfo.mode === "ACTIVE") {
                    modeChip.style.background = "radial-gradient(circle at top, #22c55e, #064e3b)";
                } else {
                    modeChip.style.background =
                        "radial-gradient(circle at top, rgba(251,191,36,0.35), #020617)";
                }

                // MARKET STRENGTH
                document.getElementById("strengthValue").textContent = strengthLabel;
                document.getElementById("kpiChange").textContent =
                    (change >= 0 ? "+" : "") + change.toFixed(2) + "%";
                document.getElementById("kpiRange").textContent = rangePct.toFixed(2) + "%";

                const heatScore = computeHeatScore(change, volScore, rangePct);
                document.getElementById("kpiHeat").textContent = heatScore.toFixed(0) + " / 100";

                const heatDot = document.getElementById("heatDot");
                heatDot.style.left = Math.min(96, Math.max(4, heatScore)) + "%";

                // RISK CARD
                const riskCard = document.getElementById("riskCard");
                const riskVal = document.getElementById("riskValue");
                const riskNote = document.getElementById("riskNote");
                const kpiMode = document.getElementById("kpiMode");
                const kpiVol = document.getElementById("kpiVol");

                riskVal.innerHTML = riskEmoji + " " + riskLevel;
                riskNote.textContent = riskMsg;
                kpiVol.textContent = volScore.toFixed(1) + " / 100";
                kpiMode.textContent = modeInfo.label;

                riskCard.classList.remove("green", "gold", "red");
                if (riskLevel.includes("Ù…Ù†Ø®ÙØ¶")) riskCard.classList.add("green");
                else if (riskLevel.includes("Ù…ØªÙˆØ³Ø·")) riskCard.classList.add("gold");
                else riskCard.classList.add("red");

                // LIQUIDITY
                document.getElementById("liquidityValue").textContent = liquidityPulse;
                const liqLabel =
                    change > 0 ? "Ù…ÙŠÙ„ Ù„ØµØ§Ù„Ø­ Ø§Ù„Ù…Ø´ØªØ±ÙŠÙ†" :
                    change < 0 ? "Ù…ÙŠÙ„ Ù„ØµØ§Ù„Ø­ Ø§Ù„Ø¨Ø§Ø¦Ø¹ÙŠÙ†" :
                    "Ù…ØªÙˆØ§Ø²Ù†Ø© ØªÙ‚Ø±ÙŠØ¨Ù‹Ø§";
                document.getElementById("liqLabel").textContent = liqLabel;
                document.getElementById("signalPulse").textContent =
                    buildSignalPulse(change, volScore);

                // VOLATILITY
                document.getElementById("volatilityValue").textContent =
                    volScore.toFixed(1);
                document.getElementById("rangeDetail").textContent =
                    rangePct.toFixed(2) + "%";
                document.getElementById("volatilityLabel").textContent =
                    classifyVolatility(volScore);

                // LAST ERROR
                const lastErr = data.last_error || {};
                const errTitle = document.getElementById("lastErrorTitle");
                const errCard = document.getElementById("errorCard");

                if (lastErr && lastErr.message) {
                    errTitle.textContent = "Ø¢Ø®Ø± Ø®Ø·Ø£ â€” " + (lastErr.time || "");
                    errCard.classList.add("gold");
                } else {
                    errTitle.textContent = "Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø£Ø®Ø·Ø§Ø¡ Ù…Ø³Ø¬Ù„Ø©";
                    errCard.classList.remove("gold");
                }

                // AUTO ALERT
                const aa = data.last_auto_alert || {};
                const alertCard = document.getElementById("alertFlashCard");
                document.getElementById("alertReason").textContent =
                    aa.reason || "Ù„Ø§ ÙŠÙˆØ¬Ø¯ ØªØ­Ø°ÙŠØ± Ø­Ø§Ù„ÙŠÙ‹Ø§";
                document.getElementById("alertTime").textContent =
                    aa.time || "---";
                document.getElementById("alertSent").textContent =
                    aa.sent === true ? "Ù†Ø¹Ù… âœ…" :
                        aa.sent === false ? "Ù„Ø§ âŒ" : "---";

                if (aa.reason && aa.reason !== "no_alert" && aa.reason !== "duplicate") {
                    alertCard.classList.add("flash");
                } else {
                    alertCard.classList.remove("flash");
                }

                // ORDER FLOW
                const of = estimateOrderFlow(change, volScore, liqLabel);
                document.getElementById("orderFlowValue").textContent = of.label;
                document.getElementById("buyersShare").textContent = of.buyers.toFixed(0) + "Ùª";
                document.getElementById("sellersShare").textContent = of.sellers.toFixed(0) + "Ùª";

                // SHORT TERM BIAS
                const st = estimateShortTermBias(change, volScore, strengthLabel);
                document.getElementById("shortTermBias").textContent = st.biasText;
                document.getElementById("upProb").textContent = st.up + "Ùª";
                document.getElementById("downProb").textContent = st.down + "Ùª";

                // NOISE
                const nf = estimateNoise(change, volScore, rangePct);
                document.getElementById("noiseValue").textContent = nf.noise + " / 100";
                document.getElementById("noiseScore").textContent = nf.noise + " / 100";
                document.getElementById("noiseText").textContent = nf.label;

                // SCALPER MODE
                const sc = estimateScalperSuitability(volScore, nf.noise, rangePct);
                document.getElementById("scalpSuitability").textContent =
                    sc.score + " / 100";
                document.getElementById("scalpText").textContent = sc.label;

                // DOMINANCE
                const dom = estimateDominance(change, liqLabel);
                document.getElementById("dominanceValue").textContent = dom.label;
                document.getElementById("dominanceText").textContent = dom.text;

                // TREND TEMP
                const tt = estimateTrendTemp(change, volScore);
                document.getElementById("trendTempValue").textContent =
                    tt.temp + " / 100";
                document.getElementById("trendTempText").textContent = tt.label;

                // SENTIMENT
                const sent = computeSentimentIndex(change, volScore, rangePct);
                document.getElementById("sentimentIndex").textContent =
                    sent.index + " / 100";
                document.getElementById("sentimentLabel").textContent = sent.label;
                const pointer = document.getElementById("sentimentPointer");
                pointer.style.left = Math.min(96, Math.max(4, sent.index)) + "%";
                const badge = document.getElementById("sentimentBadge");
                badge.title = sent.zone;

                // HEATMAP
                renderHeatmap(change, volScore, rangePct);

                // SYSTEM HEALTH
                const sh = computeSystemHealth(lastErr, aa, riskLevel);
                document.getElementById("systemHealthValue").textContent = sh.status;
                document.getElementById("systemHealthText").textContent = sh.text;
                document.getElementById("systemLastError").textContent =
                    lastErr && lastErr.time ? lastErr.time : "Ù„Ø§ ÙŠÙˆØ¬Ø¯";
                document.getElementById("systemLastAlert").textContent =
                    aa && aa.time ? aa.time : "Ù„Ø§ ÙŠÙˆØ¬Ø¯";

                // REAL-TIME ENGINE
                const rt = computeRealtimeMomentum(change, volScore, strengthLabel);
                const shock = computeShockScore(change, volScore, rangePct);

                document.getElementById("rtMomentumValue").textContent = rt.score + " / 100";
                document.getElementById("rtMomentumLabel").textContent = rt.label;

                const pressureLabel =
                    of.buyers > 60 ? "Ø¶ØºØ· Ø§Ù„Ù…Ø´ØªØ±ÙŠÙ†" :
                    of.sellers > 60 ? "Ø¶ØºØ· Ø§Ù„Ø¨Ø§Ø¦Ø¹ÙŠÙ†" :
                    "Ø¶ØºØ· Ù…ØªÙˆØ§Ø²Ù† Ù†Ø³Ø¨ÙŠÙ‹Ø§";
                document.getElementById("rtPressureLabel").textContent = pressureLabel;

                document.getElementById("rtShockLabel").textContent = shock.label;

                const rtText = (() => {
                    if (rt.score < 25) return "Ø²Ø®Ù… Ø¶Ø¹ÙŠÙØŒ Ø§Ù„Ø­Ø±ÙƒØ© Ø§Ù„Ø­Ø§Ù„ÙŠØ© Ø£Ù‚Ø±Ø¨ Ù„Ù„Ø§Ø®ØªØ¨Ø§Ø± ÙˆØ§Ù„ØªØ°Ø¨Ø°Ø¨ Ø§Ù„Ø®ÙÙŠÙ Ø¹Ù† Ø§ØªØ¬Ø§Ù‡ ÙˆØ§Ø¶Ø­.";
                    if (rt.score < 55) return "Ø²Ø®Ù… Ù…ØªÙˆØ³Ø·ØŒ ÙŠÙ…ÙƒÙ† Ø§Ø³ØªØºÙ„Ø§Ù„ Ø§Ù„Ø­Ø±ÙƒØ§Øª Ù„ÙƒÙ† Ù…Ø¹ ØµØ¨Ø± Ø¹Ù„Ù‰ Ø§Ù„ØªØ£ÙƒÙŠØ¯.";
                    if (rt.score < 80) return "Ø²Ø®Ù… Ù‚ÙˆÙ‰ØŒ Ø§Ù„Ø§ØªØ¬Ø§Ù‡ Ø§Ù„Ø­Ø§Ù„Ù‰ ÙŠØ³ØªØ­Ù‚ Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø© Ø§Ù„Ø¯Ù‚ÙŠÙ‚Ø© Ù…Ø¹ Ø§Ù„ØªØ²Ø§Ù… ØµØ§Ø±Ù… Ø¨Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø®Ø§Ø·Ø±.";
                    return "Ø²Ø®Ù… Ø¹Ù†ÙŠÙØŒ Ø£Ù‰ Ù‚Ø±Ø§Ø± Ø¨Ø¯ÙˆÙ† Ø®Ø·Ø© Ø¥Ø¯Ø§Ø±Ø© Ù…Ø®Ø§Ø·Ø± ÙˆØ§Ø¶Ø­Ø© Ù‚Ø¯ ÙŠÙƒÙˆÙ† Ù…Ø®Ø§Ø·Ø±Ø© ÙƒØ¨ÙŠØ±Ø©.";
                })();
                document.getElementById("rtMomentumText").textContent = rtText;

                // Bars
                const mBar = document.getElementById("rtMomentumBar");
                const sBar = document.getElementById("rtShockBar");
                if (mBar) mBar.style.width = Math.min(100, Math.max(5, rt.score)) + "%";
                if (sBar) sBar.style.width = Math.min(100, Math.max(5, shock.shock)) + "%";

                // AI COMMENT
                const comment = buildAIComment(
                    change,
                    volScore,
                    riskMsg,
                    riskLevel,
                    liquidityPulse,
                    strengthLabel,
                    modeInfo
                );
                document.getElementById("aiComment").innerHTML = comment;

            } catch (e) {
                console.log("Dashboard Error:", e);
            }
        }

        async function loadLogs() {
            try {
                const res = await fetch(apiUrl("/admin/logs"));
                if (!res.ok) return;
                const txt = await res.text();
                document.getElementById("logsSnapshot").textContent =
                    txt || "Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù„ÙˆØ¬Ø§Øª Ø­ØªÙ‰ Ø§Ù„Ø¢Ù†.";
            } catch (e) {
                console.log("Logs error:", e);
            }
        }

        async function reloadAlerts() {
            try {
                const res = await fetch(apiUrl("/admin/alerts_history"));
                const data = await res.json();
                const container = document.getElementById("alertsList");

                if (!data.ok) {
                    container.textContent = "Ù„Ø§ ÙŠÙ…ÙƒÙ† ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø³Ø¬Ù„ Ø§Ù„Ø¢Ù†.";
                    return;
                }

                const list = data.alerts || [];
                if (!list.length) {
                    container.textContent = "Ù„Ø§ ØªÙˆØ¬Ø¯ ØªØ­Ø°ÙŠØ±Ø§Øª Ù…Ø³Ø¬Ù„Ø© Ø¨Ø¹Ø¯.";
                    return;
                }

                const items = list.slice().reverse().map(a => {
                    const changeStr = a.change_pct != null
                        ? ` (Î” ${a.change_pct.toFixed(2)}Ùª)`
                        : "";
                    return `
                        <div class="alert-item">
                            â€¢ [${a.time || "?"}] ${a.source || "?"} â€” ${a.reason || ""}${changeStr}
                        </div>
                    `;
                }).join("");

                container.innerHTML = items;
            } catch (e) {
                console.log("Alerts error:", e);
            }
        }

        async function clearAlerts() {
            if (!confirm("Ù…ØªØ£ÙƒØ¯ Ø¥Ù†Ùƒ Ø¹Ø§ÙŠØ² ØªÙ…Ø³Ø­ Ø³Ø¬Ù„ Ø§Ù„ØªØ­Ø°ÙŠØ±Ø§Øª Ø¨Ø§Ù„ÙƒØ§Ù…Ù„ØŸ")) return;
            try {
                const res = await fetch(apiUrl("/admin/clear_alerts"));
                const data = await res.json();
                alert(data.message || "ØªÙ….");
                reloadAlerts();
            } catch (e) {
                console.log("clearAlerts error:", e);
            }
        }

        async function callAdmin(action) {
            try {
                const res = await fetch(apiUrl("/admin/" + action));
                const data = await res.json();
                alert(data.message || JSON.stringify(data));
            } catch (e) {
                console.log("admin action error:", e);
            }
        }

        // Ø£ÙˆÙ„ ØªØ­Ù…ÙŠÙ„
        loadMain();
        loadLogs();
        reloadAlerts();

        // ØªØ­Ø¯ÙŠØ«Ø§Øª Ø¯ÙˆØ±ÙŠØ©
        setInterval(loadMain, 10000);      // Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø³ÙˆÙ‚
        setInterval(loadLogs, 30000);      // Snapshot Ø§Ù„Ù„ÙˆØ¬
        setInterval(reloadAlerts, 60000);  // Ø³Ø¬Ù„ Ø§Ù„ØªØ­Ø°ÙŠØ±Ø§Øª
    </script>
</body>
</html>
