<!DOCTYPE html>
<html lang="ar" dir="rtl">

<head>
    <meta charset="UTF-8" />
    <title>IN CRYPTO AI â€” Dashboard</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <!-- GOOGLE FONTS -->
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap');

        body {
            font-family: 'Cairo', sans-serif;
            margin: 0;
            padding: 0;
            background: #0b0f19;
            color: #fff;
        }

        /* ===== TOP BTC BAR ===== */
        .btc-bar {
            width: 100%;
            padding: 15px 25px;
            background: linear-gradient(90deg, #111827, #1f2937);
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 20px;
            font-weight: 700;
            border-bottom: 2px solid #1e293b;
        }

        .btc-green {
            color: #00ff9d;
        }

        .btc-red {
            color: #ff5c5c;
        }

        /* ===== CONTAINER ===== */
        .container {
            padding: 25px;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(330px, 1fr));
            gap: 20px;
        }

        /* ===== CARD ===== */
        .card {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.12);
            padding: 22px;
            border-radius: 16px;
            box-shadow: 0 0 18px rgba(0, 255, 255, 0.1);
            backdrop-filter: blur(9px);
            transition: 0.2s;
        }

        .card:hover {
            transform: translateY(-4px);
            box-shadow: 0 0 28px rgba(0, 255, 255, 0.2);
        }

        .title {
            font-size: 20px;
            font-weight: 700;
            margin-bottom: 12px;
            color: #6ee7ff;
        }

        /* ===== ALERT FLASH ===== */
        .flash {
            animation: flashAnim 0.9s infinite alternate;
        }

        @keyframes flashAnim {
            from {
                box-shadow: 0 0 18px red;
                border-color: red;
            }

            to {
                box-shadow: 0 0 28px yellow;
                border-color: yellow;
            }
        }

        /* ===== RISK COLORS ===== */
        .risk-low {
            color: #00ff9d;
        }

        .risk-medium {
            color: #ffe152;
        }

        .risk-high {
            color: #ff5c5c;
        }

        .value {
            font-size: 26px;
            margin-top: 10px;
            font-weight: 700;
        }

        .note {
            margin-top: 8px;
            font-size: 15px;
            opacity: 0.8;
        }

        /* ===== MINI STATUS BADGE ===== */
        .badge {
            padding: 5px 12px;
            border-radius: 8px;
            font-size: 13px;
            font-weight: 700;
            display: inline-block;
            margin-top: 7px;
        }

        .badge-green {
            background: rgba(0, 255, 155, 0.15);
            color: #00ff9d;
        }

        .badge-red {
            background: rgba(255, 0, 0, 0.15);
            color: #ff5c5c;
        }

        .badge-yellow {
            background: rgba(255, 255, 0, 0.15);
            color: #ffe152;
        }
    </style>
</head>

<body>

    <!-- ===== BTC LIVE BAR ===== -->
    <div id="btcBar" class="btc-bar">Ø¬Ø§Ø±Ù‰ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</div>

    <!-- ===== DASHBOARD CARDS ===== -->
    <div class="container">

        <div class="card" id="marketStrength">
            <div class="title">Ù‚ÙˆØ© Ø§Ù„Ø³ÙˆÙ‚</div>
            <div class="value" id="strengthValue">...</div>
        </div>

        <div class="card" id="riskCard">
            <div class="title">Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ù…Ø®Ø§Ø·Ø±</div>
            <div class="value" id="riskValue">...</div>
            <div class="note" id="riskNote"></div>
        </div>

        <div class="card">
            <div class="title">Ø§Ù„ØªÙ‚Ù„Ø¨ Ø§Ù„ÙŠÙˆÙ…Ù‰</div>
            <div class="value" id="volatilityValue">...</div>
        </div>

        <div class="card">
            <div class="title">Ø§Ù„Ø³ÙŠÙˆÙ„Ø©</div>
            <div class="value" id="liquidityValue">...</div>
        </div>

        <div class="card">
            <div class="title">Ø¢Ø®Ø± Ø®Ø·Ø£</div>
            <div class="value" id="lastError">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø£Ø®Ø·Ø§Ø¡</div>
        </div>

        <div class="card" id="alertFlashCard">
            <div class="title">Ø¢Ø®Ø± ØªØ­Ø°ÙŠØ± ØªÙ„Ù‚Ø§Ø¦Ù‰</div>
            <div class="value" id="alertReason">Ù„Ø§ ÙŠÙˆØ¬Ø¯</div>
            <div class="note" id="alertTime">---</div>
        </div>

    </div>

    <!-- ===== JAVASCRIPT ===== -->
    <script>
        async function loadStats() {
            try {
                let res = await fetch("/dashboard_api");
                let data = await res.json();

                if (!data.ok) return;

                // ===== BTC LIVE BAR =====
                let btc = data.price;
                let change = data.change_pct;
                let risk = data.risk_level;

                let bar = document.getElementById("btcBar");

                let changeColor = change > 0 ? "btc-green" : "btc-red";

                bar.innerHTML = `
                    <span>BTC: ${btc.toLocaleString()}</span>
                    <span class="${changeColor}">%${change.toFixed(2)}</span>
                    <span> | ğŸ‘â€ğŸ—¨ ${risk}</span>
                `;

                // ===== MARKET STRENGTH =====
                document.getElementById("strengthValue").innerText = data.strength_label;

                // ===== RISK CARD =====
                let riskCard = document.getElementById("riskCard");
                let riskVal = document.getElementById("riskValue");
                let riskNote = document.getElementById("riskNote");

                riskVal.innerHTML = data.risk_emoji + " " + data.risk_level;
                riskNote.innerText = data.risk_message;

                riskCard.classList.remove("risk-low", "risk-medium", "risk-high");
                if (data.risk_level === "Ù…Ù†Ø®ÙØ¶") riskCard.classList.add("risk-low");
                if (data.risk_level === "Ù…ØªÙˆØ³Ø·") riskCard.classList.add("risk-medium");
                if (data.risk_level === "Ù…Ø±ØªÙØ¹") riskCard.classList.add("risk-high");

                // ===== VOLATILITY =====
                document.getElementById("volatilityValue").innerText =
                    data.volatility_score.toFixed(1) + " / 100";

                // ===== LIQUIDITY =====
                document.getElementById("liquidityValue").innerText = data.liquidity_pulse;

                // ===== LAST ERROR =====
                if (data.last_error.message)
                    document.getElementById("lastError").innerText = data.last_error.message;
                else
                    document.getElementById("lastError").innerText = "Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø£Ø®Ø·Ø§Ø¡";

                // ===== ALERT FLASH =====
                let alertCard = document.getElementById("alertFlashCard");
                let aReason = data.last_auto_alert.reason;
                let aTime = data.last_auto_alert.time;

                document.getElementById("alertReason").innerText = aReason;
                document.getElementById("alertTime").innerText = aTime || "---";

                if (aReason !== "no_alert" && aReason !== "duplicate")
                    alertCard.classList.add("flash");
                else
                    alertCard.classList.remove("flash");

            } catch (e) {
                console.log("Error updating dashboard:", e);
            }
        }

        setInterval(loadStats, 2500);
        loadStats();
    </script>

</body>

</html>
