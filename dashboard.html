<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8" />
    <title>IN CRYPTO Ai â€” WAR ROOM</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700;800&display=swap');

        :root {
            --bg-main: #050814;
            --bg-card: rgba(15, 23, 42, 0.82);
            --bg-card-soft: rgba(15, 23, 42, 0.65);
            --border-soft: rgba(148, 163, 184, 0.25);
            --accent-green: #00ff9d;
            --accent-blue: #38bdf8;
            --accent-red: #ff5c5c;
            --accent-yellow: #facc15;
            --text-main: #e5e7eb;
            --text-muted: #9ca3af;
        }

        * {
            box-sizing: border-box;
        }

        body {
            margin: 0;
            padding: 0;
            font-family: "Cairo", system-ui, sans-serif;
            background:
                radial-gradient(circle at top, rgba(34, 197, 235, 0.12), transparent 55%),
                radial-gradient(circle at bottom, rgba(16, 185, 129, 0.10), transparent 55%),
                var(--bg-main);
            color: var(--text-main);
            min-height: 100vh;
        }

        /* ===== TOP BTC BAR ===== */
        .btc-bar {
            width: 100%;
            padding: 10px 18px;
            background: linear-gradient(90deg, #020617, #020617);
            border-bottom: 1px solid rgba(148, 163, 184, 0.2);
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            align-items: center;
            justify-content: space-between;
            font-size: 14px;
        }

        .btc-bar-left {
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: 700;
            letter-spacing: 0.04em;
            color: #e5e7eb;
        }

        .btc-pill {
            padding: 2px 8px;
            border-radius: 999px;
            background: linear-gradient(90deg, #22c55e, #06b6d4);
            font-size: 11px;
            color: #0b1120;
            font-weight: 700;
        }

        .btc-bar-right {
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
            align-items: center;
        }

        .btc-metric {
            display: flex;
            align-items: baseline;
            gap: 4px;
            font-size: 13px;
        }

        .btc-label {
            color: var(--text-muted);
            font-size: 12px;
        }

        .btc-green {
            color: var(--accent-green);
        }

        .btc-red {
            color: var(--accent-red);
        }

        .btc-chip {
            padding: 3px 10px;
            border-radius: 999px;
            border: 1px solid rgba(148, 163, 184, 0.45);
            font-size: 11px;
            text-transform: uppercase;
            letter-spacing: 0.08em;
            color: #cbd5f5;
            background: radial-gradient(circle at top, rgba(56, 189, 248, 0.2), transparent 55%);
        }

        /* ===== HEADER ===== */
        .header {
            padding: 14px 18px 4px;
        }

        .header-title {
            font-size: 20px;
            font-weight: 800;
            letter-spacing: 0.06em;
            text-transform: uppercase;
            color: #f9fafb;
        }

        .header-sub {
            font-size: 12px;
            color: var(--text-muted);
            margin-top: 4px;
        }

        /* ===== GRID LAYOUT ===== */
        .grid {
            padding: 16px 18px 22px;
            display: grid;
            grid-template-columns: repeat(4, minmax(0, 1fr));
            gap: 14px;
        }

        @media (max-width: 1024px) {
            .grid {
                grid-template-columns: repeat(2, minmax(0, 1fr));
            }
        }

        @media (max-width: 640px) {
            .grid {
                grid-template-columns: minmax(0, 1fr);
                padding: 14px 10px 20px;
            }

            .btc-bar {
                padding: 10px 10px;
            }

            .header {
                padding: 12px 10px 4px;
            }
        }

        /* ===== CARD BASE ===== */
        .card {
            background: var(--bg-card);
            border-radius: 16px;
            border: 1px solid var(--border-soft);
            padding: 14px 14px 15px;
            position: relative;
            overflow: hidden;
            box-shadow: 0 18px 40px rgba(15, 23, 42, 0.75);
        }

        .card::before {
            content: "";
            position: absolute;
            inset: 0;
            background: radial-gradient(circle at top left,
                        rgba(56, 189, 248, 0.17),
                        transparent 55%);
            opacity: 0.0;
            transition: opacity 0.2s;
            pointer-events: none;
        }

        .card:hover::before {
            opacity: 1;
        }

        .card-header {
            display: flex;
            align-items: baseline;
            justify-content: space-between;
            margin-bottom: 8px;
        }

        .card-title {
            font-size: 14px;
            font-weight: 700;
            color: #e0f2fe;
        }

        .card-tag {
            font-size: 11px;
            padding: 3px 8px;
            border-radius: 999px;
            border: 1px solid rgba(148, 163, 184, 0.5);
            color: var(--text-muted);
        }

        .card-main {
            font-size: 20px;
            font-weight: 800;
            margin-top: 6px;
        }

        .muted {
            color: var(--text-muted);
        }

        .subtext {
            font-size: 12px;
            margin-top: 4px;
            color: var(--text-muted);
            line-height: 1.5;
        }

        .kpi-row {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 10px;
            font-size: 11px;
        }

        .kpi-pill {
            padding: 4px 9px;
            border-radius: 999px;
            background: rgba(15, 23, 42, 0.95);
            border: 1px solid rgba(148, 163, 184, 0.35);
        }

        .kpi-label {
            color: var(--text-muted);
        }

        .kpi-val {
            font-weight: 600;
        }

        .green {
            color: var(--accent-green);
        }

        .red {
            color: var(--accent-red);
        }

        .yellow {
            color: var(--accent-yellow);
        }

        .blue {
            color: var(--accent-blue);
        }

        /* ===== HEATBAR ===== */
        .heatbar {
            margin-top: 10px;
            width: 100%;
            height: 6px;
            border-radius: 999px;
            background: linear-gradient(90deg,
                        #22c55e,
                        #facc15,
                        #f97316,
                        #ef4444);
            position: relative;
            overflow: hidden;
        }

        .heatbar-track {
            position: absolute;
            inset: 0;
            opacity: 0.25;
            background: #020617;
        }

        .heatbar-dot {
            position: absolute;
            top: 50%;
            width: 16px;
            height: 16px;
            border-radius: 999px;
            transform: translate(-50%, -50%);
            border: 2px solid #f9fafb;
            box-shadow: 0 0 14px rgba(248, 250, 252, 0.7);
        }

        .heatbar-labels {
            display: flex;
            justify-content: space-between;
            font-size: 10px;
            color: var(--text-muted);
            margin-top: 4px;
        }

        /* ===== LOG SNAPSHOT ===== */
        pre {
            margin: 8px 0 0;
            padding: 8px;
            border-radius: 10px;
            background: #020617;
            border: 1px solid rgba(148, 163, 184, 0.3);
            font-size: 10px;
            max-height: 140px;
            overflow: auto;
            direction: ltr;
            text-align: left;
            white-space: pre-wrap;
        }

        /* ===== ALERT FLASH ===== */
        .flash {
            animation: flashAnim 0.95s infinite alternate;
        }

        @keyframes flashAnim {
            from {
                box-shadow: 0 0 18px rgba(248, 250, 252, 0.35);
                border-color: rgba(248, 250, 252, 0.75);
            }
            to {
                box-shadow: 0 0 28px rgba(239, 68, 68, 0.85);
                border-color: rgba(248, 113, 113, 0.95);
            }
        }

        /* ===== BUTTONS ===== */
        .btn-row {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 10px;
        }

        button {
            border-radius: 999px;
            border: 0;
            padding: 6px 13px;
            font-size: 11px;
            cursor: pointer;
            background: #020617;
            color: #e5e7eb;
            border: 1px solid rgba(148, 163, 184, 0.6);
        }

        button.primary {
            background: linear-gradient(135deg, #f59e0b, #facc15);
            color: #111827;
            font-weight: 700;
            border-color: transparent;
        }

        button.secondary {
            border-style: dashed;
        }

        /* ===== ALERTS LIST ===== */
        .alerts-list {
            margin-top: 6px;
            font-size: 11px;
            max-height: 140px;
            overflow: auto;
            line-height: 1.5;
        }

        .alert-item {
            margin-bottom: 5px;
        }

        /* ===== FOOTER ===== */
        .footer {
            padding: 4px 0 10px;
            font-size: 11px;
            text-align: center;
            color: var(--text-muted);
        }
    </style>
</head>

<body>

    <!-- ========== TOP BTC BAR ========== -->
    <div id="btcBar" class="btc-bar">
        <div class="btc-bar-left">
            <span class="btc-pill">IN CRYPTO Ai</span>
            <span>Ù„ÙˆØ­Ø© Ù…Ø±Ø§Ù‚Ø¨Ø© Ø§Ù„Ø¨ÙŠØªÙƒÙˆÙŠÙ† â€” WAR ROOM</span>
        </div>
        <div class="btc-bar-right">
            <div class="btc-metric">
                <span class="btc-label">Ø§Ù„Ø³Ø¹Ø±</span>
                <span id="barPrice">-</span>
            </div>
            <div class="btc-metric">
                <span class="btc-label">ØªØºÙŠØ± 24 Ø³</span>
                <span id="barChange">-</span>
            </div>
            <div class="btc-metric">
                <span class="btc-label">Ù…Ø¯Ù‰ Ø§Ù„ÙŠÙˆÙ…</span>
                <span id="barRange">-</span>
            </div>
            <div class="btc-chip" id="marketModeChip">
                NORMAL MODE
            </div>
        </div>
    </div>

    <!-- ========== HEADER ========== -->
    <div class="header">
        <div class="header-title">IN CRYPTO â€” WAR ROOM</div>
        <div class="header-sub">
            Ù…Ø±Ø§Ù‚Ø¨Ø© Ø­ÙŠØ© Ù„Ù‚ÙˆØ© Ø§Ù„Ø³ÙˆÙ‚ØŒ Ø§Ù„Ù…Ø®Ø§Ø·Ø±ØŒ Ø§Ù„Ø³ÙŠÙˆÙ„Ø©ØŒ ÙˆØ§Ù„ØªÙ‚Ù„Ø¨Ø§Øª Ù…Ø¹ Ù†Ø¸Ø§Ù… ØªØ­Ø°ÙŠØ± Ø°ÙƒÙ‰ ÙŠØ¹Ù…Ù„ Ø¹Ù„Ù‰ Ø­Ø±ÙƒØ© Ø§Ù„Ø¨ÙŠØªÙƒÙˆÙŠÙ†.
        </div>
    </div>

    <!-- ========== GRID LAYOUT ========== -->
    <div class="grid">

        <!-- Ù‚ÙˆØ© Ø§Ù„Ø³ÙˆÙ‚ + Heat Score -->
        <div class="card" id="marketStrengthCard">
            <div class="card-header">
                <div class="card-title">Ù‚ÙˆØ© Ø§Ù„Ø³ÙˆÙ‚ (Market Strength)</div>
                <div class="card-tag" id="strengthTag">BTCUSDT Snapshot</div>
            </div>
            <div class="card-main" id="strengthValue">...</div>
            <div class="subtext">
                Ù‚Ø±Ø§Ø¡Ø© Ù…Ø¯Ù…Ø¬Ø© Ù„Ø§ØªØ¬Ø§Ù‡ Ø§Ù„Ø¨ÙŠØªÙƒÙˆÙŠÙ† ÙˆØ§Ù„Ø²Ø®Ù… Ø§Ù„Ù„Ø­Ø¸Ù‰ Ù…Ø¹ØªÙ…Ø¯ ÙÙ‚Ø· Ø¹Ù„Ù‰ Ø¨ÙŠØ§Ù†Ø§Øª Binance / KuCoin.
            </div>
            <div class="kpi-row">
                <div class="kpi-pill">
                    <span class="kpi-label">Î” Ø§Ù„ÙŠÙˆÙ…:</span>
                    <span class="kpi-val" id="kpiChange">...</span>
                </div>
                <div class="kpi-pill">
                    <span class="kpi-label">Ù…Ø¯Ù‰ Ø§Ù„Ø­Ø±ÙƒØ©:</span>
                    <span class="kpi-val" id="kpiRange">...</span>
                </div>
                <div class="kpi-pill">
                    <span class="kpi-label">Heat Score:</span>
                    <span class="kpi-val" id="kpiHeat">...</span>
                </div>
            </div>
            <div class="heatbar">
                <div class="heatbar-track"></div>
                <div id="heatDot" class="heatbar-dot" style="left: 10%; background:#22c55e;"></div>
            </div>
            <div class="heatbar-labels">
                <span>Ù‡Ø§Ø¯Ø¦</span>
                <span>Ù†Ø´Ø·</span>
                <span>Ø³Ø§Ø®Ù†</span>
                <span>Ø®Ø·Ø±</span>
            </div>
        </div>

        <!-- Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ù…Ø®Ø§Ø·Ø± -->
        <div class="card" id="riskCard">
            <div class="card-header">
                <div class="card-title">Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ù…Ø®Ø§Ø·Ø± (IN CRYPTO Ai)</div>
                <div class="card-tag" id="riskTag">Risk Engine</div>
            </div>
            <div class="card-main" id="riskValue">...</div>
            <div class="subtext" id="riskNote">
                ...
            </div>
            <div class="kpi-row">
                <div class="kpi-pill">
                    <span class="kpi-label">Ø¯Ø±Ø¬Ø© Ø§Ù„ØªÙ‚Ù„Ø¨:</span>
                    <span class="kpi-val" id="kpiVol">...</span>
                </div>
                <div class="kpi-pill">
                    <span class="kpi-label">ÙˆØ¶Ø¹ Ø§Ù„Ù†Ø¸Ø§Ù…:</span>
                    <span class="kpi-val" id="kpiMode">...</span>
                </div>
            </div>
        </div>

        <!-- Ø§Ù„Ø³ÙŠÙˆÙ„Ø© / Ø§Ù„Ø§ØªØ¬Ø§Ù‡ -->
        <div class="card">
            <div class="card-header">
                <div class="card-title">Ù†Ø¨Ø¶ Ø§Ù„Ø³ÙŠÙˆÙ„Ø© ÙˆØ§Ù„Ø§ØªØ¬Ø§Ù‡</div>
                <div class="card-tag">Liquidity Pulse</div>
            </div>
            <div class="card-main" id="liquidityValue">...</div>
            <div class="subtext">
                ØªØ­Ù„ÙŠÙ„ Ù…Ø¨Ø³Ø· Ù„Ø¯Ø®ÙˆÙ„ ÙˆØ®Ø±ÙˆØ¬ Ø§Ù„Ø³ÙŠÙˆÙ„Ø© Ø§Ø³ØªÙ†Ø§Ø¯Ù‹Ø§ Ù„Ø­Ø±ÙƒØ© BTCUSDT ÙÙ‚Ø·ØŒ Ø¨Ø¯ÙˆÙ† Ø£Ù‰ Ù…Ø²ÙˆØ¯ Ø¨ÙŠØ§Ù†Ø§Øª Ø¥Ø¶Ø§ÙÙ‰.
            </div>
            <div class="kpi-row">
                <div class="kpi-pill">
                    <span class="kpi-label">ÙˆØ¶Ø¹ Ø§Ù„Ø³ÙŠÙˆÙ„Ø©:</span>
                    <span class="kpi-val" id="liqLabel">...</span>
                </div>
                <div class="kpi-pill">
                    <span class="kpi-label">Ø¥Ø´Ø§Ø±Ø© Ø§Ù„Ø­Ø±ÙƒØ©:</span>
                    <span class="kpi-val" id="signalPulse">...</span>
                </div>
            </div>
        </div>

        <!-- Ø§Ù„ØªÙ‚Ù„Ø¨ Ø§Ù„ÙŠÙˆÙ…Ù‰ -->
        <div class="card">
            <div class="card-header">
                <div class="card-title">Ø§Ù„ØªÙ‚Ù„Ø¨ Ø§Ù„ÙŠÙˆÙ…Ù‰ Ù„Ù„Ø¨ÙŠØªÙƒÙˆÙŠÙ†</div>
                <div class="card-tag">Volatility Monitor</div>
            </div>
            <div class="card-main">
                <span id="volatilityValue">...</span>
            </div>
            <div class="subtext">
                ÙƒÙ„Ù…Ø§ Ø§Ù‚ØªØ±Ø¨ Ø§Ù„Ù…Ø¤Ø´Ø± Ù…Ù† 100 ÙƒØ§Ù† Ø§Ù„Ø³ÙˆÙ‚ Ø£ÙƒØ«Ø± Ø¹Ø¯ÙˆØ§Ù†ÙŠØ© ÙˆØªØ­ØªØ§Ø¬ Ø¥Ø¯Ø§Ø±Ø© Ù…Ø®Ø§Ø·Ø± Ù…Ø´Ø¯Ø¯Ø©.
            </div>
            <div class="kpi-row">
                <div class="kpi-pill">
                    <span class="kpi-label">Ù†Ø·Ø§Ù‚ Ø§Ù„ÙŠÙˆÙ…:</span>
                    <span class="kpi-val" id="rangeDetail">...</span>
                </div>
                <div class="kpi-pill">
                    <span class="kpi-label">Ø­Ø§Ù„Ø© Ø§Ù„ØªÙ‚Ù„Ø¨:</span>
                    <span class="kpi-val" id="volatilityLabel">...</span>
                </div>
            </div>
        </div>

        <!-- Ù†Ø¸Ø§Ù… Ø§Ù„ØªØ­Ø°ÙŠØ± Ø§Ù„ØªÙ„Ù‚Ø§Ø¦Ù‰ -->
        <div class="card" id="alertFlashCard">
            <div class="card-header">
                <div class="card-title">Ù†Ø¸Ø§Ù… Ø§Ù„ØªØ­Ø°ÙŠØ± Ø§Ù„ØªÙ„Ù‚Ø§Ø¦Ù‰</div>
                <div class="card-tag">/auto_alert</div>
            </div>
            <div class="card-main" id="alertReason">Ù„Ø§ ÙŠÙˆØ¬Ø¯ ØªØ­Ø°ÙŠØ± Ø­Ø§Ù„ÙŠÙ‹Ø§</div>
            <div class="subtext">
                Ø¢Ø®Ø± Ø§Ø³ØªØ¬Ø§Ø¨Ø© Ù„Ù…Ø³Ø§Ø± <code>/auto_alert</code> Ù…Ù† Ø§Ù„Ø¨ÙˆØª.
            </div>
            <div class="kpi-row">
                <div class="kpi-pill">
                    <span class="kpi-label">Ø¢Ø®Ø± ÙˆÙ‚Øª:</span>
                    <span class="kpi-val" id="alertTime">---</span>
                </div>
                <div class="kpi-pill">
                    <span class="kpi-label">ØªÙ… Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ØŸ</span>
                    <span class="kpi-val" id="alertSent">---</span>
                </div>
            </div>
            <div class="btn-row" style="margin-top:10px;">
                <button class="primary" onclick="callAdmin('force_alert')">Ø¥Ø±Ø³Ø§Ù„ ØªØ­Ø°ÙŠØ± ÙÙˆØ±Ù‰ âš¡</button>
                <button class="secondary" onclick="callAdmin('test_alert')">ØªÙ†Ø¨ÙŠÙ‡ ØªØ¬Ø±ÙŠØ¨Ù‰ ğŸ§ª</button>
            </div>
        </div>

        <!-- Ø¢Ø®Ø± Ø®Ø·Ø£ + Snapshot Ù…Ù† Ø§Ù„Ù„ÙˆØ¬ -->
        <div class="card" id="errorCard">
            <div class="card-header">
                <div class="card-title">Ù…Ø±Ø§Ù‚Ø¨Ø© Ø§Ù„Ø£Ø®Ø·Ø§Ø¡</div>
                <div class="card-tag">Last error + Logs</div>
            </div>
            <div class="card-main" id="lastErrorTitle">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø£Ø®Ø·Ø§Ø¡ Ù…Ø³Ø¬Ù„Ø©</div>
            <div class="subtext">
                ÙŠØªÙ… ØªØ­Ø¯ÙŠØ« Ù‡Ø°Ù‡ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§ Ø¹Ù†Ø¯ ØªØ³Ø¬ÙŠÙ„ Ø£Ù‰ Ø®Ø·Ø£ ÙÙ‰ Ø§Ù„Ø¨ÙˆØª.
            </div>
            <pre id="logsSnapshot">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù„ÙˆØ¬Ø§Øª Ø­ØªÙ‰ Ø§Ù„Ø¢Ù†.</pre>
        </div>

        <!-- Ø³Ø¬Ù„ Ø§Ù„ØªØ­Ø°ÙŠØ±Ø§Øª -->
        <div class="card">
            <div class="card-header">
                <div class="card-title">Ø³Ø¬Ù„ Ø§Ù„ØªØ­Ø°ÙŠØ±Ø§Øª</div>
                <div class="card-tag">Alerts History</div>
            </div>
            <div class="alerts-list" id="alertsList">
                Ø¬Ø§Ø±Ù ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø³Ø¬Ù„...
            </div>
            <div class="btn-row">
                <button onclick="reloadAlerts()">ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø³Ø¬Ù„ ğŸ”„</button>
                <button onclick="clearAlerts()">Ù…Ø³Ø­ Ø§Ù„Ø³Ø¬Ù„ ğŸ§¹</button>
            </div>
        </div>

        <!-- ====================== Ø§Ù„Ø¥Ø¶Ø§ÙØ§Øª Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© (7 ÙƒØ±ÙˆØª) ====================== -->

        <!-- 1) Mini Order Flow -->
        <div class="card" id="orderFlowCard">
            <div class="card-header">
                <div class="card-title">ØªØ¯ÙÙ‚ Ø§Ù„Ø£ÙˆØ§Ù…Ø± Ø§Ù„Ù…Ø¨Ø³Ø· (Order Flow)</div>
                <div class="card-tag">Buy vs Sell Pressure</div>
            </div>
            <div class="card-main">
                Ø§Ù„Ù…Ø´ØªØ±ÙŠÙ†: <span id="ofBuy">-</span> Ùª â€” Ø§Ù„Ø¨Ø§Ø¦Ø¹ÙŠÙ†: <span id="ofSell">-</span> Ùª
            </div>
            <div class="subtext">
                ØªÙ‚Ø¯ÙŠØ± ØªÙ‚Ø±ÙŠØ¨Ù‰ Ù„ØªÙˆØ§Ø²Ù† Ø§Ù„Ù‚ÙˆÙ‰ Ø¨ÙŠÙ† Ø§Ù„Ù…Ø´ØªØ±ÙŠÙ† ÙˆØ§Ù„Ø¨Ø§Ø¦Ø¹ÙŠÙ† Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ø­Ø±ÙƒØ© Ø§Ù„Ù„Ø­Ø¸ÙŠØ© ÙˆØ§Ù„ØªÙ‚Ù„Ø¨ ÙˆØ§Ù„Ø³ÙŠÙˆÙ„Ø©.
            </div>
            <div class="kpi-row">
                <div class="kpi-pill">
                    <span class="kpi-label">Ø§ØªØ¬Ø§Ù‡ Ø§Ù„Ø³ÙŠÙˆÙ„Ø©:</span>
                    <span class="kpi-val" id="ofDir">...</span>
                </div>
                <div class="kpi-pill">
                    <span class="kpi-label">Ø­Ø§Ù„Ø© Ø§Ù„ØªÙˆØ§Ø²Ù†:</span>
                    <span class="kpi-val" id="ofImb">...</span>
                </div>
            </div>
        </div>

        <!-- 2) AI Movement Prediction -->
        <div class="card" id="predictCard">
            <div class="card-header">
                <div class="card-title">ØªÙˆÙ‚Ø¹ Ø­Ø±ÙƒØ© Ù‚ØµÙŠØ±Ø© Ø§Ù„Ù…Ø¯Ù‰</div>
                <div class="card-tag">AI Movement Estimation (5â€“15m)</div>
            </div>
            <div class="card-main">
                ØµØ¹ÙˆØ¯: <span id="mvUp">-</span> Ùª â€” Ù‡Ø¨ÙˆØ·: <span id="mvDown">-</span> Ùª
            </div>
            <div class="subtext" id="mvNote">
                ØªÙ‚Ø¯ÙŠØ± Ø§Ø­ØªÙ…Ø§Ù„Ù‰ Ù„Ø­Ø±ÙƒØ© Ø§Ù„Ø¨ÙŠØªÙƒÙˆÙŠÙ† Ø§Ù„Ù‚Ø§Ø¯Ù…Ø© Ø§Ø¹ØªÙ…Ø§Ø¯Ù‹Ø§ Ø¹Ù„Ù‰ Ø§Ù„Ø²Ø®Ù… Ø§Ù„Ù„Ø­Ø¸Ù‰ ÙˆØ§Ù„ØªÙ‚Ù„Ø¨.
            </div>
            <div class="kpi-row">
                <div class="kpi-pill">
                    <span class="kpi-label">ØªÙ…Ø§Ø³Ùƒ / Side:</span>
                    <span class="kpi-val" id="mvSide">...</span>
                </div>
            </div>
        </div>

        <!-- 3) Market Noise Filter -->
        <div class="card" id="noiseCard">
            <div class="card-header">
                <div class="card-title">ÙÙ„ØªØ± Ø§Ù„Ø¶ÙˆØ¶Ø§Ø¡ ÙÙ‰ Ø§Ù„Ø­Ø±ÙƒØ©</div>
                <div class="card-tag">Market Noise Filter</div>
            </div>
            <div class="card-main" id="noiseLabel">...</div>
            <div class="subtext" id="noiseDescription">
                ...
            </div>
        </div>

        <!-- 4) BTC Dominance Pulse -->
        <div class="card" id="domCard">
            <div class="card-header">
                <div class="card-title">Ù†Ø¨Ø¶ Ù‡ÙŠÙ…Ù†Ø© Ø§Ù„Ø¨ÙŠØªÙƒÙˆÙŠÙ†</div>
                <div class="card-tag">BTC Dominance Pulse</div>
            </div>
            <div class="card-main" id="domLevel">...</div>
            <div class="subtext" id="domComment">
                ...
            </div>
        </div>

        <!-- 5) Scalper Mode -->
        <div class="card" id="scalpCard">
            <div class="card-header">
                <div class="card-title">ÙˆØ¶Ø¹ Ø§Ù„Ø³ÙƒØ§Ù„Ø¨ÙŠÙ†Ø¬ (Scalper Mode)</div>
                <div class="card-tag">Scalper Suitability</div>
            </div>
            <div class="card-main" id="scalpLabel">...</div>
            <div class="subtext" id="scalpComment">
                ...
            </div>
        </div>

        <!-- 6) Trend Temperature -->
        <div class="card" id="tempCard">
            <div class="card-header">
                <div class="card-title">Ø¯Ø±Ø¬Ø© Ø­Ø±Ø§Ø±Ø© Ø§Ù„ØªØ±Ù†Ø¯</div>
                <div class="card-tag">Trend Temperature</div>
            </div>
            <div class="card-main" id="tempValue">...</div>
            <div class="subtext" id="tempComment">
                ...
            </div>
        </div>

        <!-- 7) AI Market Commentary -->
        <div class="card" id="commentCard">
            <div class="card-header">
                <div class="card-title">ØªØ¹Ù„ÙŠÙ‚ IN CRYPTO Ai Ø§Ù„Ù„Ø­Ø¸Ù‰</div>
                <div class="card-tag">AI Market Commentary</div>
            </div>
            <div class="card-main" style="font-size: 14px; line-height:1.7;" id="aiComment">
                ...
            </div>
        </div>

    </div>

    <!-- ========== FOOTER ========== -->
    <div class="footer">
        IN CRYPTO Ai â€” Live Market, Risk & Alert Monitor
    </div>

    <!-- ========== JAVASCRIPT ========== -->
    <script>
        function getPassParam() {
            const params = new URLSearchParams(window.location.search);
            return params.get("pass") || "";
        }

        function apiUrl(path) {
            const pass = getPassParam();
            return pass ? path + "?pass=" + encodeURIComponent(pass) : path;
        }

        function computeHeatScore(changePct, volatilityScore, rangePct) {
            let score = Math.abs(changePct) * 1.2 + volatilityScore * 0.7 + rangePct * 0.4;
            if (score > 100) score = 100;
            if (score < 0) score = 0;
            return score;
        }

        function classifyMarketMode(change, volScore, rangePct) {
            if (Math.abs(change) < 0.7 && volScore < 25 && rangePct < 3) {
                return { mode: "NORMAL", label: "Ø­Ø±ÙƒØ© Ù‡Ø§Ø¯Ø¦Ø©" };
            }
            if (Math.abs(change) < 2 && volScore < 45) {
                return { mode: "ACTIVE", label: "Ø³ÙˆÙ‚ Ù†Ø´Ø·" };
            }
            if (volScore > 70 || rangePct > 8) {
                if (change <= -3) return { mode: "PANIC", label: "Ø¶ØºØ· Ø¨ÙŠØ¹Ù‰ Ø¹Ø§Ù„Ù‰" };
                return { mode: "VOLATILE", label: "ØªÙ‚Ù„Ø¨ Ù…Ø±ØªÙØ¹" };
            }
            return { mode: "ACTIVE", label: "Ø³ÙˆÙ‚ Ù†Ø´Ø·" };
        }

        function classifyVolatility(volScore) {
            if (volScore < 20) return "Ù…Ù†Ø®ÙØ¶";
            if (volScore < 45) return "Ù…ØªÙˆØ³Ø·";
            if (volScore < 70) return "Ù…Ø±ØªÙØ¹";
            return "Ø­Ø§Ø¯ Ø¬Ø¯Ù‹Ø§";
        }

        function buildSignalPulse(change, volScore) {
            if (Math.abs(change) < 0.5 && volScore > 55) {
                return "âš ï¸ Ø¶ØºØ· Ø¹Ø§Ù„Ù‰ Ø¨Ø¯ÙˆÙ† Ø­Ø±ÙƒØ© â†’ Ø§Ø­ØªÙ…Ø§Ù„ Ø§Ù†ÙØ¬Ø§Ø± Ø³Ø¹Ø±Ù‰ Ù‚Ø±ÙŠØ¨.";
            }
            if (change > 2.5 && volScore > 50) {
                return "â¬†ï¸ Ø­Ø±ÙƒØ© ØµØ¹ÙˆØ¯ Ù‚ÙˆÙŠØ© Ù…Ø¹ Ø²Ø®Ù… ÙˆØ§Ø¶Ø­.";
            }
            if (change < -2.5 && volScore > 50) {
                return "â¬‡ï¸ Ø­Ø±ÙƒØ© Ù‡Ø¨ÙˆØ· Ù‚ÙˆÙŠØ© Ù…Ø¹ Ø¶ØºØ· Ø¨ÙŠØ¹Ù‰.";
            }
            if (volScore < 20) {
                return "ğŸ˜´ Ø³ÙˆÙ‚ Ù‡Ø§Ø¯Ø¦ Ù†Ø³Ø¨ÙŠÙ‹Ø§ Ø¨Ø¯ÙˆÙ† Ø­Ø±ÙƒØ© ÙƒØ¨ÙŠØ±Ø©.";
            }
            return "ğŸ” ØªØ°Ø¨Ø°Ø¨ Ø·Ø¨ÙŠØ¹Ù‰ Ù…Ø¹ Ø³ÙŠÙˆÙ„Ø© Ù…ØªÙˆØ§Ø²Ù†Ø© ØªÙ‚Ø±ÙŠØ¨Ù‹Ø§.";
        }

        // ----- NEW HELPERS -----

        function computeOrderFlow(change, volScore, rangePct, liqText) {
            let buy = 50 + change * 3;
            let sell = 50 - change * 3;

            if (liqText && /Ø¯Ø®ÙˆÙ„|Ø§Ù„Ø¯Ø®ÙˆÙ„/.test(liqText)) {
                buy += 7;
                sell -= 7;
            }
            if (liqText && /Ø®Ø±ÙˆØ¬/.test(liqText)) {
                buy -= 7;
                sell += 7;
            }

            buy = Math.max(0, Math.min(100, buy));
            sell = Math.max(0, Math.min(100, sell));

            let dir;
            if (buy > sell + 8) dir = "Ø³ÙŠÙˆÙ„Ø© ØªÙ…ÙŠÙ„ Ù„Ù„Ø¯Ø®ÙˆÙ„ (Buy-Dominant)";
            else if (sell > buy + 8) dir = "Ø³ÙŠÙˆÙ„Ø© ØªÙ…ÙŠÙ„ Ù„Ù„Ø®Ø±ÙˆØ¬ (Sell-Dominant)";
            else dir = "Ø³ÙŠÙˆÙ„Ø© Ù…ØªÙˆØ§Ø²Ù†Ø© ØªÙ‚Ø±ÙŠØ¨Ù‹Ø§";

            let imb;
            const diff = Math.abs(buy - sell);
            if (diff < 8) imb = "Balanced";
            else if (diff < 18) imb = "Moderate Imbalance";
            else imb = "Extreme Imbalance";

            return { buy, sell, dir, imb };
        }

        function predictShortTerm(change, volScore) {
            // Ø£Ø±Ù‚Ø§Ù… ØªÙ‚Ø±ÙŠØ¨ÙŠØ© Ù„Ù„Ø­Ø±ÙƒØ© Ø¹Ù„Ù‰ Ù…Ø¯Ù‰ 5â€“15 Ø¯Ù‚ÙŠÙ‚Ø©
            let up = 33, down = 33;

            if (change > 0.8) {
                up += 15;
                down -= 10;
            } else if (change < -0.8) {
                down += 15;
                up -= 10;
            }

            if (volScore > 60) {
                // Ø§Ø­ØªÙ…Ø§Ù„Ø§Øª Ø£Ø¹Ù„Ù‰ Ù„Ù„Ø§Ù†ÙØ¬Ø§Ø± ÙÙ‰ Ø§Ù„Ø§ØªØ¬Ø§Ù‡ÙŠÙ†
                up += 5;
                down += 5;
            } else if (volScore < 25) {
                up -= 5;
                down -= 5;
            }

            up = Math.max(5, Math.min(80, up));
            down = Math.max(5, Math.min(80, down));
            let side = 100 - (up + down);
            if (side < 5) {
                side = 5;
                const scale = (100 - side) / (up + down);
                up = Math.round(up * scale);
                down = 100 - side - up;
            }

            let note;
            if (Math.abs(change) < 0.5 && volScore < 25) {
                note = "Ø§Ù„Ø­Ø±ÙƒØ© Ø§Ù„Ù„Ø­Ø¸ÙŠØ© Ø¶Ø¹ÙŠÙØ©ØŒ Ø§Ø­ØªÙ…Ø§Ù„ Ø§Ù„ØªÙ…Ø§Ø³Ùƒ Ø£Ø¹Ù„Ù‰ Ù…Ù† Ø§Ù„Ø§Ù†ÙØ¬Ø§Ø± Ø§Ù„Ø³Ø±ÙŠØ¹.";
            } else if (change > 1.5 && volScore > 45) {
                note = "Ø²Ø®Ù… ØµØ¹ÙˆØ¯Ù‰ Ø¬ÙŠØ¯ Ù…Ø¹ ØªÙ‚Ù„Ø¨ Ù†Ø´Ø·ØŒ Ù‚Ø¯ Ù†Ø±Ù‰ Ø§Ù…ØªØ¯Ø§Ø¯ Ù„Ù„Ø­Ø±ÙƒØ© Ù„Ùˆ Ø§Ø³ØªÙ…Ø± ØªØ¯ÙÙ‚ Ø§Ù„Ø³ÙŠÙˆÙ„Ø©.";
            } else if (change < -1.5 && volScore > 45) {
                note = "Ø¶ØºØ· Ø¨ÙŠØ¹Ù‰ Ù…Ù„Ø­ÙˆØ¸ØŒ Ø£Ù‰ Ø§Ø±ØªØ¯Ø§Ø¯ Ù‚ØµÙŠØ± Ù‚Ø¯ ÙŠÙƒÙˆÙ† ÙØ±ØµØ© Ù„Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±.";
            } else {
                note = "Ø§Ù„Ø³ÙˆÙ‚ ÙÙ‰ ÙˆØ¶Ø¹ ØªØ°Ø¨Ø°Ø¨ Ø·Ø¨ÙŠØ¹Ù‰ Ø¨Ø¯ÙˆÙ† Ø§ØªØ¬Ø§Ù‡ Ù‚ÙˆÙ‰ØŒ Ø§Ù„ØªÙˆÙ‚Ø¹Ø§Øª Ù‚ØµÙŠØ±Ø© Ø§Ù„Ù…Ø¯Ù‰ ØºÙŠØ± Ø­Ø§Ø³Ù…Ø©.";
            }

            return { up, down, side, note };
        }

        function classifyNoise(change, volScore, rangePct) {
            let label, desc;
            if (Math.abs(change) < 0.4 && volScore < 20 && rangePct < 3) {
                label = "Noise / Ø¶ÙˆØ¶Ø§Ø¡ Ø³Ø¹Ø±ÙŠØ©";
                desc = "Ù…Ø¹Ø¸Ù… Ø§Ù„Ø­Ø±ÙƒØ© Ø§Ù„Ø­Ø§Ù„ÙŠØ© ØªØ¨Ø¯Ùˆ ÙƒØ¶ÙˆØ¶Ø§Ø¡ Ù‚ØµÙŠØ±Ø© Ø§Ù„Ù…Ø¯Ù‰ Ø¨Ø¯ÙˆÙ† Ø§ØªØ¬Ø§Ù‡ ÙˆØ§Ø¶Ø­ Ø£Ùˆ Ù†ÙŠØ© ØªØ¬Ù…ÙŠØ¹/ØªÙˆØ²ÙŠØ¹.";
            } else if (Math.abs(change) < 1 && volScore < 35) {
                label = "Ø­Ø±ÙƒØ© Ø¬Ø§Ù†Ø¨ÙŠØ© Ù‡Ø§Ø¯Ø¦Ø©";
                desc = "Ø§Ù„Ø³ÙˆÙ‚ ÙŠØªØ­Ø±Ùƒ ÙÙ‰ Ù†Ø·Ø§Ù‚ Ù…Ø­Ø¯ÙˆØ¯ØŒ Ø§Ù„Ù‚Ø±Ø§Ø¡Ø§Øª ØªÙ…ÙŠÙ„ Ø¥Ù„Ù‰ Ø§Ù„ØªÙ…Ø§Ø³Ùƒ Ø£ÙƒØ«Ø± Ù…Ù† ØªÙƒÙˆÙŠÙ† Ø§ØªØ¬Ø§Ù‡ Ø¬Ø¯ÙŠØ¯ Ø­Ø§Ù„ÙŠÙ‹Ø§.";
            } else if (volScore > 65 && rangePct > 7 && Math.abs(change) < 1) {
                label = "Ø­Ø±ÙƒØ© Ù…Ø¶ØºÙˆØ·Ø© / Manipulated Range";
                desc = "ØªÙ‚Ù„Ø¨ Ø¹Ø§Ù„Ù‰ Ø¨Ø¯ÙˆÙ† ØªØºÙŠÙŠØ± ÙƒØ¨ÙŠØ± ÙÙ‰ Ø§Ù„Ø¥ØºÙ„Ø§Ù‚ â†’ Ø§Ø­ØªÙ…Ø§Ù„ Ø­Ø±ÙƒØ© Ø­Ø§Ø¯Ø© Ù…ÙØ§Ø¬Ø¦Ø© Ø¹Ù†Ø¯ Ø§Ù„ÙƒØ³Ø±.";
            } else if (Math.abs(change) > 2 && volScore > 50) {
                label = "Ø­Ø±ÙƒØ© Ø§ØªØ¬Ø§Ù‡ÙŠØ© Ø­Ù‚ÙŠÙ‚ÙŠØ©";
                desc = "Ø§Ù„ØªÙ‚Ù„Ø¨ Ø§Ù„Ù…Ø±ØªÙØ¹ Ù…Ø¹ ØªØºÙŠÙŠØ± ÙˆØ§Ø¶Ø­ ÙÙ‰ Ø§Ù„Ø³Ø¹Ø± ÙŠØ´ÙŠØ± Ø¥Ù„Ù‰ Ø§ØªØ¬Ø§Ù‡ ÙØ¹Ù„Ù‰ ÙˆÙ„ÙŠØ³ Ù…Ø¬Ø±Ø¯ Ø¶ÙˆØ¶Ø§Ø¡.";
            } else {
                label = "ØªØ°Ø¨Ø°Ø¨ Ø·Ø¨ÙŠØ¹Ù‰";
                desc = "Ø§Ù„Ø­Ø±ÙƒØ© Ø§Ù„Ø­Ø§Ù„ÙŠØ© ØªØ¬Ù…Ø¹ Ø¨ÙŠÙ† ØªØ°Ø¨Ø°Ø¨ Ù…Ø¹ØªØ¯Ù„ ÙˆØ¨Ø¹Ø¶ Ø§Ù„Ø§ØªØ¬Ø§Ù‡ØŒ Ø¨Ø¯ÙˆÙ† Ø¥Ø´Ø§Ø±Ø§Øª Ø¶ÙˆØ¶Ø§Ø¡ Ù…ÙØ±Ø·Ø©.";
            }
            return { label, desc };
        }

        function btcDominancePulse(change, volScore, rangePct, strengthText, liqText) {
            let level, comment;

            if (Math.abs(change) < 1 && volScore < 30) {
                level = "Ù‡ÙŠÙ…Ù†Ø© Ø¶Ø¹ÙŠÙØ© / Mixed Market";
                comment = "ØªØ£Ø«ÙŠØ± Ø§Ù„Ø¨ÙŠØªÙƒÙˆÙŠÙ† Ø¹Ù„Ù‰ Ø¨Ø§Ù‚Ù‰ Ø§Ù„Ø³ÙˆÙ‚ Ù…Ø­Ø¯ÙˆØ¯ Ø­Ø§Ù„ÙŠÙ‹Ø§ØŒ Ø§Ù„Ø­Ø±ÙƒØ© Ø§Ù„Ø¹Ø§Ù…Ø© Ø£Ù‚Ø±Ø¨ Ù„Ù„ØªÙ…Ø§Ø³Ùƒ.";
            } else if (Math.abs(change) > 2 && /ØµØ¹ÙˆØ¯|Ù‚ÙˆÙ‰|Ù‡Ø¨ÙˆØ·/.test(strengthText || "")) {
                level = "Ù‡ÙŠÙ…Ù†Ø© Ù‚ÙˆÙŠØ© Ù„Ù„Ø¨ÙŠØªÙƒÙˆÙŠÙ†";
                comment = "Ø­Ø±ÙƒØ© Ø§Ù„Ø¨ÙŠØªÙƒÙˆÙŠÙ† Ø§Ù„Ø­Ø§Ù„ÙŠØ© Ø¹Ù„Ù‰ Ø§Ù„Ø£Ø±Ø¬Ø­ ØªÙ‚ÙˆØ¯ Ø§Ù„Ø³ÙˆÙ‚ Ø¨Ø§Ù„ÙƒØ§Ù…Ù„Ø› Ø¨Ø§Ù‚Ù‰ Ø§Ù„Ø¹Ù…Ù„Ø§Øª ØªØªØ¨Ø¹ Ù†ÙØ³ Ø§Ù„Ù…Ø²Ø§Ø¬.";
            } else if (volScore > 55 && rangePct > 6) {
                level = "ØªÙ‚Ù„Ø¨ BTC Ø¹Ø§Ù„Ù‰ Ù„ÙƒÙ† Ø§Ù„Ù‡ÙŠÙ…Ù†Ø© ØºÙŠØ± Ù…Ø­Ø³ÙˆÙ…Ø©";
                comment = "ØªÙ‚Ù„Ø¨ Ø­Ø§Ø¯ ÙÙ‰ Ø§Ù„Ø¨ÙŠØªÙƒÙˆÙŠÙ†ØŒ Ù„ÙƒÙ† Ø´ÙƒÙ„ Ø§Ù„Ø³ÙŠÙˆÙ„Ø© Ù„Ø§ ÙŠØ¹ÙƒØ³ Ù‚ÙŠØ§Ø¯Ø© Ù…Ø³ØªÙ‚Ø±Ø© Ù„Ù„Ø³ÙˆÙ‚.";
            } else {
                level = "Ù‡ÙŠÙ…Ù†Ø© Ù…ØªÙˆØ³Ø·Ø©";
                comment = "Ø§Ù„Ø¨ÙŠØªÙƒÙˆÙŠÙ† Ù…Ø§ Ø²Ø§Ù„ Ø§Ù„Ù…Ø¤Ø´Ø± Ø§Ù„Ø±Ø¦ÙŠØ³Ù‰ØŒ Ù„ÙƒÙ† ÙŠÙ…ÙƒÙ† Ø£Ù† ØªØ®ØªÙ„Ù Ø¨Ø¹Ø¶ Ø§Ù„Ø¹Ù…Ù„Ø§Øª ÙÙ‰ Ø§Ù„Ø³Ù„ÙˆÙƒ Ù‚ØµÙŠØ± Ø§Ù„Ù…Ø¯Ù‰.";
            }

            if (liqText && /Ø®Ø±ÙˆØ¬/.test(liqText)) {
                comment += " ØªÙˆØ¬Ø¯ Ø£ÙŠØ¶Ù‹Ø§ Ø¥Ø´Ø§Ø±Ø§Øª Ø¹Ù„Ù‰ Ø®Ø±ÙˆØ¬ Ø¬Ø²Ø¡ Ù…Ù† Ø§Ù„Ø³ÙŠÙˆÙ„Ø© Ù…Ù† Ø§Ù„Ø³ÙˆÙ‚ Ø£Ùˆ Ø§Ù†ØªÙ‚Ø§Ù„Ù‡Ø§ Ù„Ø£ØµÙˆÙ„ Ø£Ø®Ø±Ù‰.";
            }

            return { level, comment };
        }

        function scalperMode(volScore, rangePct) {
            let label, comment;

            if (volScore < 18 && rangePct < 3) {
                label = "ØºÙŠØ± Ù…Ù†Ø§Ø³Ø¨ Ù„Ù„Ø³ÙƒØ§Ù„Ø¨ÙŠÙ†Ø¬ ğŸ˜´";
                comment = "Ø§Ù„Ø­Ø±ÙƒØ© Ø¨Ø·ÙŠØ¦Ø© Ø¬Ø¯Ù‹Ø§ØŒ Ø§Ù„ÙØ±ÙˆÙ‚Ø§Øª Ø§Ù„ØµØºÙŠØ±Ø© Ù„Ø§ ØªØºØ·Ù‰ Ø§Ù„Ù…Ø®Ø§Ø·Ø± Ø£Ùˆ Ø§Ù„Ø¹Ù…ÙˆÙ„Ø§Øª ÙÙ‰ Ø£ØºÙ„Ø¨ Ø§Ù„Ø£Ø­ÙŠØ§Ù†.";
            } else if (volScore >= 18 && volScore <= 55 && rangePct <= 7) {
                label = "Ù…Ù†Ø§Ø³Ø¨ Ù„Ù„Ø³ÙƒØ§Ù„Ø¨ÙŠÙ†Ø¬ Ø¨Ø­Ø°Ø± âœ…";
                comment = "ØªÙ‚Ù„Ø¨ Ù…ØªÙˆØ³Ø· ÙˆÙ†Ø·Ø§Ù‚ Ø¬ÙŠØ¯ ÙŠØ³Ù…Ø­ Ø¨ØµÙÙ‚Ø§Øª Ø³Ø±ÙŠØ¹Ø©ØŒ Ù…Ø¹ Ø¶Ø±ÙˆØ±Ø© Ø§Ù„Ø§Ù„ØªØ²Ø§Ù… Ø¨ÙˆÙ‚Ù Ø®Ø³Ø§Ø±Ø© Ù‚ØµÙŠØ±.";
            } else if (volScore > 55 && rangePct > 7) {
                label = "Ø³ÙƒØ§Ù„Ø¨ÙŠÙ†Ø¬ Ø¹Ø§Ù„Ù‰ Ø§Ù„Ù…Ø®Ø§Ø·Ø±Ø© âš ï¸";
                comment = "Ø§Ù„Ø­Ø±ÙƒØ© Ø³Ø±ÙŠØ¹Ø© ÙˆØ­Ø§Ø¯Ø©ØŒ Ø§Ù„ÙØ±Øµ ÙƒØ¨ÙŠØ±Ø© Ù„ÙƒÙ† Ø§Ø­ØªÙ…Ø§Ù„ Ø§Ù„Ø§Ù†Ø¹ÙƒØ§Ø³ Ø§Ù„Ù…ÙØ§Ø¬Ø¦ Ø£Ø¹Ù„Ù‰ Ø¨ÙƒØ«ÙŠØ±.";
            } else {
                label = "Ø¸Ø±ÙˆÙ Ù…Ø®ØªÙ„Ø·Ø© Ù„Ù„Ø³ÙƒØ§Ù„Ø¨ÙŠÙ†Ø¬";
                comment = "Ø§Ù„Ø³ÙˆÙ‚ Ù„Ø§ ÙŠØ¹Ø·Ù‰ Ù†Ù…Ø· ÙˆØ§Ø¶Ø­ Ù„Ù„Ø³ÙƒØ§Ù„Ø¨ÙŠÙ†Ø¬ØŒ ÙŠÙØ¶Ù„ ØªØ®ÙÙŠØ¶ Ø­Ø¬Ù… Ø§Ù„Ø¹Ù‚ÙˆØ¯ ÙˆØ§Ù„ØªØ±ÙƒÙŠØ² Ø¹Ù„Ù‰ Ù…Ù†Ø§Ø·Ù‚ Ù‚ÙˆÙŠØ© ÙÙ‚Ø·.";
            }

            return { label, comment };
        }

        function trendTemperature(change, volScore) {
            let temp, comment;
            const absCh = Math.abs(change);

            if (absCh < 0.5 && volScore < 20) {
                temp = "â„ï¸ ØªØ±Ù†Ø¯ Ø¨Ø§Ø±Ø¯";
                comment = "Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø²Ø®Ù… Ø§ØªØ¬Ø§Ù‡Ù‰ ÙŠØ°ÙƒØ±ØŒ Ø§Ù„Ø­Ø±ÙƒØ© Ø£Ù‚Ø±Ø¨ Ø¥Ù„Ù‰ Ù†Ø·Ø§Ù‚ Ø¹Ø±Ø¶Ù‰ Ù‚ØµÙŠØ± Ø§Ù„Ù…Ø¯Ù‰.";
            } else if (absCh < 1.5 && volScore < 45) {
                temp = "ğŸŒ¤ ØªØ±Ù†Ø¯ Ø¯Ø§ÙØ¦";
                comment = "Ø¨Ø¯Ø§ÙŠØ© ØªÙƒÙˆÙ† Ø§ØªØ¬Ø§Ù‡ Ø¨Ø³ÙŠØ·ØŒ ÙŠÙ…ÙƒÙ† Ø£Ù† ÙŠØªØ·ÙˆØ± Ù…Ø¹ Ø¯Ø®ÙˆÙ„ Ø³ÙŠÙˆÙ„Ø© Ø¬Ø¯ÙŠØ¯Ø©.";
            } else if (absCh >= 1.5 && volScore < 65) {
                temp = "ğŸ”¥ ØªØ±Ù†Ø¯ Ø³Ø§Ø®Ù†";
                comment = "Ø²Ø®Ù… Ø¬ÙŠØ¯ ÙÙ‰ Ø§ØªØ¬Ø§Ù‡ ÙˆØ§Ø­Ø¯ØŒ Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø© Ù…Ø¹ Ø§Ù„ØªØ±Ù†Ø¯ Ø£ÙØ¶Ù„ Ù…Ù† Ø¹ÙƒØ³Ù‡.";
            } else {
                temp = "âš¡ ØªØ±Ù†Ø¯ Ù…ÙˆÙ„Ù‘Ø¹";
                comment = "Ø­Ø±ÙƒØ© Ø¹Ù†ÙŠÙØ© ÙˆØ³Ø±ÙŠØ¹Ø©ØŒ Ø§Ù„ØªØ±Ù†Ø¯ Ø­Ø§Ø¶Ø± Ù„ÙƒÙ† Ù…Ø®Ø§Ø·Ø± Ø§Ù„Ø§Ù†Ø¹ÙƒØ§Ø³ Ø§Ù„Ø­Ø§Ø¯ Ù…Ø±ØªÙØ¹Ø© Ø£ÙŠØ¶Ù‹Ø§.";
            }

            return { temp, comment };
        }

        function buildCommentary(change, volScore, rangePct, riskLevelText, liqText, strengthText) {
            let sentence1, sentence2, sentence3;

            if (change > 1.5) {
                sentence1 = `Ø§Ù„Ø³ÙˆÙ‚ ÙŠØ´Ù‡Ø¯ Ù…ÙŠÙ„Ù‹Ø§ ØµØ¹ÙˆØ¯ÙŠÙ‹Ø§ Ù…Ù„Ø­ÙˆØ¸Ù‹Ø§ Ù…Ø¹ ØªØºÙŠØ± ÙŠÙˆÙ…Ù‰ ÙŠÙ‚Ø§Ø±Ø¨ ${(change).toFixed(2)}Ùª.`;
            } else if (change < -1.5) {
                sentence1 = `Ù‡Ù†Ø§Ùƒ Ø¶ØºØ· Ø¨ÙŠØ¹Ù‰ ÙˆØ§Ø¶Ø­ Ø¹Ù„Ù‰ Ø§Ù„Ø¨ÙŠØªÙƒÙˆÙŠÙ† Ù…Ø¹ Ù‡Ø¨ÙˆØ· ÙŠÙˆÙ…Ù‰ ÙŠÙ‚Ø§Ø±Ø¨ ${(change).toFixed(2)}Ùª.`;
            } else {
                sentence1 = `Ø­Ø±ÙƒØ© Ø§Ù„Ø¨ÙŠØªÙƒÙˆÙŠÙ† Ø§Ù„ÙŠÙˆÙ… Ø£Ù‚Ø±Ø¨ Ù„Ù„ØªØ°Ø¨Ø°Ø¨ Ø§Ù„Ù‡Ø§Ø¯Ø¦ Ù…Ø¹ ØªØºÙŠØ± ÙŠÙˆÙ…Ù‰ Ø­ÙˆØ§Ù„Ù‰ ${(change).toFixed(2)}Ùª.`;
            }

            if (volScore > 60) {
                sentence2 = "Ø¯Ø±Ø¬Ø© Ø§Ù„ØªÙ‚Ù„Ø¨ Ù…Ø±ØªÙØ¹Ø©ØŒ Ù…Ø§ ÙŠØ¹Ù†Ù‰ Ø£Ù† Ø§Ù„Ù‚Ø±Ø§Ø±Ø§Øª Ø§Ù„Ø³Ø±ÙŠØ¹Ø© Ø¨Ø¯ÙˆÙ† Ø®Ø·Ø© Ù‚Ø¯ ØªÙƒÙˆÙ† Ù…ÙƒÙ„ÙØ©.";
            } else if (volScore < 20) {
                sentence2 = "Ø§Ù„ØªÙ‚Ù„Ø¨ Ù…Ù†Ø®ÙØ¶ Ù†Ø³Ø¨ÙŠÙ‹Ø§ØŒ ÙˆØ§Ù„Ø³ÙˆÙ‚ ÙŠØªØ­Ø±Ùƒ Ø¨Ù‡Ø¯ÙˆØ¡ Ø¨Ø¯ÙˆÙ† Ø§Ù†ÙØ¬Ø§Ø±Ø§Øª Ø³Ø¹Ø±ÙŠØ© Ø­Ø§Ø¯Ø© Ø­ØªÙ‰ Ø§Ù„Ø¢Ù†.";
            } else {
                sentence2 = "Ø§Ù„ØªÙ‚Ù„Ø¨ ÙÙ‰ Ø§Ù„Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ù…ØªÙˆØ³Ø·Ø©ØŒ Ù…Ù…Ø§ ÙŠØ³Ù…Ø­ Ø¨ÙØ±Øµ Ù„ÙƒÙ† Ù…Ø¹ Ø¶Ø±ÙˆØ±Ø© Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø®Ø§Ø·Ø±.";
            }

            let liqShort = liqText || "";
            if (liqShort.length > 90) {
                liqShort = liqShort.slice(0, 87) + "...";
            }

            sentence3 = `Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ù…Ø®Ø§Ø·Ø± Ø§Ù„Ø¹Ø§Ù… Ø­Ø§Ù„ÙŠÙ‹Ø§: ${riskLevelText}ØŒ Ù…Ø¹ Ù‚Ø±Ø§Ø¡Ø© Ø³ÙŠÙˆÙ„Ø© ØªØ´ÙŠØ± Ø¥Ù„Ù‰: ${liqShort}`;

            return sentence1 + " " + sentence2 + " " + sentence3;
        }

        async function loadMain() {
            try {
                const res = await fetch(apiUrl("/dashboard_api"));
                const data = await res.json();
                if (!data.ok) return;

                const price = data.price;
                const change = data.change_pct;
                const rangePct = data.range_pct;
                const volScore = data.volatility_score;
                const riskLevel = data.risk_level;
                const riskEmoji = data.risk_emoji;
                const riskMsg = data.risk_message;
                const strength = data.strength_label;
                const liquidity = data.liquidity_pulse;

                // ===== TOP BTC BAR =====
                const barPrice = document.getElementById("barPrice");
                const barChange = document.getElementById("barChange");
                const barRange = document.getElementById("barRange");
                const modeChip = document.getElementById("marketModeChip");

                const changeColorClass = change >= 0 ? "btc-green" : "btc-red";

                barPrice.innerHTML = price.toLocaleString();
                barChange.innerHTML = `<span class="${changeColorClass}">${change >= 0 ? "+" : ""}${change.toFixed(2)}%</span>`;
                barRange.textContent = rangePct.toFixed(2) + "%";

                const modeInfo = classifyMarketMode(change, volScore, rangePct);
                modeChip.textContent = modeInfo.mode + " MODE";

                if (modeInfo.mode === "PANIC") {
                    modeChip.style.background = "linear-gradient(135deg, #ef4444, #f97316)";
                } else if (modeInfo.mode === "VOLATILE") {
                    modeChip.style.background = "linear-gradient(135deg, #f97316, #facc15)";
                } else if (modeInfo.mode === "ACTIVE") {
                    modeChip.style.background = "linear-gradient(135deg, #22c55e, #38bdf8)";
                } else {
                    modeChip.style.background = "radial-gradient(circle at top, #0f172a, #020617)";
                }

                // ===== MARKET STRENGTH CARD =====
                document.getElementById("strengthValue").textContent = strength;
                document.getElementById("kpiChange").textContent =
                    (change >= 0 ? "+" : "") + change.toFixed(2) + "%";
                document.getElementById("kpiRange").textContent = rangePct.toFixed(2) + "%";

                const heatScore = computeHeatScore(change, volScore, rangePct);
                document.getElementById("kpiHeat").textContent = heatScore.toFixed(0) + " / 100";

                const heatDot = document.getElementById("heatDot");
                heatDot.style.left = Math.min(96, Math.max(4, heatScore)) + "%";
                if (heatScore < 25) {
                    heatDot.style.background = "#22c55e";
                } else if (heatScore < 50) {
                    heatDot.style.background = "#facc15";
                } else if (heatScore < 75) {
                    heatDot.style.background = "#f97316";
                } else {
                    heatDot.style.background = "#ef4444";
                }

                // ===== RISK CARD =====
                const riskCard = document.getElementById("riskCard");
                const riskVal = document.getElementById("riskValue");
                const riskNote = document.getElementById("riskNote");
                const kpiMode = document.getElementById("kpiMode");
                const kpiVol = document.getElementById("kpiVol");

                riskVal.innerHTML = riskEmoji + " " + riskLevel;
                riskNote.textContent = riskMsg;
                kpiVol.textContent = volScore.toFixed(1) + " / 100";
                kpiMode.textContent = modeInfo.label;

                riskCard.classList.remove("green", "yellow", "red");
                if (riskLevel.includes("Ù…Ù†Ø®ÙØ¶")) riskCard.classList.add("green");
                else if (riskLevel.includes("Ù…ØªÙˆØ³Ø·")) riskCard.classList.add("yellow");
                else riskCard.classList.add("red");

                // ===== LIQUIDITY CARD =====
                document.getElementById("liquidityValue").textContent = liquidity;
                document.getElementById("liqLabel").textContent =
                    change > 0 ? "Ù…ÙŠÙ„ Ù„ØµØ§Ù„Ø­ Ø§Ù„Ù…Ø´ØªØ±ÙŠÙ†" :
                    (change < 0 ? "Ù…ÙŠÙ„ Ù„ØµØ§Ù„Ø­ Ø§Ù„Ø¨Ø§Ø¦Ø¹ÙŠÙ†" : "Ù…ØªÙˆØ§Ø²Ù†Ø© ØªÙ‚Ø±ÙŠØ¨Ù‹Ø§");
                document.getElementById("signalPulse").textContent =
                    buildSignalPulse(change, volScore);

                // ===== VOLATILITY CARD =====
                document.getElementById("volatilityValue").textContent =
                    volScore.toFixed(1) + " / 100";
                document.getElementById("rangeDetail").textContent =
                    rangePct.toFixed(2) + "%";
                document.getElementById("volatilityLabel").textContent =
                    classifyVolatility(volScore);

                // ===== LAST ERROR + LOG SNAPSHOT =====
                const lastErr = data.last_error || {};
                const errTitle = document.getElementById("lastErrorTitle");
                const errCard = document.getElementById("errorCard");

                if (lastErr && lastErr.message) {
                    errTitle.textContent = "Ø¢Ø®Ø± Ø®Ø·Ø£ â€” " + (lastErr.time || "");
                    errCard.classList.add("yellow");
                } else {
                    errTitle.textContent = "Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø£Ø®Ø·Ø§Ø¡ Ù…Ø³Ø¬Ù„Ø©";
                    errCard.classList.remove("yellow");
                }

                // ===== AUTO ALERT STATUS =====
                const aa = data.last_auto_alert || {};
                const alertCard = document.getElementById("alertFlashCard");
                document.getElementById("alertReason").textContent =
                    aa.reason || "Ù„Ø§ ÙŠÙˆØ¬Ø¯ ØªØ­Ø°ÙŠØ± Ø­Ø§Ù„ÙŠÙ‹Ø§";
                document.getElementById("alertTime").textContent =
                    aa.time || "---";
                document.getElementById("alertSent").textContent =
                    aa.sent === true ? "Ù†Ø¹Ù… âœ…" :
                        aa.sent === false ? "Ù„Ø§ âŒ" : "---";

                if (aa.reason && aa.reason !== "no_alert" && aa.reason !== "duplicate") {
                    alertCard.classList.add("flash");
                } else {
                    alertCard.classList.remove("flash");
                }

                // ===== NEW CARDS: 1) Order Flow =====
                const of = computeOrderFlow(change, volScore, rangePct, liquidity);
                document.getElementById("ofBuy").textContent = of.buy.toFixed(0);
                document.getElementById("ofSell").textContent = of.sell.toFixed(0);
                document.getElementById("ofDir").textContent = of.dir;
                document.getElementById("ofImb").textContent = of.imb;

                // ===== 2) Movement Prediction =====
                const mv = predictShortTerm(change, volScore);
                document.getElementById("mvUp").textContent = mv.up.toFixed(0);
                document.getElementById("mvDown").textContent = mv.down.toFixed(0);
                document.getElementById("mvSide").textContent = mv.side.toFixed(0) + " Ùª";
                document.getElementById("mvNote").textContent = mv.note;

                // ===== 3) Noise Filter =====
                const nf = classifyNoise(change, volScore, rangePct);
                document.getElementById("noiseLabel").textContent = nf.label;
                document.getElementById("noiseDescription").textContent = nf.desc;

                // ===== 4) BTC Dominance Pulse =====
                const dom = btcDominancePulse(change, volScore, rangePct, strength, liquidity);
                document.getElementById("domLevel").textContent = dom.level;
                document.getElementById("domComment").textContent = dom.comment;

                // ===== 5) Scalper Mode =====
                const sc = scalperMode(volScore, rangePct);
                document.getElementById("scalpLabel").textContent = sc.label;
                document.getElementById("scalpComment").textContent = sc.comment;

                // ===== 6) Trend Temperature =====
                const tt = trendTemperature(change, volScore);
                document.getElementById("tempValue").textContent = tt.temp;
                document.getElementById("tempComment").textContent = tt.comment;

                // ===== 7) AI Commentary =====
                const commentary = buildCommentary(
                    change,
                    volScore,
                    rangePct,
                    riskLevel,
                    liquidity,
                    strength
                );
                document.getElementById("aiComment").textContent = commentary;

            } catch (e) {
                console.log("Dashboard Error:", e);
            }
        }

        async function loadLogs() {
            try {
                const res = await fetch(apiUrl("/admin/logs"));
                if (!res.ok) return;
                const txt = await res.text();
                document.getElementById("logsSnapshot").textContent =
                    txt || "Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù„ÙˆØ¬Ø§Øª Ø­ØªÙ‰ Ø§Ù„Ø¢Ù†.";
            } catch (e) {
                console.log("Logs error:", e);
            }
        }

        async function reloadAlerts() {
            try {
                const res = await fetch(apiUrl("/admin/alerts_history"));
                const data = await res.json();
                const container = document.getElementById("alertsList");

                if (!data.ok) {
                    container.textContent = "Ù„Ø§ ÙŠÙ…ÙƒÙ† ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø³Ø¬Ù„ Ø§Ù„Ø¢Ù†.";
                    return;
                }

                const list = data.alerts || [];
                if (!list.length) {
                    container.textContent = "Ù„Ø§ ØªÙˆØ¬Ø¯ ØªØ­Ø°ÙŠØ±Ø§Øª Ù…Ø³Ø¬Ù„Ø© Ø¨Ø¹Ø¯.";
                    return;
                }

                const items = list.slice().reverse().map(a => {
                    const changeStr = a.change_pct != null
                        ? ` (Î” ${a.change_pct.toFixed(2)}%)`
                        : "";
                    return `
                        <div class="alert-item">
                            â€¢ [${a.time || "?"}] ${a.source || "?"} â€” ${a.reason || ""}${changeStr}
                        </div>
                    `;
                }).join("");

                container.innerHTML = items;
            } catch (e) {
                console.log("Alerts error:", e);
            }
        }

        async function clearAlerts() {
            if (!confirm("Ù…ØªØ£ÙƒØ¯ Ø¥Ù†Ùƒ Ø¹Ø§ÙŠØ² ØªÙ…Ø³Ø­ Ø³Ø¬Ù„ Ø§Ù„ØªØ­Ø°ÙŠØ±Ø§Øª Ø¨Ø§Ù„ÙƒØ§Ù…Ù„ØŸ")) return;
            try {
                const res = await fetch(apiUrl("/admin/clear_alerts"));
                const data = await res.json();
                alert(data.message || "ØªÙ….");
                reloadAlerts();
            } catch (e) {
                console.log("clearAlerts error:", e);
            }
        }

        async function callAdmin(action) {
            try {
                const res = await fetch(apiUrl("/admin/" + action));
                const data = await res.json();
                alert(data.message || JSON.stringify(data));
            } catch (e) {
                console.log("admin action error:", e);
            }
        }

        // Ø£ÙˆÙ„ ØªØ­Ù…ÙŠÙ„
        loadMain();
        loadLogs();
        reloadAlerts();

        // ØªØ­Ø¯ÙŠØ«Ø§Øª Ø¯ÙˆØ±ÙŠØ©
        setInterval(loadMain, 10000);    // Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø³ÙˆÙ‚ + ÙƒÙ„ Ø§Ù„ÙƒØ±ÙˆØª
        setInterval(loadLogs, 30000);    // Snapshot Ø§Ù„Ù„ÙˆØ¬
        setInterval(reloadAlerts, 60000); // Ø³Ø¬Ù„ Ø§Ù„ØªØ­Ø°ÙŠØ±Ø§Øª
    </script>
</body>
</html>
