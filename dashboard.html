<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8" />
    <title>IN CRYPTO Ai â€” WAR ROOM</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700;800&display=swap');

        :root {
            --bg-main: #050814;
            --bg-card: rgba(15, 23, 42, 0.82);
            --bg-card-soft: rgba(15, 23, 42, 0.65);
            --border-soft: rgba(148, 163, 184, 0.25);
            --accent-green: #00ff9d;
            --accent-blue: #38bdf8;
            --accent-red: #ff5c5c;
            --accent-yellow: #facc15;
            --text-main: #e5e7eb;
            --text-muted: #9ca3af;
        }

        * {
            box-sizing: border-box;
        }

        body {
            margin: 0;
            padding: 0;
            font-family: "Cairo", system-ui, sans-serif;
            background:
                radial-gradient(circle at top, rgba(34, 197, 235, 0.12), transparent 55%),
                radial-gradient(circle at bottom, rgba(16, 185, 129, 0.10), transparent 55%),
                var(--bg-main);
            color: var(--text-main);
            min-height: 100vh;
        }

        /* ===== TOP BTC BAR ===== */
        .btc-bar {
            width: 100%;
            padding: 10px 18px;
            background: linear-gradient(90deg, #020617, #020617);
            border-bottom: 1px solid rgba(148, 163, 184, 0.2);
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            align-items: center;
            justify-content: space-between;
            font-size: 14px;
        }

        .btc-bar-left {
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: 700;
            letter-spacing: 0.04em;
            color: #e5e7eb;
        }

        .btc-pill {
            padding: 2px 8px;
            border-radius: 999px;
            background: linear-gradient(90deg, #22c55e, #06b6d4);
            font-size: 11px;
            color: #0b1120;
            font-weight: 700;
        }

        .btc-bar-right {
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
            align-items: center;
        }

        .btc-metric {
            display: flex;
            align-items: baseline;
            gap: 4px;
            font-size: 13px;
        }

        .btc-label {
            color: var(--text-muted);
            font-size: 12px;
        }

        .btc-green {
            color: var(--accent-green);
        }

        .btc-red {
            color: var(--accent-red);
        }

        .btc-chip {
            padding: 3px 10px;
            border-radius: 999px;
            border: 1px solid rgba(148, 163, 184, 0.45);
            font-size: 11px;
            text-transform: uppercase;
            letter-spacing: 0.08em;
            color: #cbd5f5;
            background: radial-gradient(circle at top, rgba(56, 189, 248, 0.2), transparent 55%);
        }

        /* ===== HEADER ===== */
        .header {
            padding: 14px 18px 4px;
        }

        .header-title {
            font-size: 20px;
            font-weight: 800;
            letter-spacing: 0.06em;
            text-transform: uppercase;
            color: #f9fafb;
        }

        .header-sub {
            font-size: 12px;
            color: var(--text-muted);
            margin-top: 4px;
        }

        /* ===== GRID LAYOUT ===== */
        .grid {
            padding: 16px 18px 22px;
            display: grid;
            grid-template-columns: repeat(4, minmax(0, 1fr));
            gap: 14px;
        }

        @media (max-width: 1024px) {
            .grid {
                grid-template-columns: repeat(2, minmax(0, 1fr));
            }
        }

        @media (max-width: 640px) {
            .grid {
                grid-template-columns: minmax(0, 1fr);
                padding: 14px 10px 20px;
            }

            .btc-bar {
                padding: 10px 10px;
            }

            .header {
                padding: 12px 10px 4px;
            }
        }

        /* cards spanning 2 columns */
        .wide-2 {
            grid-column: span 2;
        }

        /* ===== CARD BASE ===== */
        .card {
            background: var(--bg-card);
            border-radius: 16px;
            border: 1px solid var(--border-soft);
            padding: 14px 14px 15px;
            position: relative;
            overflow: hidden;
            box-shadow: 0 18px 40px rgba(15, 23, 42, 0.75);
        }

        .card::before {
            content: "";
            position: absolute;
            inset: 0;
            background: radial-gradient(circle at top left,
                        rgba(56, 189, 248, 0.17),
                        transparent 55%);
            opacity: 0.0;
            transition: opacity 0.2s;
            pointer-events: none;
        }

        .card:hover::before {
            opacity: 1;
        }

        .card-header {
            display: flex;
            align-items: baseline;
            justify-content: space-between;
            margin-bottom: 8px;
        }

        .card-title {
            font-size: 14px;
            font-weight: 700;
            color: #e0f2fe;
        }

        .card-tag {
            font-size: 11px;
            padding: 3px 8px;
            border-radius: 999px;
            border: 1px solid rgba(148, 163, 184, 0.5);
            color: var(--text-muted);
        }

        .card-main {
            font-size: 24px;
            font-weight: 800;
            margin-top: 6px;
        }

        .muted {
            color: var(--text-muted);
        }

        .subtext {
            font-size: 12px;
            margin-top: 4px;
            color: var(--text-muted);
            line-height: 1.5;
        }

        .kpi-row {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 10px;
            font-size: 11px;
        }

        .kpi-pill {
            padding: 4px 9px;
            border-radius: 999px;
            background: rgba(15, 23, 42, 0.95);
            border: 1px solid rgba(148, 163, 184, 0.35);
        }

        .kpi-label {
            color: var(--text-muted);
        }

        .kpi-val {
            font-weight: 600;
        }

        .green {
            color: var(--accent-green);
        }

        .red {
            color: var(--accent-red);
        }

        .yellow {
            color: var(--accent-yellow);
        }

        .blue {
            color: var(--accent-blue);
        }

        /* ===== HEATBAR ===== */
        .heatbar {
            margin-top: 10px;
            width: 100%;
            height: 6px;
            border-radius: 999px;
            background: linear-gradient(90deg,
                        #22c55e,
                        #facc15,
                        #f97316,
                        #ef4444);
            position: relative;
            overflow: hidden;
        }

        .heatbar-track {
            position: absolute;
            inset: 0;
            opacity: 0.25;
            background: #020617;
        }

        .heatbar-dot {
            position: absolute;
            top: 50%;
            width: 16px;
            height: 16px;
            border-radius: 999px;
            transform: translate(-50%, -50%);
            border: 2px solid #f9fafb;
            box-shadow: 0 0 14px rgba(248, 250, 252, 0.7);
        }

        .heatbar-labels {
            display: flex;
            justify-content: space-between;
            font-size: 10px;
            color: var(--text-muted);
            margin-top: 4px;
        }

        /* ===== LOG SNAPSHOT ===== */
        pre {
            margin: 8px 0 0;
            padding: 8px;
            border-radius: 10px;
            background: #020617;
            border: 1px solid rgba(148, 163, 184, 0.3);
            font-size: 10px;
            max-height: 140px;
            overflow: auto;
            direction: ltr;
            text-align: left;
            white-space: pre-wrap;
        }

        /* ===== ALERT FLASH ===== */
        .flash {
            animation: flashAnim 0.95s infinite alternate;
        }

        @keyframes flashAnim {
            from {
                box-shadow: 0 0 18px rgba(248, 250, 252, 0.35);
                border-color: rgba(248, 250, 252, 0.75);
            }
            to {
                box-shadow: 0 0 28px rgba(239, 68, 68, 0.85);
                border-color: rgba(248, 113, 113, 0.95);
            }
        }

        /* ===== BUTTONS ===== */
        .btn-row {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 10px;
        }

        button {
            border-radius: 999px;
            border: 0;
            padding: 6px 13px;
            font-size: 11px;
            cursor: pointer;
            background: #020617;
            color: #e5e7eb;
            border: 1px solid rgba(148, 163, 184, 0.6);
        }

        button.primary {
            background: linear-gradient(135deg, #f59e0b, #facc15);
            color: #111827;
            font-weight: 700;
            border-color: transparent;
        }

        button.secondary {
            border-style: dashed;
        }

        /* ===== ALERTS LIST ===== */
        .alerts-list {
            margin-top: 6px;
            font-size: 11px;
            max-height: 140px;
            overflow: auto;
            line-height: 1.5;
        }

        .alert-item {
            margin-bottom: 5px;
        }

        /* ===== FOOTER ===== */
        .footer {
            padding: 4px 0 10px;
            font-size: 11px;
            text-align: center;
            color: var(--text-muted);
        }

        /* ===== BTC CHART CONTAINER ===== */
        .chart-container {
            width: 100%;
            height: 280px;
            margin-top: 10px;
            border-radius: 12px;
            overflow: hidden;
            background: #020617;
            border: 1px solid rgba(148, 163, 184, 0.35);
        }

        @media (max-width: 640px) {
            .chart-container {
                height: 230px;
            }
        }

        /* ===== MOMENTUM GAUGE ===== */
        .gauge-wrapper {
            position: relative;
            width: 100%;
            max-width: 230px;
            margin: 6px auto 0;
        }

        .gauge-svg {
            width: 100%;
            height: auto;
            transform: rotate(135deg);
        }

        .gauge-bg {
            fill: none;
            stroke: rgba(15, 23, 42, 0.9);
            stroke-width: 10;
        }

        .gauge-progress {
            fill: none;
            stroke-width: 10;
            stroke-linecap: round;
            stroke: url(#gaugeGradient);
            stroke-dasharray: 314;
            stroke-dashoffset: 314;
            transition: stroke-dashoffset 0.5s ease-out;
        }

        .gauge-center {
            position: absolute;
            inset: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            transform: translateY(4px);
        }

        .gauge-score {
            font-size: 22px;
            font-weight: 800;
        }

        .gauge-label {
            font-size: 12px;
            color: var(--text-muted);
        }

        .gauge-band {
            font-size: 11px;
            margin-top: 6px;
            color: var(--text-muted);
        }
    </style>
</head>

<body>

    <!-- ========== TOP BTC BAR ========== -->
    <div id="btcBar" class="btc-bar">
        <div class="btc-bar-left">
            <span class="btc-pill">IN CRYPTO Ai</span>
            <span>Ù„ÙˆØ­Ø© Ù…Ø±Ø§Ù‚Ø¨Ø© Ø§Ù„Ø¨ÙŠØªÙƒÙˆÙŠÙ† â€” WAR ROOM</span>
        </div>
        <div class="btc-bar-right">
            <div class="btc-metric">
                <span class="btc-label">Ø§Ù„Ø³Ø¹Ø±</span>
                <span id="barPrice">-</span>
            </div>
            <div class="btc-metric">
                <span class="btc-label">ØªØºÙŠØ± 24 Ø³</span>
                <span id="barChange">-</span>
            </div>
            <div class="btc-metric">
                <span class="btc-label">Ù…Ø¯Ù‰ Ø§Ù„ÙŠÙˆÙ…</span>
                <span id="barRange">-</span>
            </div>
            <div class="btc-chip" id="marketModeChip">
                NORMAL MODE
            </div>
        </div>
    </div>

    <!-- ========== HEADER ========== -->
    <div class="header">
        <div class="header-title">IN CRYPTO â€” WAR ROOM</div>
        <div class="header-sub">
            Ù…Ø±Ø§Ù‚Ø¨Ø© Ø­ÙŠØ© Ù„Ù‚ÙˆØ© Ø§Ù„Ø³ÙˆÙ‚ØŒ Ø§Ù„Ù…Ø®Ø§Ø·Ø±ØŒ Ø§Ù„Ø³ÙŠÙˆÙ„Ø©ØŒ ÙˆØ§Ù„ØªÙ‚Ù„Ø¨Ø§Øª Ù…Ø¹ Ù†Ø¸Ø§Ù… ØªØ­Ø°ÙŠØ± Ø°ÙƒÙ‰ ÙŠØ¹Ù…Ù„ Ø¹Ù„Ù‰ Ø­Ø±ÙƒØ© Ø§Ù„Ø¨ÙŠØªÙƒÙˆÙŠÙ†.
        </div>
    </div>

    <!-- ========== GRID LAYOUT ========== -->
    <div class="grid">

        <!-- Ù‚ÙˆØ© Ø§Ù„Ø³ÙˆÙ‚ + Heat Score -->
        <div class="card" id="marketStrengthCard">
            <div class="card-header">
                <div class="card-title">Ù‚ÙˆØ© Ø§Ù„Ø³ÙˆÙ‚ (Market Strength)</div>
                <div class="card-tag" id="strengthTag">BTCUSDT Snapshot</div>
            </div>
            <div class="card-main" id="strengthValue">...</div>
            <div class="subtext">
                Ù‚Ø±Ø§Ø¡Ø© Ù…Ø¯Ù…Ø¬Ø© Ù„Ø§ØªØ¬Ø§Ù‡ Ø§Ù„Ø¨ÙŠØªÙƒÙˆÙŠÙ† ÙˆØ§Ù„Ø²Ø®Ù… Ø§Ù„Ù„Ø­Ø¸Ù‰ Ù…Ø¹ØªÙ…Ø¯ ÙÙ‚Ø· Ø¹Ù„Ù‰ Ø¨ÙŠØ§Ù†Ø§Øª Binance / KuCoin.
            </div>
            <div class="kpi-row">
                <div class="kpi-pill">
                    <span class="kpi-label">Î” Ø§Ù„ÙŠÙˆÙ…:</span>
                    <span class="kpi-val" id="kpiChange">...</span>
                </div>
                <div class="kpi-pill">
                    <span class="kpi-label">Ù…Ø¯Ù‰ Ø§Ù„Ø­Ø±ÙƒØ©:</span>
                    <span class="kpi-val" id="kpiRange">...</span>
                </div>
                <div class="kpi-pill">
                    <span class="kpi-label">Heat Score:</span>
                    <span class="kpi-val" id="kpiHeat">...</span>
                </div>
            </div>
            <div class="heatbar">
                <div class="heatbar-track"></div>
                <div id="heatDot" class="heatbar-dot" style="left: 10%; background:#22c55e;"></div>
            </div>
            <div class="heatbar-labels">
                <span>Ù‡Ø§Ø¯Ø¦</span>
                <span>Ù†Ø´Ø·</span>
                <span>Ø³Ø§Ø®Ù†</span>
                <span>Ø®Ø·Ø±</span>
            </div>
        </div>

        <!-- Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ù…Ø®Ø§Ø·Ø± -->
        <div class="card" id="riskCard">
            <div class="card-header">
                <div class="card-title">Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ù…Ø®Ø§Ø·Ø± (IN CRYPTO Ai)</div>
                <div class="card-tag" id="riskTag">Risk Engine</div>
            </div>
            <div class="card-main" id="riskValue">...</div>
            <div class="subtext" id="riskNote">
                ...
            </div>
            <div class="kpi-row">
                <div class="kpi-pill">
                    <span class="kpi-label">Ø¯Ø±Ø¬Ø© Ø§Ù„ØªÙ‚Ù„Ø¨:</span>
                    <span class="kpi-val" id="kpiVol">...</span>
                </div>
                <div class="kpi-pill">
                    <span class="kpi-label">ÙˆØ¶Ø¹ Ø§Ù„Ù†Ø¸Ø§Ù…:</span>
                    <span class="kpi-val" id="kpiMode">...</span>
                </div>
            </div>
        </div>

        <!-- Ø§Ù„Ø³ÙŠÙˆÙ„Ø© / Ø§Ù„Ø§ØªØ¬Ø§Ù‡ -->
        <div class="card">
            <div class="card-header">
                <div class="card-title">Ù†Ø¨Ø¶ Ø§Ù„Ø³ÙŠÙˆÙ„Ø© ÙˆØ§Ù„Ø§ØªØ¬Ø§Ù‡</div>
                <div class="card-tag">Liquidity Pulse</div>
            </div>
            <div class="card-main" id="liquidityValue">...</div>
            <div class="subtext">
                ØªØ­Ù„ÙŠÙ„ Ù…Ø¨Ø³Ø· Ù„Ø¯Ø®ÙˆÙ„ ÙˆØ®Ø±ÙˆØ¬ Ø§Ù„Ø³ÙŠÙˆÙ„Ø© Ø§Ø³ØªÙ†Ø§Ø¯Ù‹Ø§ Ù„Ø­Ø±ÙƒØ© BTCUSDT ÙÙ‚Ø·ØŒ Ø¨Ø¯ÙˆÙ† Ø£Ù‰ Ù…Ø²ÙˆØ¯ Ø¨ÙŠØ§Ù†Ø§Øª Ø¥Ø¶Ø§ÙÙ‰.
            </div>
            <div class="kpi-row">
                <div class="kpi-pill">
                    <span class="kpi-label">ÙˆØ¶Ø¹ Ø§Ù„Ø³ÙŠÙˆÙ„Ø©:</span>
                    <span class="kpi-val" id="liqLabel">...</span>
                </div>
                <div class="kpi-pill">
                    <span class="kpi-label">Ø¥Ø´Ø§Ø±Ø© Ø§Ù„Ø­Ø±ÙƒØ©:</span>
                    <span class="kpi-val" id="signalPulse">...</span>
                </div>
            </div>
        </div>

        <!-- Ø§Ù„ØªÙ‚Ù„Ø¨ Ø§Ù„ÙŠÙˆÙ…Ù‰ -->
        <div class="card">
            <div class="card-header">
                <div class="card-title">Ø§Ù„ØªÙ‚Ù„Ø¨ Ø§Ù„ÙŠÙˆÙ…Ù‰ Ù„Ù„Ø¨ÙŠØªÙƒÙˆÙŠÙ†</div>
                <div class="card-tag">Volatility Monitor</div>
            </div>
            <div class="card-main">
                <span id="volatilityValue">...</span>
            </div>
            <div class="subtext">
                ÙƒÙ„Ù…Ø§ Ø§Ù‚ØªØ±Ø¨ Ø§Ù„Ù…Ø¤Ø´Ø± Ù…Ù† 100 ÙƒØ§Ù† Ø§Ù„Ø³ÙˆÙ‚ Ø£ÙƒØ«Ø± Ø¹Ø¯ÙˆØ§Ù†ÙŠØ© ÙˆØªØ­ØªØ§Ø¬ Ø¥Ø¯Ø§Ø±Ø© Ù…Ø®Ø§Ø·Ø± Ù…Ø´Ø¯Ø¯Ø©.
            </div>
            <div class="kpi-row">
                <div class="kpi-pill">
                    <span class="kpi-label">Ù†Ø·Ø§Ù‚ Ø§Ù„ÙŠÙˆÙ…:</span>
                    <span class="kpi-val" id="rangeDetail">...</span>
                </div>
                <div class="kpi-pill">
                    <span class="kpi-label">Ø­Ø§Ù„Ø© Ø§Ù„ØªÙ‚Ù„Ø¨:</span>
                    <span class="kpi-val" id="volatilityLabel">...</span>
                </div>
            </div>
        </div>

        <!-- Ù†Ø¸Ø§Ù… Ø§Ù„ØªØ­Ø°ÙŠØ± Ø§Ù„ØªÙ„Ù‚Ø§Ø¦Ù‰ -->
        <div class="card" id="alertFlashCard">
            <div class="card-header">
                <div class="card-title">Ù†Ø¸Ø§Ù… Ø§Ù„ØªØ­Ø°ÙŠØ± Ø§Ù„ØªÙ„Ù‚Ø§Ø¦Ù‰</div>
                <div class="card-tag">/auto_alert</div>
            </div>
            <div class="card-main" id="alertReason">Ù„Ø§ ÙŠÙˆØ¬Ø¯ ØªØ­Ø°ÙŠØ± Ø­Ø§Ù„ÙŠÙ‹Ø§</div>
            <div class="subtext">
                Ø¢Ø®Ø± Ø§Ø³ØªØ¬Ø§Ø¨Ø© Ù„Ù…Ø³Ø§Ø± <code>/auto_alert</code> Ù…Ù† Ø§Ù„Ø¨ÙˆØª.
            </div>
            <div class="kpi-row">
                <div class="kpi-pill">
                    <span class="kpi-label">Ø¢Ø®Ø± ÙˆÙ‚Øª:</span>
                    <span class="kpi-val" id="alertTime">---</span>
                </div>
                <div class="kpi-pill">
                    <span class="kpi-label">ØªÙ… Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ØŸ</span>
                    <span class="kpi-val" id="alertSent">---</span>
                </div>
            </div>
            <div class="btn-row" style="margin-top:10px;">
                <button class="primary" onclick="callAdmin('force_alert')">Ø¥Ø±Ø³Ø§Ù„ ØªØ­Ø°ÙŠØ± ÙÙˆØ±Ù‰ âš¡</button>
                <button class="secondary" onclick="callAdmin('test_alert')">ØªÙ†Ø¨ÙŠÙ‡ ØªØ¬Ø±ÙŠØ¨Ù‰ ğŸ§ª</button>
            </div>
        </div>

        <!-- Ø¢Ø®Ø± Ø®Ø·Ø£ + Snapshot Ù…Ù† Ø§Ù„Ù„ÙˆØ¬ -->
        <div class="card" id="errorCard">
            <div class="card-header">
                <div class="card-title">Ù…Ø±Ø§Ù‚Ø¨Ø© Ø§Ù„Ø£Ø®Ø·Ø§Ø¡</div>
                <div class="card-tag">Last error + Logs</div>
            </div>
            <div class="card-main" id="lastErrorTitle">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø£Ø®Ø·Ø§Ø¡ Ù…Ø³Ø¬Ù„Ø©</div>
            <div class="subtext">
                ÙŠØªÙ… ØªØ­Ø¯ÙŠØ« Ù‡Ø°Ù‡ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§ Ø¹Ù†Ø¯ ØªØ³Ø¬ÙŠÙ„ Ø£Ù‰ Ø®Ø·Ø£ ÙÙ‰ Ø§Ù„Ø¨ÙˆØª.
            </div>
            <pre id="logsSnapshot">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù„ÙˆØ¬Ø§Øª Ø­ØªÙ‰ Ø§Ù„Ø¢Ù†.</pre>
        </div>

        <!-- Ø³Ø¬Ù„ Ø§Ù„ØªØ­Ø°ÙŠØ±Ø§Øª -->
        <div class="card">
            <div class="card-header">
                <div class="card-title">Ø³Ø¬Ù„ Ø§Ù„ØªØ­Ø°ÙŠØ±Ø§Øª</div>
                <div class="card-tag">Alerts History</div>
            </div>
            <div class="alerts-list" id="alertsList">
                Ø¬Ø§Ø±Ù ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø³Ø¬Ù„...
            </div>
            <div class="btn-row">
                <button onclick="reloadAlerts()">ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø³Ø¬Ù„ ğŸ”„</button>
                <button onclick="clearAlerts()">Ù…Ø³Ø­ Ø§Ù„Ø³Ø¬Ù„ ğŸ§¹</button>
            </div>
        </div>

        <!-- ===== NEW: BTC LIVE CHART (LINE + CANDLES) ===== -->
        <div class="card wide-2" id="btcChartCard">
            <div class="card-header">
                <div class="card-title">Ø´Ø§Ø±Øª Ø§Ù„Ø¨ÙŠØªÙƒÙˆÙŠÙ† Ø§Ù„Ù„Ø­Ø¸Ù‰ (Line + Candles)</div>
                <div class="card-tag">Binance 5m â€” Realtime</div>
            </div>
            <div class="subtext">
                Ø¢Ø®Ø± ~10 Ø³Ø§Ø¹Ø§Øª Ù…Ù† Ø­Ø±ÙƒØ© BTCUSDT Ø¹Ù„Ù‰ ÙØ±ÙŠÙ… 5 Ø¯Ù‚Ø§Ø¦Ù‚ Ù…Ø¹ Ø´Ù…ÙˆØ¹ ÙƒØ§Ù…Ù„Ø© ÙˆØ®Ø· Ø³Ø¹Ø± Ù„Ø­Ø¸Ù‰.
            </div>
            <div id="btcChart" class="chart-container"></div>
        </div>

        <!-- ===== NEW: MOMENTUM GAUGE ===== -->
        <div class="card" id="momentumCard">
            <div class="card-header">
                <div class="card-title">Ù…Ø¤Ø´Ø± Ø§Ù„Ø²Ø®Ù… (Momentum Gauge)</div>
                <div class="card-tag">Fusion Score</div>
            </div>

            <div class="gauge-wrapper">
                <svg class="gauge-svg" viewBox="0 0 120 120">
                    <defs>
                        <linearGradient id="gaugeGradient" x1="0%" y1="0%" x2="100%" y2="0%">
                            <stop offset="0%" stop-color="#22c55e"/>
                            <stop offset="50%" stop-color="#facc15"/>
                            <stop offset="100%" stop-color="#ef4444"/>
                        </linearGradient>
                    </defs>
                    <circle class="gauge-bg" cx="60" cy="60" r="50"></circle>
                    <circle id="gaugeProgress" class="gauge-progress" cx="60" cy="60" r="50"></circle>
                </svg>
                <div class="gauge-center">
                    <div id="gaugeScore" class="gauge-score">--</div>
                    <div id="gaugeLabel" class="gauge-label">Momentum</div>
                    <div id="gaugeBand" class="gauge-band">Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø­Ø³Ø§Ø¨...</div>
                </div>
            </div>

            <div class="subtext" id="gaugeNote">
                Ø¯Ù…Ø¬ Ø¨ÙŠÙ† Ø§Ù„ØªØºÙŠØ± Ø§Ù„ÙŠÙˆÙ…Ù‰ØŒ Ù…Ø¯Ù‰ Ø§Ù„Ø­Ø±ÙƒØ©ØŒ ÙˆØ§Ù„ØªÙ‚Ù„Ø¨ Ù„ÙŠØ¹Ø·ÙŠÙƒ Ù‚Ø±Ø§Ø¡Ø© Ø³Ø±ÙŠØ¹Ø© Ù„Ù‚ÙˆØ© Ø§Ù„Ø¯ÙØ¹ Ø§Ù„Ø­Ø§Ù„ÙŠØ© Ù„Ù„Ø³ÙˆÙ‚.
            </div>

            <div class="kpi-row">
                <div class="kpi-pill">
                    <span class="kpi-label">Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ø²Ø®Ù…:</span>
                    <span class="kpi-val" id="kpiMomentumLabel">--</span>
                </div>
                <div class="kpi-pill">
                    <span class="kpi-label">Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø®Ø·Ø±:</span>
                    <span class="kpi-val">80+ / 100</span>
                </div>
            </div>
        </div>

    </div>

    <!-- ========== FOOTER ========== -->
    <div class="footer">
        IN CRYPTO Ai â€” Live Market, Risk & Alert Monitor
    </div>

    <!-- TradingView Lightweight Charts (Ù„Ù„Ø´Ø§Ø±Øª) -->
    <script src="https://unpkg.com/lightweight-charts/dist/lightweight-charts.standalone.production.js"></script>

    <!-- ========== JAVASCRIPT ========== -->
    <script>
        function getPassParam() {
            const params = new URLSearchParams(window.location.search);
            return params.get("pass") || params.get("password") || "";
        }

        function apiUrl(path) {
            const pass = getPassParam();
            return pass ? path + "?pass=" + encodeURIComponent(pass) : path;
        }

        function computeHeatScore(changePct, volatilityScore, rangePct) {
            // Ø¯Ù…Ø¬ Ø¨Ø³ÙŠØ·: ØªÙ‚Ù„Ø¨ + Ù…Ø¯Ù‰ + ØªØºÙŠÙŠØ±
            let score = Math.abs(changePct) * 1.2 + volatilityScore * 0.7 + rangePct * 0.4;
            if (score > 100) score = 100;
            if (score < 0) score = 0;
            return score;
        }

        function classifyMarketMode(change, volScore, rangePct) {
            // ÙŠØ±Ø¬Ù‘Ø¹ mode + label
            if (Math.abs(change) < 0.7 && volScore < 25 && rangePct < 3) {
                return { mode: "NORMAL", label: "Ø­Ø±ÙƒØ© Ù‡Ø§Ø¯Ø¦Ø©" };
            }
            if (Math.abs(change) < 2 && volScore < 45) {
                return { mode: "ACTIVE", label: "Ø³ÙˆÙ‚ Ù†Ø´Ø·" };
            }
            if (volScore > 70 || rangePct > 8) {
                if (change <= -3) return { mode: "PANIC", label: "Ø¶ØºØ· Ø¨ÙŠØ¹Ù‰ Ø¹Ø§Ù„Ù‰" };
                return { mode: "VOLATILE", label: "ØªÙ‚Ù„Ø¨ Ù…Ø±ØªÙØ¹" };
            }
            return { mode: "ACTIVE", label: "Ø³ÙˆÙ‚ Ù†Ø´Ø·" };
        }

        function classifyVolatility(volScore) {
            if (volScore < 20) return "Ù…Ù†Ø®ÙØ¶";
            if (volScore < 45) return "Ù…ØªÙˆØ³Ø·";
            if (volScore < 70) return "Ù…Ø±ØªÙØ¹";
            return "Ø­Ø§Ø¯ Ø¬Ø¯Ù‹Ø§";
        }

        function buildSignalPulse(change, volScore) {
            if (Math.abs(change) < 0.5 && volScore > 55) {
                return "âš ï¸ Ø¶ØºØ· Ø¹Ø§Ù„Ù‰ Ø¨Ø¯ÙˆÙ† Ø­Ø±ÙƒØ© â†’ Ø§Ø­ØªÙ…Ø§Ù„ Ø§Ù†ÙØ¬Ø§Ø± Ø³Ø¹Ø±Ù‰ Ù‚Ø±ÙŠØ¨.";
            }
            if (change > 2.5 && volScore > 50) {
                return "â¬†ï¸ Ø­Ø±ÙƒØ© ØµØ¹ÙˆØ¯ Ù‚ÙˆÙŠØ© Ù…Ø¹ Ø²Ø®Ù… ÙˆØ§Ø¶Ø­.";
            }
            if (change < -2.5 && volScore > 50) {
                return "â¬‡ï¸ Ø­Ø±ÙƒØ© Ù‡Ø¨ÙˆØ· Ù‚ÙˆÙŠØ© Ù…Ø¹ Ø¶ØºØ· Ø¨ÙŠØ¹Ù‰.";
            }
            if (volScore < 20) {
                return "ğŸ˜´ Ø³ÙˆÙ‚ Ù‡Ø§Ø¯Ø¦ Ù†Ø³Ø¨ÙŠÙ‹Ø§ Ø¨Ø¯ÙˆÙ† Ø­Ø±ÙƒØ© ÙƒØ¨ÙŠØ±Ø©.";
            }
            return "ğŸ” ØªØ°Ø¨Ø°Ø¨ Ø·Ø¨ÙŠØ¹Ù‰ Ù…Ø¹ Ø³ÙŠÙˆÙ„Ø© Ù…ØªÙˆØ§Ø²Ù†Ø© ØªÙ‚Ø±ÙŠØ¨Ù‹Ø§.";
        }

        // ===== MOMENTUM GAUGE =====
        function updateMomentumGauge(score) {
            const circle = document.getElementById("gaugeProgress");
            const scoreEl = document.getElementById("gaugeScore");
            const labelEl = document.getElementById("gaugeLabel");
            const bandEl = document.getElementById("gaugeBand");
            const labelKpi = document.getElementById("kpiMomentumLabel");
            const noteEl = document.getElementById("gaugeNote");
            const card = document.getElementById("momentumCard");

            if (!circle) return;

            const clamped = Math.max(0, Math.min(100, score));
            const circumference = 2 * Math.PI * 50; // r=50
            const offset = circumference - (clamped / 100) * circumference;
            circle.style.strokeDashoffset = offset;

            scoreEl.textContent = clamped.toFixed(0) + " / 100";

            let band, note, label;
            if (clamped < 25) {
                band = "Ø²Ø®Ù… Ø¶Ø¹ÙŠÙ â€” Ø³ÙˆÙ‚ Ù‡Ø§Ø¯Ø¦";
                note = "Ø§Ù„Ø³ÙˆÙ‚ ÙŠØªØ­Ø±Ùƒ Ø¨Ù‡Ø¯ÙˆØ¡ Ù†Ø³Ø¨Ù‰ØŒ Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¯ÙØ¹Ø© Ù‚ÙˆÙŠØ© ÙÙ‰ Ø£Ù‰ Ø§ØªØ¬Ø§Ù‡.";
                label = "Ù‡Ø§Ø¯Ø¦";
                card.classList.remove("yellow", "red");
                card.classList.add("green");
            } else if (clamped < 55) {
                band = "Ø²Ø®Ù… Ù…ØªÙˆØ§Ø²Ù† â€” Range / ØªØ°Ø¨Ø°Ø¨ ØµØ­Ù‰";
                note = "Ø§Ù„ØªØ°Ø¨Ø°Ø¨ Ø·Ø¨ÙŠØ¹Ù‰ØŒ ÙŠÙ…ÙƒÙ† Ø§Ù„Ø¹Ù…Ù„ Ù…Ø¹ Ø¥Ø¯Ø§Ø±Ø© Ù…Ø®Ø§Ø·Ø± Ø¹Ø§Ø¯ÙŠØ©.";
                label = "Ù…ØªÙˆØ§Ø²Ù†";
                card.classList.remove("green", "red");
                card.classList.add("yellow");
            } else if (clamped < 80) {
                band = "Ø²Ø®Ù… Ù‚ÙˆÙ‰ â€” Ø­Ø±ÙƒØ© Ù†Ø´Ø·Ø© ØªØ­ØªØ§Ø¬ Ø§Ù†ØªØ¨Ø§Ù‡";
                note = "Ø§Ù„Ø³ÙˆÙ‚ Ù†Ø´Ø· Ø¨Ù‚ÙˆØ©ØŒ ÙŠÙØ¶Ù„ Ø§Ù„ØªØ±ÙƒÙŠØ² Ø¹Ù„Ù‰ Ù…Ù†Ø§Ø·Ù‚ Ø§Ù„Ø¯Ø¹Ù… / Ø§Ù„Ù…Ù‚Ø§ÙˆÙ…Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©.";
                label = "Ù†Ø´Ø·";
                card.classList.remove("green");
                card.classList.add("yellow");
            } else {
                band = "âš ï¸ Ø²Ø®Ù… Ø¹Ù†ÙŠÙ â€” Ù…Ù†Ø·Ù‚Ø© Ø§Ù†Ø°Ø§Ø± Ø¹Ø§Ù„Ù‰";
                note = "Ø§Ù„Ø³ÙˆÙ‚ ÙÙ‰ Ù…Ù†Ø·Ù‚Ø© Ø­Ø³Ø§Ø³Ø©ØŒ ÙŠÙØ¶Ù„ ØªØ®ÙÙŠÙ Ø­Ø¬Ù… Ø§Ù„Ù…Ø®Ø§Ø·Ø±Ø© ÙˆØ§Ù„Ø§Ø¨ØªØ¹Ø§Ø¯ Ø¹Ù† Ø§Ù„Ù…Ø·Ø§Ø±Ø¯Ø©.";
                label = "Ø®Ø·Ø±";
                card.classList.remove("green", "yellow");
                card.classList.add("red");
            }

            bandEl.textContent = band;
            noteEl.textContent = note;
            labelEl.textContent = "Momentum â€” " + label;
            labelKpi.textContent = label;
        }

        async function loadMain() {
            try {
                const res = await fetch(apiUrl("/dashboard_api"));
                const data = await res.json();
                if (!data.ok) return;

                const price = data.price;
                const change = data.change_pct;
                const rangePct = data.range_pct;
                const volScore = data.volatility_score;
                const riskLevel = data.risk_level;
                const riskEmoji = data.risk_emoji;
                const riskMsg = data.risk_message;

                // ===== TOP BTC BAR =====
                const barPrice = document.getElementById("barPrice");
                const barChange = document.getElementById("barChange");
                const barRange = document.getElementById("barRange");
                const modeChip = document.getElementById("marketModeChip");

                const changeColorClass = change >= 0 ? "btc-green" : "btc-red";

                barPrice.innerHTML = price.toLocaleString();
                barChange.innerHTML = `<span class="${changeColorClass}">${change >= 0 ? "+" : ""}${change.toFixed(2)}%</span>`;
                barRange.textContent = rangePct.toFixed(2) + "%";

                const modeInfo = classifyMarketMode(change, volScore, rangePct);
                modeChip.textContent = modeInfo.mode + " MODE";

                if (modeInfo.mode === "PANIC") {
                    modeChip.style.background = "linear-gradient(135deg, #ef4444, #f97316)";
                } else if (modeInfo.mode === "VOLATILE") {
                    modeChip.style.background = "linear-gradient(135deg, #f97316, #facc15)";
                } else if (modeInfo.mode === "ACTIVE") {
                    modeChip.style.background = "linear-gradient(135deg, #22c55e, #38bdf8)";
                } else {
                    modeChip.style.background = "radial-gradient(circle at top, #0f172a, #020617)";
                }

                // ===== MARKET STRENGTH CARD =====
                document.getElementById("strengthValue").textContent = data.strength_label;
                document.getElementById("kpiChange").textContent =
                    (change >= 0 ? "+" : "") + change.toFixed(2) + "%";
                document.getElementById("kpiRange").textContent = rangePct.toFixed(2) + "%";

                const heatScore = computeHeatScore(change, volScore, rangePct);
                document.getElementById("kpiHeat").textContent = heatScore.toFixed(0) + " / 100";

                const heatDot = document.getElementById("heatDot");
                heatDot.style.left = Math.min(96, Math.max(4, heatScore)) + "%";
                if (heatScore < 25) {
                    heatDot.style.background = "#22c55e";
                } else if (heatScore < 50) {
                    heatDot.style.background = "#facc15";
                } else if (heatScore < 75) {
                    heatDot.style.background = "#f97316";
                } else {
                    heatDot.style.background = "#ef4444";
                }

                // ===== Ø±Ø¨Ø· HeatScore Ù…Ø¹ Momentum Gauge =====
                // MomentumScore = Ø¯Ù…Ø¬ Ø£Ù‚ÙˆÙ‰ Ø´ÙˆÙŠØ© Ù…Ù† HeatScore
                const momentumScore = Math.min(
                    100,
                    Math.max(
                        0,
                        Math.abs(change) * 2.0 + volScore * 0.6 + rangePct * 0.5
                    )
                );
                updateMomentumGauge(momentumScore);

                // ===== RISK CARD =====
                const riskCard = document.getElementById("riskCard");
                const riskVal = document.getElementById("riskValue");
                const riskNote = document.getElementById("riskNote");
                const kpiMode = document.getElementById("kpiMode");
                const kpiVol = document.getElementById("kpiVol");

                riskVal.innerHTML = riskEmoji + " " + riskLevel;
                riskNote.textContent = riskMsg;
                kpiVol.textContent = volScore.toFixed(1) + " / 100";
                kpiMode.textContent = modeInfo.label;

                riskCard.classList.remove("green", "yellow", "red");
                if (riskLevel.includes("Ù…Ù†Ø®ÙØ¶")) riskCard.classList.add("green");
                else if (riskLevel.includes("Ù…ØªÙˆØ³Ø·")) riskCard.classList.add("yellow");
                else riskCard.classList.add("red");

                // ===== LIQUIDITY CARD =====
                document.getElementById("liquidityValue").textContent = data.liquidity_pulse;
                document.getElementById("liqLabel").textContent =
                    change > 0 ? "Ù…ÙŠÙ„ Ù„ØµØ§Ù„Ø­ Ø§Ù„Ù…Ø´ØªØ±ÙŠÙ†" :
                    (change < 0 ? "Ù…ÙŠÙ„ Ù„ØµØ§Ù„Ø­ Ø§Ù„Ø¨Ø§Ø¦Ø¹ÙŠÙ†" : "Ù…ØªÙˆØ§Ø²Ù†Ø© ØªÙ‚Ø±ÙŠØ¨Ù‹Ø§");
                document.getElementById("signalPulse").textContent =
                    buildSignalPulse(change, volScore);

                // ===== VOLATILITY CARD =====
                document.getElementById("volatilityValue").textContent =
                    volScore.toFixed(1) + " / 100";
                document.getElementById("rangeDetail").textContent =
                    rangePct.toFixed(2) + "%";
                document.getElementById("volatilityLabel").textContent =
                    classifyVolatility(volScore);

                // ===== LAST ERROR + LOG SNAPSHOT =====
                const lastErr = data.last_error || {};
                const errTitle = document.getElementById("lastErrorTitle");
                const errCard = document.getElementById("errorCard");

                if (lastErr && lastErr.message) {
                    errTitle.textContent = "Ø¢Ø®Ø± Ø®Ø·Ø£ â€” " + (lastErr.time || "");
                    errCard.classList.add("yellow");
                } else {
                    errTitle.textContent = "Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø£Ø®Ø·Ø§Ø¡ Ù…Ø³Ø¬Ù„Ø©";
                    errCard.classList.remove("yellow");
                }

                // ===== AUTO ALERT STATUS =====
                const aa = data.last_auto_alert || {};
                const alertCard = document.getElementById("alertFlashCard");
                document.getElementById("alertReason").textContent =
                    aa.reason || "Ù„Ø§ ÙŠÙˆØ¬Ø¯ ØªØ­Ø°ÙŠØ± Ø­Ø§Ù„ÙŠÙ‹Ø§";
                document.getElementById("alertTime").textContent =
                    aa.time || "---";
                document.getElementById("alertSent").textContent =
                    aa.sent === true ? "Ù†Ø¹Ù… âœ…" :
                        aa.sent === false ? "Ù„Ø§ âŒ" : "---";

                if (aa.reason && aa.reason !== "no_alert" && aa.reason !== "duplicate") {
                    alertCard.classList.add("flash");
                } else {
                    alertCard.classList.remove("flash");
                }

            } catch (e) {
                console.log("Dashboard Error:", e);
            }
        }

        async function loadLogs() {
            try {
                const res = await fetch(apiUrl("/admin/logs"));
                if (!res.ok) return;
                const txt = await res.text();
                document.getElementById("logsSnapshot").textContent =
                    txt || "Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù„ÙˆØ¬Ø§Øª Ø­ØªÙ‰ Ø§Ù„Ø¢Ù†.";
            } catch (e) {
                console.log("Logs error:", e);
            }
        }

        async function reloadAlerts() {
            try {
                const res = await fetch(apiUrl("/admin/alerts_history"));
                const data = await res.json();
                const container = document.getElementById("alertsList");

                if (!data.ok) {
                    container.textContent = "Ù„Ø§ ÙŠÙ…ÙƒÙ† ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø³Ø¬Ù„ Ø§Ù„Ø¢Ù†.";
                    return;
                }

                const list = data.alerts || [];
                if (!list.length) {
                    container.textContent = "Ù„Ø§ ØªÙˆØ¬Ø¯ ØªØ­Ø°ÙŠØ±Ø§Øª Ù…Ø³Ø¬Ù„Ø© Ø¨Ø¹Ø¯.";
                    return;
                }

                const items = list.slice().reverse().map(a => {
                    const changeStr = a.change_pct != null
                        ? ` (Î” ${a.change_pct.toFixed(2)}%)`
                        : "";
                    return `
                        <div class="alert-item">
                            â€¢ [${a.time || "?"}] ${a.source || "?"} â€” ${a.reason || ""}${changeStr}
                        </div>
                    `;
                }).join("");

                container.innerHTML = items;
            } catch (e) {
                console.log("Alerts error:", e);
            }
        }

        async function clearAlerts() {
            if (!confirm("Ù…ØªØ£ÙƒØ¯ Ø¥Ù†Ùƒ Ø¹Ø§ÙŠØ² ØªÙ…Ø³Ø­ Ø³Ø¬Ù„ Ø§Ù„ØªØ­Ø°ÙŠØ±Ø§Øª Ø¨Ø§Ù„ÙƒØ§Ù…Ù„ØŸ")) return;
            try {
                const res = await fetch(apiUrl("/admin/clear_alerts"));
                const data = await res.json();
                alert(data.message || "ØªÙ….");
                reloadAlerts();
            } catch (e) {
                console.log("clearAlerts error:", e);
            }
        }

        async function callAdmin(action) {
            try {
                const res = await fetch(apiUrl("/admin/" + action));
                const data = await res.json();
                alert(data.message || JSON.stringify(data));
            } catch (e) {
                console.log("admin action error:", e);
            }
        }

        // ===== BTC LIVE CHART (BINANCE + LIGHTWEIGHT-CHARTS) =====
        let btcChart = null;
        let candleSeries = null;
        let lineSeries = null;

        function initBTCChart() {
            const container = document.getElementById("btcChart");
            if (!container || btcChart) return;

            btcChart = LightweightCharts.createChart(container, {
                layout: {
                    background: { color: "#020617" },
                    textColor: "#e5e7eb",
                },
                grid: {
                    vertLines: { color: "rgba(148,163,184,0.2)" },
                    horzLines: { color: "rgba(148,163,184,0.2)" },
                },
                rightPriceScale: {
                    borderColor: "rgba(148,163,184,0.4)",
                },
                timeScale: {
                    borderColor: "rgba(148,163,184,0.4)",
                },
                crosshair: {
                    mode: LightweightCharts.CrosshairMode.Normal,
                },
                localization: {
                    priceFormatter: price => price.toFixed(2),
                },
            });

            candleSeries = btcChart.addCandlestickSeries({
                upColor: "#22c55e",
                downColor: "#ef4444",
                borderVisible: false,
                wickUpColor: "#22c55e",
                wickDownColor: "#ef4444",
            });

            lineSeries = btcChart.addLineSeries({
                color: "#38bdf8",
                lineWidth: 2,
            });

            loadBTCChart();
            setInterval(loadBTCChart, 30000); // ÙƒÙ„ 30 Ø«Ø§Ù†ÙŠØ©
        }

        async function loadBTCChart() {
            try {
                if (!candleSeries || !lineSeries) return;
                const res = await fetch(
                    "https://api.binance.com/api/v3/klines?symbol=BTCUSDT&interval=5m&limit=120"
                );
                const raw = await res.json();
                if (!Array.isArray(raw)) return;

                const candles = raw.map(k => ({
                    time: k[0] / 1000,
                    open: parseFloat(k[1]),
                    high: parseFloat(k[2]),
                    low: parseFloat(k[3]),
                    close: parseFloat(k[4]),
                }));

                const lineData = candles.map(c => ({
                    time: c.time,
                    value: c.close,
                }));

                candleSeries.setData(candles);
                lineSeries.setData(lineData);

                btcChart.timeScale().fitContent();
            } catch (e) {
                console.log("BTC chart error:", e);
            }
        }

        // Ø£ÙˆÙ„ ØªØ­Ù…ÙŠÙ„
        loadMain();
        loadLogs();
        reloadAlerts();
        initBTCChart();

        // ØªØ­Ø¯ÙŠØ«Ø§Øª Ø¯ÙˆØ±ÙŠØ©
        setInterval(loadMain, 10000);      // Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø³ÙˆÙ‚
        setInterval(loadLogs, 30000);      // Snapshot Ø§Ù„Ù„ÙˆØ¬
        setInterval(reloadAlerts, 60000);  // Ø³Ø¬Ù„ Ø§Ù„ØªØ­Ø°ÙŠØ±Ø§Øª
    </script>
</body>
</html>
