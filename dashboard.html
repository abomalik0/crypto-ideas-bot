<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>IN CRYPTO â€” WAR ROOM</title>

<style>
    body {
        background: #06070a;
        color: #fff;
        font-family: "Cairo", system-ui, sans-serif;
        margin: 0;
        padding: 0;
        direction: rtl;
        text-align: center;
        overflow-x: hidden;
    }

    /* ===== HEADER ===== */
    .header {
        padding: 35px 0 22px;
        border-bottom: 1px solid #1d2330;
        background: linear-gradient(to bottom, #0a0d14, #06070a);
        box-shadow: 0 4px 18px rgba(0,0,0,0.45);
        animation: fadeDown 1.2s ease forwards;
        opacity: 0;
    }
    .title {
        font-size: 32px;
        font-weight: 900;
        letter-spacing: 1px;
        color: #f6b044;
        text-shadow: 0 0 12px rgba(246,176,68,.65);
        margin-bottom: 6px;
    }
    .subtitle {
        font-size: 14px;
        color: #9aa4b8;
        margin-top: 2px;
    }

    @keyframes fadeDown {
        0% { opacity: 0; transform: translateY(-20px); }
        100% { opacity: 1; transform: translateY(0); }
    }

    /* ===== GRID ===== */
    .grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
        gap: 16px;
        padding: 18px;
        max-width: 1200px;
        margin: 0 auto;
    }

    /* ===== CARDS ===== */
    .card {
        background: radial-gradient(circle at top, #151821 0, #06070a 60%);
        border-radius: 14px;
        padding: 16px 16px 22px;
        box-shadow: 0 0 20px rgba(0,0,0,.9);
        border: 1px solid #151821;
        text-align: right;
        position: relative;
        opacity: 0;
        transform: translateY(25px);
        animation: fadeUp 0.9s ease forwards;
    }
    .card:nth-child(1){ animation-delay: .2s; }
    .card:nth-child(2){ animation-delay: .35s; }
    .card:nth-child(3){ animation-delay: .5s; }
    .card:nth-child(4){ animation-delay: .65s; }
    .card:nth-child(5){ animation-delay: .8s; }
    .card:nth-child(6){ animation-delay: .95s; }

    @keyframes fadeUp {
        0% { opacity: 0; transform: translateY(25px); }
        100% { opacity: 1; transform: translateY(0); }
    }

    /* Pulse Ø¹Ù†Ø¯ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª */
    .pulse {
        animation: pulseGlow 1.2s ease;
    }
    @keyframes pulseGlow {
        0% { box-shadow: 0 0 0px rgba(246,176,68,0.0); }
        50% { box-shadow: 0 0 18px rgba(246,176,68,0.35); }
        100% { box-shadow: 0 0 0px rgba(246,176,68,0.0); }
    }

    .card h3 {
        margin: 0 0 10px;
        font-size: 16px;
        color: #e3e7ff;
    }

    .metric-main {
        font-size: 26px;
        font-weight: 800;
        margin-bottom: 6px;
        transition: .3s ease;
    }

    .metric-sub {
        font-size: 14px;
        color: #a5aec4;
        line-height: 1.6;
    }

    .green { color: #00ff9d; }
    .red { color: #ff4d4d; }
    .yellow { color: #ffd747; }
    .muted { color: #7b8397; }

    .pill {
        display: inline-flex;
        align-items: center;
        gap: 4px;
        padding: 3px 9px;
        border-radius: 999px;
        font-size: 11px;
        background: rgba(15, 185, 255, 0.12);
        color: #9ad7ff;
        margin-bottom: 8px;
    }

    .footer {
        margin-top: 15px;
        padding: 15px 0 20px;
        font-size: 12px;
        color: #585f75;
        animation: fadeUp 1.2s ease forwards;
        opacity: 0;
        animation-delay: 1s;
    }

    /* Buttons */
    button {
        border-radius: 999px;
        border: 0;
        padding: 7px 14px;
        font-size: 12px;
        cursor: pointer;
        margin-left: 4px;
        margin-top: 4px;
        background: #1d2535;
        color: #e3e7ff;
        transition: .2s;
    }
    button:hover {
        transform: scale(1.05);
        opacity: .9;
    }
    button.primary {
        background: #f6b044;
        color: #151821;
        font-weight: 700;
    }
</style>
</head>

<body>

<div class="header">
    <div class="title">IN CRYPTO â€” WAR ROOM</div>
    <div class="subtitle">Ù…Ø±Ø§Ù‚Ø¨Ø© Ø§Ù„Ø³ÙˆÙ‚ØŒ Ø§Ù„Ù…Ø®Ø§Ø·Ø± ÙˆØ§Ù„Ø³ÙŠÙˆÙ„Ø© Ù„Ø­Ø¸Ø© Ø¨Ù„Ø­Ø¸Ø©</div>
</div>

<div class="grid">

    <div class="card">
        <div class="pill">Ø§Ù„Ø³ÙˆÙ‚</div>
        <h3>Ø³Ø¹Ø± Ø§Ù„Ø¨ÙŠØªÙƒÙˆÙŠÙ† Ø§Ù„Ø¢Ù†</h3>
        <div id="price" class="metric-main">...</div>
        <div id="change" class="metric-main muted">...</div>
        <div class="metric-sub">
            Ù…Ø¯Ù‰ Ø§Ù„Ø­Ø±ÙƒØ©: <span id="range">...</span><br />
            Ø§Ù„ØªÙ‚Ù„Ø¨: <span id="volatility">...</span> / 100
        </div>
        <div class="metric-sub" id="strength"></div>
    </div>

    <div class="card">
        <div class="pill">Ø§Ù„Ù…Ø®Ø§Ø·Ø±</div>
        <h3>Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ù…Ø®Ø§Ø·Ø±</h3>
        <div id="risk_level" class="metric-main">...</div>
        <div id="risk_msg" class="metric-sub">...</div>
    </div>

    <div class="card">
        <div class="pill">Ø§Ù„Ø³ÙŠÙˆÙ„Ø©</div>
        <h3>Ù†Ø¨Ø¶ Ø§Ù„Ø³ÙŠÙˆÙ„Ø©</h3>
        <div id="liquidity" class="metric-sub">...</div>
    </div>

    <div class="card">
        <div class="pill">Auto Alert</div>
        <h3>Ø¢Ø®Ø± ØªØ´ØºÙŠÙ„</h3>
        <div class="metric-sub">
            Ø§Ù„ÙˆÙ‚Øª: <span id="aa_time">N/A</span><br>
            Ø§Ù„Ø³Ø¨Ø¨: <span id="aa_reason">N/A</span><br>
            ØªÙ… Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ØŸ <span id="aa_sent">N/A</span>
        </div>
        <button class="primary" onclick="callAdmin('force_alert')">ØªØ­Ø°ÙŠØ± ÙÙˆØ±Ù‰ âš¡</button>
        <button onclick="callAdmin('test_alert')">ØªÙ†Ø¨ÙŠÙ‡ ØªØ¬Ø±ÙŠØ¨Ù‰ ğŸ§ª</button>
    </div>

    <div class="card">
        <div class="pill">Logs</div>
        <h3>Ø¢Ø®Ø± Ø®Ø·Ø£</h3>
        <pre id="err_msg">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø£Ø®Ø·Ø§Ø¡</pre>
    </div>

    <div class="card">
        <div class="pill">Alerts</div>
        <h3>Ø³Ø¬Ù„ Ø§Ù„ØªØ­Ø°ÙŠØ±Ø§Øª</h3>
        <div class="metric-sub" id="alerts_list">Ø¬Ø§Ø±Ù Ø§Ù„ØªØ­Ù…ÙŠÙ„â€¦</div>
        <button onclick="reloadAlerts()">ØªØ­Ø¯ÙŠØ« ğŸ”„</button>
        <button onclick="clearAlerts()">Ù…Ø³Ø­ ğŸ§¹</button>
    </div>

</div>

<div class="footer">IN CRYPTO Ai â€” Live Monitor</div>

<script>
/* ===== Ø¹Ø¯Ø§Ø¯ Ø£Ø±Ù‚Ø§Ù… Ù†Ø§Ø¹Ù… ===== */
function animateNumber(el, to) {
    const duration = 700;
    const from = Number(el.innerText.replace(/[^0-9.-]/g,"")) || 0;
    const start = performance.now();

    function update(now){
        const progress = Math.min((now - start) / duration, 1);
        const value = from + (to - from) * progress;
        el.innerText = "$" + value.toLocaleString();
        if(progress < 1) requestAnimationFrame(update);
    }
    requestAnimationFrame(update);
}

function api(path){ return fetch(path).then(r=>r.json()) }

/* ===== ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ===== */
async function loadMain() {
    const card1 = document.querySelector(".card");
    const res = await api("/dashboard_api");

    if (!res.ok) return;

    card1.classList.add("pulse");

    animateNumber(document.getElementById("price"), res.price);

    const ch = res.change_pct;
    const cEl = document.getElementById("change");
    cEl.className = "metric-main " + (ch >= 0 ? "green" : "red");
    cEl.innerText = (ch>=0?"+":"") + ch.toFixed(2) + "%";

    document.getElementById("range").innerText = res.range_pct.toFixed(2)+"%";
    document.getElementById("volatility").innerText = res.volatility_score.toFixed(1);
    document.getElementById("strength").innerText = res.strength_label;

    const rl = document.getElementById("risk_level");
    rl.innerText = res.risk_emoji + " " + res.risk_level;
    rl.className = "metric-main " + (
        res.risk_level.includes("Ù…Ù†Ø®ÙØ¶") ? "green" :
        res.risk_level.includes("Ù…ØªÙˆØ³Ø·") ? "yellow" : "red"
    );

    document.getElementById("risk_msg").innerText = res.risk_message;
    document.getElementById("liquidity").innerText = res.liquidity_pulse;

    const aa = res.last_auto_alert;
    document.getElementById("aa_time").innerText = aa.time;
    document.getElementById("aa_reason").innerText = aa.reason;
    document.getElementById("aa_sent").innerText = aa.sent ? "Ù†Ø¹Ù…" : "Ù„Ø§";

    const err = res.last_error;
    document.getElementById("err_msg").innerText = err.message || "Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø£Ø®Ø·Ø§Ø¡";
}

/* ===== Ø³Ø¬Ù„Ø§Øª Ø§Ù„ØªØ­Ø°ÙŠØ±Ø§Øª ===== */
async function reloadAlerts(){
    const res = await api("/admin/alerts_history");
    if (!res.ok) return;

    let html = "";
    res.alerts.reverse().forEach(a=>{
        html += `â€¢ [${a.time}] ${a.source} â€” ${a.reason}<br>`;
    });
    document.getElementById("alerts_list").innerHTML = html || "Ù„Ø§ ÙŠÙˆØ¬Ø¯ ØªØ­Ø°ÙŠØ±Ø§Øª";
}
async function clearAlerts(){ await api("/admin/clear_alerts"); reloadAlerts(); }

/* ===== Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø£Ø¯Ù…Ù† ===== */
async function callAdmin(action){
    const r = await api("/admin/"+action);
    alert(r.message || "Done");
}

/* ===== ØªØ´ØºÙŠÙ„ Ù…Ø³ØªÙ…Ø± ===== */
loadMain();
reloadAlerts();
setInterval(loadMain, 8000);
setInterval(reloadAlerts, 20000);
</script>

</body>
</html>
