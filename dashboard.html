<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>IN CRYPTO â€” WAR ROOM</title>

<style>
    body {
        background: #06070a;
        color: #fff;
        font-family: "Cairo", system-ui, sans-serif;
        margin: 0;
        padding: 0;
        direction: rtl;
        text-align: center;
    }
    .header {
        padding: 25px 0 10px;
        border-bottom: 1px solid #151821;
        background: radial-gradient(circle at top, #1a2538 0, #06070a 55%);
    }
    .logo {
        width: 120px;
        height: 120px;
        border-radius: 50%;
        margin-bottom: 10px;
        border: 3px solid #f6b044;
        box-shadow: 0 0 18px rgba(246,176,68,.7);
        object-fit: cover;
        background: #000;
    }
    .title {
        font-size: 26px;
        font-weight: 800;
        letter-spacing: 1px;
        color: #f6b044;
        text-shadow: 0 0 10px rgba(246,176,68,.7);
    }
    .subtitle {
        font-size: 13px;
        color: #8b94a7;
        margin-top: 4px;
    }
    .grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
        gap: 16px;
        padding: 18px;
        max-width: 1200px;
        margin: 0 auto;
    }
    .card {
        background: radial-gradient(circle at top, #151821 0, #06070a 60%);
        border-radius: 14px;
        padding: 16px 16px 18px;
        box-shadow: 0 0 18px rgba(0,0,0,.9);
        border: 1px solid #151821;
        text-align: right;
        position: relative;
    }
    .card h3 {
        margin: 0 0 10px;
        font-size: 16px;
        color: #e3e7ff;
    }
    .metric-main {
        font-size: 24px;
        font-weight: 800;
        margin-bottom: 6px;
    }
    .metric-sub {
        font-size: 14px;
        color: #a5aec4;
        line-height: 1.6;
    }
    .green { color: #00ff9d; }
    .red { color: #ff4d4d; }
    .yellow { color: #ffd747; }
    .muted { color: #7b8397; }
    .pill {
        display: inline-flex;
        align-items: center;
        gap: 4px;
        padding: 3px 9px;
        border-radius: 999px;
        font-size: 11px;
        background: rgba(15, 185, 255, 0.12);
        color: #9ad7ff;
        margin-bottom: 8px;
    }
    .footer {
        margin-top: 10px;
        padding: 12px 0 18px;
        font-size: 12px;
        color: #525b70;
    }
    pre {
        background: #05060a;
        padding: 8px;
        border-radius: 8px;
        max-height: 150px;
        overflow: auto;
        font-size: 11px;
        direction: ltr;
        text-align: left;
        border: 1px solid #151821;
    }
    button {
        border-radius: 999px;
        border: 0;
        padding: 6px 14px;
        font-size: 12px;
        cursor: pointer;
        margin-left: 4px;
        margin-top: 4px;
        background: #1d2535;
        color: #e3e7ff;
    }
    button.primary {
        background: #f6b044;
        color: #151821;
        font-weight: 700;
    }
</style>
</head>

<body>

<div class="header">
    <!-- Ø­Ø· Ø§Ø³Ù… Ù…Ù„Ù Ø§Ù„Ù„ÙˆØ¬Ùˆ Ø§Ù„Ù„Ù‰ ÙÙ‰ Ø§Ù„Ø³ÙŠØ±ÙØ± (Ù…Ø«Ù„Ø§Ù‹ logo.png) -->
    <img src="logo.png" class="logo" alt="IN CRYPTO logo" />
    <div class="title">IN CRYPTO â€” WAR ROOM</div>
    <div class="subtitle">
        Ù„ÙˆØ­Ø© Ù…Ø±Ø§Ù‚Ø¨Ø© ØªØ­Ø°ÙŠØ±Ø§Øª Ø§Ù„Ø¨ÙŠØªÙƒÙˆÙŠÙ†ØŒ Ø§Ù„Ø³ÙŠÙˆÙ„Ø©ØŒ Ø§Ù„Ù…Ø®Ø§Ø·Ø±ØŒ ÙˆØ£Ø®Ø·Ø§Ø¡ Ø§Ù„Ù†Ø¸Ø§Ù… ÙÙ‰ Ø§Ù„Ø²Ù…Ù† Ø§Ù„Ø­Ù‚ÙŠÙ‚Ù‰.
    </div>
</div>

<div class="grid">

    <div class="card">
        <div class="pill">Ø­Ø§Ù„Ø© Ø§Ù„Ø³ÙˆÙ‚</div>
        <h3>Ø³Ø¹Ø± Ø§Ù„Ø¨ÙŠØªÙƒÙˆÙŠÙ† Ø§Ù„Ø¢Ù†</h3>
        <div id="price" class="metric-main">...</div>
        <div id="change" class="metric-main muted">...</div>
        <div class="metric-sub">
            Ù…Ø¯Ù‰ Ø­Ø±ÙƒØ© Ø§Ù„ÙŠÙˆÙ…: <span id="range">...</span><br />
            Ø¯Ø±Ø¬Ø© Ø§Ù„ØªÙ‚Ù„Ø¨: <span id="volatility">...</span> / 100
        </div>
        <div class="metric-sub" id="strength" style="margin-top:6px;"></div>
    </div>

    <div class="card">
        <div class="pill">Ø§Ù„Ù…Ø®Ø§Ø·Ø±</div>
        <h3>Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ù…Ø®Ø§Ø·Ø± Ø§Ù„ÙƒÙ„Ù‰</h3>
        <div id="risk_level" class="metric-main">...</div>
        <div id="risk_msg" class="metric-sub">...</div>
    </div>

    <div class="card">
        <div class="pill">Ø§Ù„Ø§ØªØ¬Ø§Ù‡ ÙˆØ§Ù„Ø³ÙŠÙˆÙ„Ø©</div>
        <h3>Ù†Ø¨Ø¶ Ø§Ù„Ø³ÙŠÙˆÙ„Ø©</h3>
        <div id="liquidity" class="metric-sub">...</div>
        <div class="metric-sub muted" style="margin-top:8px;">
            ÙŠØ¹ØªÙ…Ø¯ Ø¨Ø§Ù„ÙƒØ§Ù…Ù„ Ø¹Ù„Ù‰ Ø­Ø±ÙƒØ© BTCUSDT Ù…Ù† Binance / KuCoin Ø¨Ø¯ÙˆÙ† Ø£Ù‰ Ù…Ø²ÙˆØ¯ Ø¨ÙŠØ§Ù†Ø§Øª Ø¥Ø¶Ø§ÙÙ‰.
        </div>
    </div>

    <div class="card">
        <div class="pill">Ù†Ø¸Ø§Ù… Ø§Ù„ØªØ­Ø°ÙŠØ± Ø§Ù„ØªÙ„Ù‚Ø§Ø¦Ù‰</div>
        <h3>Ø¢Ø®Ø± Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù„Ù…Ø³Ø§Ø± <code>/auto_alert</code></h3>
        <div class="metric-sub">
            Ø¢Ø®Ø± ÙˆÙ‚Øª: <span id="aa_time">N/A</span><br />
            Ø§Ù„Ø³Ø¨Ø¨: <span id="aa_reason">N/A</span><br />
            ØªÙ… Ø¥Ø±Ø³Ø§Ù„ ØªØ­Ø°ÙŠØ±ØŸ <span id="aa_sent">N/A</span>
        </div>
        <div style="margin-top:10px;">
            <button class="primary" onclick="callAdmin('force_alert')">Ø¥Ø±Ø³Ø§Ù„ ØªØ­Ø°ÙŠØ± ÙÙˆØ±Ù‰ âš¡</button>
            <button onclick="callAdmin('test_alert')">ØªÙ†Ø¨ÙŠÙ‡ ØªØ¬Ø±ÙŠØ¨Ù‰ ğŸ§ª</button>
        </div>
    </div>

    <div class="card">
        <div class="pill">Ø¢Ø®Ø± Ø®Ø·Ø£ ÙÙ‰ Ø§Ù„Ù†Ø¸Ø§Ù…</div>
        <h3>Logs Snapshot</h3>
        <div class="metric-sub">
            Ø§Ù„ÙˆÙ‚Øª: <span id="err_time">N/A</span>
        </div>
        <pre id="err_msg">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø£Ø®Ø·Ø§Ø¡ Ù…Ø³Ø¬Ù„Ø© Ø­ØªÙ‰ Ø§Ù„Ø¢Ù†.</pre>
    </div>

    <div class="card">
        <div class="pill">Ø³Ø¬Ù„ Ø§Ù„ØªØ­Ø°ÙŠØ±Ø§Øª</div>
        <h3>Ø¢Ø®Ø± Ø§Ù„ØªØ­Ø°ÙŠØ±Ø§Øª Ø§Ù„Ù…Ø³Ø¬Ù„Ø©</h3>
        <div class="metric-sub" id="alerts_list">
            Ø¬Ø§Ø±Ù Ø§Ù„ØªØ­Ù…ÙŠÙ„...
        </div>
        <div style="margin-top:10px;">
            <button onclick="reloadAlerts()">ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø³Ø¬Ù„ ğŸ”„</button>
            <button onclick="clearAlerts()">Ù…Ø³Ø­ Ø§Ù„Ø³Ø¬Ù„ ğŸ§¹</button>
        </div>
    </div>

</div>

<div class="footer">
    IN CRYPTO Ai â€” Live Market & Risk Monitor
</div>

<script>
function getPassParam() {
    const params = new URLSearchParams(window.location.search);
    return params.get("pass") || "";
}

function apiUrl(path) {
    const pass = getPassParam();
    if (pass) {
        return path + "?pass=" + encodeURIComponent(pass);
    }
    return path;
}

async function loadMain() {
    try {
        const res = await fetch(apiUrl("/dashboard_api"));
        const data = await res.json();

        if (!data.ok) {
            console.log("API Error:", data);
            return;
        }

        document.getElementById("price").innerHTML =
            "$" + data.price.toLocaleString();

        const changeEl = document.getElementById("change");
        const ch = data.change_pct;
        changeEl.innerHTML = (ch >= 0 ? "+" : "") + ch.toFixed(2) + "%";
        changeEl.className = "metric-main " + (ch >= 0 ? "green" : "red");

        document.getElementById("range").innerHTML =
            data.range_pct.toFixed(2) + "%";
        document.getElementById("volatility").innerHTML =
            data.volatility_score.toFixed(1);
        document.getElementById("strength").innerHTML =
            data.strength_label;

        const rl = document.getElementById("risk_level");
        rl.innerHTML = data.risk_emoji + " " + data.risk_level;
        rl.className = "metric-main";
        if (data.risk_level.includes("Ù…Ù†Ø®ÙØ¶")) {
            rl.className += " green";
        } else if (data.risk_level.includes("Ù…ØªÙˆØ³Ø·")) {
            rl.className += " yellow";
        } else {
            rl.className += " red";
        }

        document.getElementById("risk_msg").innerHTML = data.risk_message;
        document.getElementById("liquidity").innerHTML = data.liquidity_pulse;

        const aa = data.last_auto_alert || {};
        document.getElementById("aa_time").innerHTML = aa.time || "N/A";
        document.getElementById("aa_reason").innerHTML = aa.reason || "N/A";
        document.getElementById("aa_sent").innerHTML =
            aa.sent === true ? "Ù†Ø¹Ù… âœ…" : (aa.sent === false ? "Ù„Ø§ âŒ" : "N/A");

        const err = data.last_error || {};
        document.getElementById("err_time").innerHTML = err.time || "N/A";
        document.getElementById("err_msg").textContent =
            err.message || "Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø£Ø®Ø·Ø§Ø¡ Ù…Ø³Ø¬Ù„Ø© Ø­ØªÙ‰ Ø§Ù„Ø¢Ù†.";
    } catch (err) {
        console.log("Dashboard Error:", err);
    }
}

async function loadLogs() {
    try {
        const res = await fetch(apiUrl("/admin/logs"));
        if (!res.ok) return;
        const txt = await res.text();
        document.getElementById("err_msg").textContent = txt || "Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù„ÙˆØ¬Ø§Øª.";
    } catch (e) {
        console.log("Logs error:", e);
    }
}

async function reloadAlerts() {
    try {
        const res = await fetch(apiUrl("/admin/alerts_history"));
        const data = await res.json();
        if (!data.ok) {
            document.getElementById("alerts_list").innerHTML = "Ù„Ø§ ÙŠÙ…ÙƒÙ† ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø³Ø¬Ù„.";
            return;
        }
        const list = data.alerts || [];
        if (!list.length) {
            document.getElementById("alerts_list").innerHTML = "Ù„Ø§ ØªÙˆØ¬Ø¯ ØªØ­Ø°ÙŠØ±Ø§Øª Ù…Ø³Ø¬Ù„Ø© Ø¨Ø¹Ø¯.";
            return;
        }
        const html = list.slice().reverse().map(a => {
            return (
                "â€¢ [" + (a.time || "?") + "] " +
                (a.source || "?") + " â€” " +
                (a.reason || "") +
                (a.change_pct != null ? (" (Î” " + a.change_pct.toFixed(2) + "%)") : "")
            );
        }).join("<br />");
        document.getElementById("alerts_list").innerHTML = html;
    } catch (e) {
        console.log("Alerts error:", e);
    }
}

async function clearAlerts() {
    if (!confirm("Ù…ØªØ£ÙƒØ¯ Ø¥Ù†Ùƒ Ø¹Ø§ÙŠØ² ØªÙ…Ø³Ø­ Ø³Ø¬Ù„ Ø§Ù„ØªØ­Ø°ÙŠØ±Ø§ØªØŸ")) return;
    try {
        const res = await fetch(apiUrl("/admin/clear_alerts"));
        const data = await res.json();
        alert(data.message || "ØªÙ….");
        reloadAlerts();
    } catch (e) {
        console.log("clearAlerts error:", e);
    }
}

async function callAdmin(action) {
    try {
        const res = await fetch(apiUrl("/admin/" + action));
        const data = await res.json();
        alert(data.message || JSON.stringify(data));
    } catch (e) {
        console.log("admin action error:", e);
    }
}

// Ø£ÙˆÙ„ ØªØ­Ù…ÙŠÙ„
loadMain();
reloadAlerts();

// ØªØ­Ø¯ÙŠØ« Ù…Ø³ØªÙ…Ø±
setInterval(loadMain, 10000);
setInterval(loadLogs, 30000);
setInterval(reloadAlerts, 60000);
</script>

</body>
</html>
